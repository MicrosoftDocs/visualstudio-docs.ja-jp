---
title: "R Tools for Visual Studio のワークスペース | Microsoft Docs"
description: "Visual Studio のワークスペースを使って R コードを実行する場所を制御する方法について説明します。"
ms.custom: 
ms.date: 01/24/2018
ms.reviewer: 
ms.suite: 
ms.technology:
- devlang-r
dev_langs:
- R
ms.tgt_pltfrm: 
ms.topic: article
author: kraigb
ms.author: kraigb
manager: ghogen
ms.workload:
- data-science
ms.openlocfilehash: bb520f317eb285bcc278ff9f37bb2dc25c91e950
ms.sourcegitcommit: 39c525ec200c6c4ea94815567b3fad7ab14fb7b3
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/08/2018
---
# <a name="controlling-where-r-code-runs-with-workspaces"></a>ワークスペースで R コードが実行する場所を制御する

R Tools for Visual Studio (RTVS) のワークスペースを使用すると、R セッションが実行する場所を構成できます。ローカル コンピューターでもリモート コンピューターでも実行できます。 目的は、どちらでも同じようなユーザー エクスペリエンスで作業できるようにして、クラウド ベースのコンピューターが潜在的に備えるさらに強力な機能を活用することです。

**[ワークスペース]** ウィンドウを開くには、**[R Tools] > [ウィンドウ] > [ワークスペース]** コマンドを使うか、Ctrl + 9 キーを押します。

![R Tools for Visual Studio の [ワークスペース] ウィンドウ (VS2017)](media/workspaces-window.png)

このウィンドウの緑のチェックマークは、RTVS がバインドされているアクティブなワークスペースを示します。 青い矢印を選ぶと、アクティブなワークスペースが設定されます。 各ワークスペースの右側にある設定 (歯車) アイコンを使うと、名前、場所、およびコマンド ライン引数を変更できます。 赤い [X] は、手動で追加したワークスペースを削除します。

## <a name="saving-and-resetting-a-workspace"></a>ワークスペースの保存とリセット

既定では、プロジェクトを閉じて開きなおすときに、RTVS はワークスペースの状態を保存しません。 ただし、[ワークスペースのオプション](options-for-r-tools-in-visual-studio.md#workspace)でこの動作を変更できます。

**[R Tools] > [セッション] > [リセット]** コマンドおよび対話型ウィンドウのツール バーのリセット ボタンを使うと、いつでもワークスペースの状態をリセットできます。 リモート ワークスペースでは、リセットを行うとリモート サーバーに初めて接続したときに作成されたユーザー プロファイルが削除され、そこに蓄積されていたすべてのファイルが削除されます。

## <a name="local-workspaces"></a>ローカル ワークスペース

ローカル ワークスペースのリストには、コンピューターにインストールされているすべての R インタープリターが表示されます。 

Visual Studio は起動時に、`HKEY_LOCAL_MACHINE\Software\R-Core\` レジストリ キーを調べて、インストールされているすべてのバージョンの R を自動的に検出します。 このチェックは起動時にのみ行われるため、新しい R インタープリターをインストールした場合は、Visual Studio を再起動する必要があります。

RTVS は、標準ではない方法で (たとえば、インストーラーを実行する代わりに単にファイルをフォルダーにコピーすることで) インストールされた R インタープリターを、検出しない可能性があります。 その場合は、次のようにして手動で新しいローカル R ワークスペースを作成します。

1. [ワークスペース] ウィンドウで **[追加]** ボタンを選択します。
1. 新しいワークスペースの名前を入力します。
1. R ルート フォルダーへのパス (インタープリターの `bin` フォルダーを含むパス) と、RTVS がインタープリターを起動するときにインタープリターに渡すオプションのコマンド ライン引数を入力します。
1. 終わったら **[保存]** を選択します。

![新しいワークスペースの追加](media/workspaces-add-new.png)

## <a name="remote-workspaces"></a>リモート ワークスペース

リモート ワークスペースを使うと、リモート コンピューター上の R セッションに接続できます (この目的にコンピューターを構成する方法については、「[Setting up remote workspaces](setting-up-remote-r-workspaces.md)」(リモート ワークスペースの設定) をご覧ください)。

Visual Studio はリモート ワークスペースを自動的に検出しないので、前のセクションで説明したように、[ワークスペース] ウィンドウの **[追加]** ボタンを使用して手動で追加する必要があります。 その場合、ローカル パスではなく、リモート コンピューターの URI を入力します。

> [!Important]
> リモート ワークスペースは、リモート コンピューターとの通信のプライバシーと整合性を確保するため、"*HTTPS プロトコルを使用する必要がある*" URI によって識別されます。 Visual Studio は、HTTPS をサポートしていないリモート コンピューターには接続できません。

> [!Note]
> リモート ワークスペースは実質的にはプレビュー段階です。 将来のリリースの実装でファイル同期の問題を改善する作業が行われており、アイデアやフィードバックを歓迎します。

## <a name="remote-workspace-logon"></a>リモート ワークスペースのログオン

リモート ワークスペースにログオンするには、ユーザー名とパスワードを使用する必要があります。

### <a name="logon-to-windows-workspace"></a>Windows ワークスペースへのログオン

リモート コンピューターがドメイン アカウントを使用するようにセットアップされている場合は、ドメイン ログオンを使用してリモート ワークスペースにアクセスできます。 そうでない場合は、リモート コンピューター上のコンピューター アカウントを使用して、`machine-name\username` 形式でログオンする必要があります。

### <a name="logon-to-linux-workspace"></a>Linux ワークスペースへのログオン

Linux アカウントにログオンするには、`<<unix>>\username` 形式を使用します。 たとえば、`ruser` という名前のアカウントがある場合、ユーザー名を `<<unix>>\ruser` として入力する必要があります。

## <a name="switching-between-workspaces"></a>ワークスペースの切り替え

RTVS は、一度に 1 つのワークスペースのみにバインドされます。 バインドされたワークスペースは、[ワークスペース] ウィンドウでは小さい緑色のチェックマークで示されます。 既定では、RTVS は前のセッションで最後に開いたローカル ワークスペースにバインドします。

アクティブなワークスペースを変更するには、目的のワークスペースの横にある青い矢印を選択します。 選択すると、セッションの保存を求めるメッセージが表示された後、現在のワークスペースが終了されて、新しいワークスペースに切り替わります。

> [!Tip]
> 保存メッセージを無効にするには、**[R Tools] > [オプション]** コマンドを選び、**[ワークスペースを切り替える前に確認ダイアログを表示する]** オプションを [`No`] に設定します。 「[R Tools for Visual Studio options](options-for-r-tools-in-visual-studio.md#workspace)」(R Tools for Visual Studio のオプション) をご覧ください。

アンインストールされたローカル ワークスペースまたは使用できないリモート ワークスペースに切り替えようとすると、RTVS がどのワークスペースにもバインドされなくなる可能性があります。 その結果、対話型ウィンドウでコードを入力したり、それ以外でコードを実行しようとしたりしたときに、エラーが表示される場合があります。

![RTVS にワークスペースがバインドされていない場合のエラー](media/workspaces-disconnected-interactive-window.png)

これを解決するには、[ワークスペース] ウィンドウで別のワークスペースに切り替えます。 使用できるワークスペースがない場合は、R インタープリターをインストールする必要があります。 また、Visual Studio の実行中にインタープリターをインストールした場合は、Visual Studio を再起動してもかまいません。

### <a name="switching-to-a-remote-workspace"></a>リモート ワークスペースへの切り替え

リモート ワークスペースに初めて接続するときは、RTVS により資格情報の入力を求められます。入力した資格情報は、後のセッションのために (安全な Windows 資格情報保管ボックスを使って) キャッシュされます。 その後、リモート サーバーとの通信は HTTPS を使って安全に行われます (これは必須です)。

サーバーの構成によっては、接続時に "リモート R Services で提示されるセキュリティ証明書では、ユーザーがコンピューター <名前> に確かに接続していることを証明できません" という証明書の警告が表示される場合があります。

![リモート ワークスペース接続時の自己署名証明書の警告](media/workspaces-remote-self-signed-certificate-warning.png)

証明書は、接続しようとしているコンピューターから RTVS に提示されるドキュメントです。 証明書には、そのコンピューターの URI を示すフィールドが含まれています。 証明書の URI とコンピューターへの接続に使用された URI の不一致を RTVS が検出すると警告が表示され、サーバーのセキュリティが侵害されている可能性を示します。

ただし、この警告は、リモート コンピューターで HTTPS を有効にするために、信頼できるプロバイダーからの証明書ではなく、"*自己署名証明書*" が使われた場合にも表示されます。 詳しくは、「[リモート ワークスペースの設定](setting-up-remote-r-workspaces.md)」をご覧ください。

## <a name="directories-on-local-and-remote-computers"></a>ローカル コンピューターとリモート コンピューターのディレクトリ

既定では、ローカル ワークスペースで新しい R インタープリターを開始すると、現在の作業ディレクトリは `%userprofile%\Documents` になります。 ディレクトリは、**[R Tools] > [作業ディレクトリ]** コマンドを使って、または Visual Studio のソリューション エクスプローラーでプロジェクトを右クリックして **[作業ディレクトリをここに設定]** のようなコマンドを選ぶことによって、いつでも変更できます。

リモート コンピューターに初めて接続するとき、RTVS は資格情報に基づいてユーザー プロファイルを自動的に作成し、そのプロファイルの下の `Documents` フォルダーに作業ディレクトリを設定します。 このフォルダーは、同じ資格情報でそれ以降に行われるすべてのリモート セッションに使われます。 

その結果、コードが実行される正確な場所は、ローカル ワークスペースとリモート ワークスペースで異なる場合があります。 その後、コードでは常にデータ ファイルへの相対パスを使い、コードをワークスペース間で移植できるようにします。

リモート ワークスペースでは、作業ディレクトリのすべてのファイルは同じユーザー プロファイルのセッションに対してその場所に維持されることにも注意してください。 前に説明したように、リモート ワークスペースを使っているときは、**[R Tools] > [セッション] > [リセット]** コマンド (または対話型ウィンドウのリセット ボタン) を使って、これらのファイルを削除できます。 このコマンドは、サーバーからユーザー プロファイルを削除し、再接続すると再び作成されます。

## <a name="copying-project-files-to-remote-workspaces"></a>リモート ワークスペースへのプロジェクト ファイルのコピー

Visual Studio で R プロジェクトの作業を行っているときは、リモート ワークスペースを使っている場合であっても、ローカル コンピューターに常に最新のプロジェクト ファイルが存在します。 つまり、Visual Studio でプロジェクトを開くと (通常は、そのプロジェクトを含むソリューションを開くこと)、RTVS はプロジェクトのコンテンツがローカル コンピューターに完全に存在するものと想定します。 リモート ワークスペースは、実際には、プロジェクトのファイルおよびコードからの出力の一時的なホストにすぎません。 つまり、たとえば、対話型ウィンドウで `source` を使ってファイルを読み込むとき、そのファイルは、リモート コンピューターのユーザー指定のパス、またはリモート R インタープリターの現在の作業ディレクトリ (`setwd()` 関数で設定) に、既に存在している必要があります。

ファイルは、次のようにリモート サーバーにコピーされます。

- 対話型ウィンドウを使ってリモートでファイルを作業するには、最初に、ソリューション エクスプローラーでそれらのファイル (またはプロジェクト) を右クリックして [選択したファイルのソース化] を選択することで、手動でコピーする必要があります。 個々のファイルは、サーバー上の作業ディレクトリにコピーされます。プロジェクトをコピーすると、RTVS によってプロジェクトのフォルダーが作成されます。

- また、ソリューション エクスプローラーでファイルを選択して **[選択したファイルのソース化]** を選ぶことにより、ファイルをコピーすることもできます。 このアクションにより、ファイルは対話型ウィンドウに読み込まれて、そこで実行されます。 セッションがリモート コンピューターに接続されている場合、ファイルは最初にコピーされます。

- RTVS がリモート ワークスペースにバインドされている場合、F5 キーを押すか、**[デバッグ] > [デバッグ開始]** を選ぶか、他の方法でコードの実行を開始すると、RTVS は既定でリモート ワークスペースにプロジェクトのファイルを自動的にコピーします (この動作の制御方法については後述を参照)。

- サーバーに既に存在するファイルはすべて上書きされます。

> [!Note]
> RTVS はすべての R 関数呼び出しを確実にインターセプトできないため、対話型ウィンドウ内からの `source()` や `runApp()` (Shiny アプリケーションの場合) などの関数の呼び出しでは、リモート ワークスペースへのファイルのコピーは "*行われません*"。

[プロジェクトのプロパティ](r-projects-in-visual-studio.md#project-properties)は、プロジェクト実行時に RTVS がファイルをコピーするかどうか、およびコピーされるファイルの厳密な指定を制御します。 このページを開くには、**[プロジェクト] > [<名前> のプロパティ...]** メニュー コマンドを選ぶか、またはソリューション エクスプローラーでプロジェクトを右クリックして **[プロパティ...]** を選びます。

![ファイル転送の設定があるプロジェクトのプロパティの [実行] タブ](media/workspaces-remote-file-transfer-filter-settings.png)

ここで、**[Transfer files on run]\(実行時にファイルを転送する\)** プロパティは、RTVS がプロジェクト ファイルを自動的にコピーするかどうかを決定します。 **[Files to transfer]\(転送するファイル\)** の値は、転送されるファイルを正確に抽出します。 既定では、`.R`、`.Rmd`、`.sql`、`.md`、および `.cpp` ファイルのみがコピーされます。 この動作は、誤って実行のたびに大きなデータ ファイルがサーバーにコピーされるのを防ぎます。 

## <a name="copying-files-from-a-remote-workspace"></a>リモート ワークスペースからのファイルのコピー

R スクリプトがサーバーでファイルを生成する場合、`rtvs::fetch_file` 関数を使ってそれらのファイルをクライアントにコピーして戻すことができます。 この関数は、少なくとも、コンピューターにコピーするファイルのリモート パスと、コンピューター上のターゲット パス (省略可能) を受け取ります。 ローカル コンピューター上のパスを指定しないと、ファイルは `%userprofile%\Downloads` フォルダーにコピーされます。
