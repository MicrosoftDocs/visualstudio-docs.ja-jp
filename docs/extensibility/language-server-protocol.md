---
title: 言語サーバー プロトコルの概要 |Microsoft Docs
ms.custom: ''
ms.date: 11/14/2017
ms.technology:
- vs-ide-sdk
ms.topic: conceptual
ms.assetid: 6a7d93c2-31ea-4bae-8b29-6988a567ddf2
author: gregvanl
ms.author: gregvanl
manager: douge
ms.workload:
- vssdk
ms.openlocfilehash: ad0e802bd63a9d489a98eb9f216e6739e378d590
ms.sourcegitcommit: f685fa5e2df9dc307bf1230dd9dc3288aaa408b5
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/19/2018
ms.locfileid: "36233414"
---
# <a name="language-server-protocol"></a>言語サーバー プロトコル

## <a name="what-is-the-language-server-protocol"></a>言語サーバー プロトコルとは何ですか。

サポートの豊富な編集機能などのソース コード自動補完機能または**定義へ移動**エディターまたは IDE でのプログラミング言語は従来から非常に困難で時間がかかります。 通常、エディターや IDE のプログラミング言語で (スキャナー、パーサー、型チェック、ビルダーなど) は、ドメイン モデルの作成が必要です。 たとえば、Eclipse IDE で C/C++ 用のサポートを提供する CDT の Eclipse プラグインは Java で記述された Eclipse IDE 自体は Java で記述するため。 この方法は、次の for Visual Studio で c# for Visual Studio Code では、TypeScript での C/C++ ドメイン モデルとは別のドメイン モデルを実装することは意味します。

言語固有のドメイン モデルの作成も、ずっと楽、開発ツールでは、既存の言語固有のライブラリを再利用できます。 ただし、これらのライブラリは通常、プログラミング言語そのもの (たとえば、正常な C/C++ ドメイン C および C++ でモデルを実装) で実装します。 TypeScript で記述された、エディターに C と C++ のライブラリを統合する技術的には可能ですが難しい。

### <a name="language-servers"></a>言語のサーバー

別の方法を独自のプロセスで、ライブラリを実行し、プロセス間通信を使用して、通信が行わします。 メッセージの送受信は、プロトコルを形成します。 言語サーバー プロトコル (LSP) は、製品の開発ツールと言語のサーバー プロセスの間で交換されるメッセージを標準化することです。 言語のサーバーまたはデーモンの使用は、新規または斬新な考え方ではありません。 Vim および Emacs 行っていたこのしばらくセマンティック オート コンプリートをサポートするようにエディター。 お客様の LSP の目的は、この種の統合を簡素化し、さまざまなツールへの言語機能を公開するための便利なフレームワークを提供することでした。

一般的なプロトコルのプログラミング言語の機能を言語のドメイン モデルの既存の実装を再利用して最小限の労力で、開発ツールに統合できます。 言語サーバー バックエンドは、PHP、Python、または Java で記述できることし、さまざまなツールに簡単に統合することにより、お客様の LSP です。 プロトコルは、ツールは、基になるドメイン モデルに固有の微妙な差異を完全に理解することがなく豊富な言語サービスを提供できますように抽象化の一般的なレベルで動作します。

## <a name="how-work-on-the-lsp-started"></a>開始 LSP で機能するしくみ

LSP は、時間の経過と共に進化してきた現在 Version 3.0 には. 言語サーバーの概念によって取得された OmniSharp (C#) または高度な編集機能を提供するときに開始します。 最初に、OmniSharp は、JSON ペイロードで HTTP プロトコルを使用しなどいくつかのエディターに統合されました[Visual Studio Code](https://code.visualstudio.com)します。

同時期は、Microsoft は、Sublime Text、Emacs などのエディターで TypeScript をサポートするというアイデア、TypeScript 言語のサーバーの作業を開始します。 この実装では、エディターは、stdin と stdout TypeScript サーバー プロセスを経由して通信し、要求と応答、V8 デバッガー プロトコルに触発された JSON ペイロードを使用します。 TypeScript サーバーは、TypeScript の豊富な編集の TypeScript Sublime プラグイン、VS Code に統合されています。

別の言語の 2 つのサーバーを統合すると後、は、VS Code チームがエディターや Ide の一般的な言語サーバー プロトコルの詳細を開始しました。 一般的なプロトコルにより、別の Ide で使用できる 1 つの言語のサーバーを作成する言語プロバイダー。 言語サーバーのコンシューマーは、1 回クライアント側のプロトコルを実装するためにのみがあります。 これにより、確実な状況での言語プロバイダーと言語のコンシューマーの両方。

言語サーバー プロトコルは、VS Code language API に触発された詳細の言語機能と展開、TypeScript サーバーによって使用されるプロトコルを開始します。 プロトコルは、わかりやすくするために、既存のライブラリにより、リモート起動するための JSON RPC でサポートされます。

VS コードの lint (スキャン) をいくつかのリンター言語サーバーに応答を実装することで、プロトコルが要求チームのプロトタイプをファイルと、検出された警告とエラーのセットを返します。 目標でした lint 対象ファイルがある多数の lint 処理要求エディター セッション中には、ドキュメント内のユーザーによるコンテンツの編集。 理サーバーを新しい lint 処理プロセスでしたを各ユーザーの編集を開始する必要がないようにを稼働し、続けるにします。 VS Code のなど、いくつかのリンター サーバーが実装された ESLint および TSLint の拡張機能。 これら 2 つのリンター サーバーし、TypeScript と JavaScript で実装の両方で Node.js を実行します。 プロトコルのクライアントとサーバーの一部を実装するライブラリを共有します。

## <a name="how-the-lsp-works"></a>お客様の LSP のしくみ

言語サーバーが、独自のプロセスで実行され、Visual Studio または VS Code などのツールと言語のプロトコルを使用して JSON RPC 経由でサーバーの通信。 専用のプロセスで動作している言語のサーバーのもう 1 つの利点は、1 つのプロセス モデルに関連するパフォーマンスの問題が回避されます。 実際のトランスポート チャネルには stdio、ソケット、名前付きパイプ、またはノード ipc かを指定できます、クライアントとサーバーの両方が Node.js で記述された場合。

ルーチンの中に、ツールと言語のサーバーが通信する方法の例は以下がセッションを編集します。

![lsp フロー図](media/lsp-flow-diagram.png)

* **ユーザーがツールで (ドキュメントと呼ばれる) ファイルを開く**: ツールは、ドキュメントが開かれている言語のサーバーに通知します (' textDocument/didOpen ')。 ドキュメントの内容に関する事実では、ファイル システムにされていませんが、ツールによってメモリに保持されます。

* **ユーザーが編集を行った**: ドキュメントの変更 (' textDocument/didChange ') のサーバーに通知するツールと言語のサーバーによって、プログラムのセマンティック情報が更新されます。 このとき、言語のサーバーはこの情報を分析し、検出されたエラーと警告 (' textDocument/publishDiagnostics ') を使用して、ツールを通知します。

* **ユーザーが"定義へ移動 を実行し、エディター内のシンボル**: ツールには、2 つのパラメーター 'textDocument/定義' 要求が送信します: (1) ドキュメントの URI と (2) サーバーに定義の要求への移動が開始位置からテキストの位置。 サーバーは、ドキュメントの URI とシンボルの定義、文書内の位置を返します。

* **ユーザーがドキュメント (ファイル) を閉じる**: 'textDocument/didClose' 通知が、ツール、ドキュメントが不要になったのメモリに現在の内容は今すぐファイル システムに最新の状態を言語のサーバーに通知を送信します。

この例では、プロトコルが「定義へ移動」、「すべての参照の検索」のようなエディター機能のレベルで言語のサーバーと通信する方法を示しています。 プロトコルで使用されるデータ型とは、エディターまたは IDE、現在開いているテキスト ドキュメントと、カーソルの位置のようなデータ型です。 データ型は、抽象構文ツリー、およびコンパイラのシンボル (解決された型を名前空間など) を提供することは通常、プログラミング言語のドメイン モデルのレベルでないです。これにより、プロトコルが大幅に合理化されます。

今すぐ 'textDocument/定義' の要求について詳しく見てみましょう。 クライアント ツールと C++ のドキュメントで「定義へ移動」要求の言語のサーバー間で移動するペイロードを以下に示します。

これが、要求。

```json
{
    "jsonrpc": "2.0",
    "id" : 1,
    "method": "textDocument/definition",
    "params": {
        "textDocument": {
            "uri": "file:///p%3A/mseng/VSCode/Playgrounds/cpp/use.cpp"
        },
        "position": {
            "line": 3,
            "character": 12
        }
    }
}
```

これは、応答を示します。

```json
{
    "jsonrpc": "2.0",
    "id": "1",
    "result": {
        "uri": "file:///p%3A/mseng/VSCode/Playgrounds/cpp/provide.cpp",
        "range": {
            "start": {
                "line": 0,
                "character": 4
            },
            "end": {
                "line": 0,
                "character": 11
            }
        }
    }
}
```

今にして思えば、プログラミング言語モデルのレベルではなく、エディターのレベルでのデータ型を記述するは、言語サーバー プロトコルの成功の理由の 1 つ。 テキスト ドキュメント URI を標準化するよりもシンプルまたはカーソル位置をさまざまなプログラミング言語、抽象構文ツリーとコンパイラのシンボルを標準化することと比較します。

ユーザーは、異なる言語で動作しているときに VS Code は通常各プログラミング言語の言語のサーバーを起動します。 次の例は、ユーザーが Java と SASS ファイルには機能、セッションを示しています。

![java と sass](media/lsp-java-and-sass.png)

### <a name="capabilities"></a>機能

すべての言語のサーバーには、プロトコルで定義されているすべての機能をサポートできます。 そのため、クライアントとサーバーは、'capabilities' をサポートされている機能セットを発表します。 例として、サーバーは、' textDocument/定義 'の要求を処理できますが、' ワークスペース/シンボル' 要求を処理する可能性がありますはないことを発表します。 同様に、クライアントが ' 'の保存に提供されることを発表することができます、文書を保存するため、サーバーが編集されたドキュメントを自動的に書式設定するテキストの編集を計算する前に通知します。

## <a name="integrating-a-language-server"></a>言語サーバーの統合

言語サーバーの特定のツールへの実際の統合は言語サーバー プロトコルで定義されていないと、ツールの実装にします。 いくつかのツールは、拡張機能を開始でき、任意の種類の言語のサーバーと通信することで一般的に言語のサーバーを統合します。 、他のユーザー、VS コードのようにカスタム拡張機能を作成、サーバーの言語ごと拡張機能が、一部のカスタム言語機能を提供することができるようにします。

言語のサーバーとクライアントの実装を簡略化するにはライブラリまたは Sdk のクライアントとサーバーの部分です。 これらのライブラリは、さまざまな言語で提供されます。 などがありますが、[言語クライアントの npm モジュール](https://www.npmjs.com/package/vscode-languageclient)に VS Code 拡張機能と言語のサーバーの統合を容易に[言語 server の npm モジュール](https://www.npmjs.com/package/vscode-languageserver)言語を Node.js を使用してサーバーを記述します。 これは、現在[一覧](https://github.com/Microsoft/language-server-protocol/wiki/Protocol-Implementations)サポート ライブラリの。

## <a name="using-the-language-server-protocol-in-visual-studio"></a>Visual Studio での言語サーバー プロトコルの使用

* [言語サーバー プロトコルの拡張機能の追加](adding-an-lsp-extension.md)-Visual Studio への言語のサーバーの統合について説明します。
