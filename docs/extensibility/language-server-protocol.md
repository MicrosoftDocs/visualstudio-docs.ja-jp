---
title: "言語のサーバー プロトコルの概要 |Microsoft ドキュメント"
ms.custom: 
ms.date: 11/14/2017
ms.reviewer: 
ms.suite: 
ms.technology: vs-ide-sdk
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 6a7d93c2-31ea-4bae-8b29-6988a567ddf2
caps.latest.revision: "1"
author: gregvanl
ms.author: gregvanl
manager: ghogen
ms.openlocfilehash: 9aeef820575a4fb055318fe11d401e85c9958bad
ms.sourcegitcommit: 26419ab0cccdc30d279c32d6a841758cfa903806
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/11/2017
---
# <a name="language-server-protocol"></a>言語のサーバー プロトコル

## <a name="what-is-the-language-server-protocol"></a>言語のサーバー プロトコルとは何ですか。

サポートの豊富な編集機能などのソース コード自動補完または**定義へ移動**エディターまたは IDE でのプログラミング言語は、従来非常に困難な作業と、時間がかかります。 通常エディターまたは IDE のプログラミング言語で、スキャナー、パーサー、型チェック、ビルダーやその他のドメイン モデルの作成が必要です。 たとえば、Eclipse IDE では、C と C++ のサポートを提供する Eclipse CDT プラグインは Java で記述された Eclipse IDE は、Java で記述されたためです。 この方法は、次があるはず for Visual Studio c# での Visual Studio コードでは、TypeScript で C/C++ ドメイン モデルと別のドメイン モデルを実装します。

言語固有のドメイン モデルの作成は、開発ツールでは、既存の言語固有のライブラリを再利用できる場合にずっと簡単です。 ただし、これらのライブラリは通常、プログラミング言語そのもの (たとえば、正常な C/C++ ドメイン モデルは、C および C++ で実装されます) で実装します。 TypeScript で記述されたエディターに C と C++ のライブラリを統合する技術的には可能ですが使いにくい。

### <a name="language-servers"></a>言語のサーバー

別の方法では、独自のプロセスで、ライブラリを実行しに相談して、プロセス間通信を使用します。 前後に送信されたメッセージは、プロトコルを形成します。 言語のサーバー プロトコル (LSP) は、開発ツールと言語のサーバー プロセスの間で交換されるメッセージを標準化するときの積です。 言語のサーバーまたはデーモンを使用することは新規または novel 概念ではありません。 エディター Vim と Emacs たちのセマンティックのオートコンプリートのサポートを提供するには、一定期間このと同じようにします。 LSP の目的は、この種の統合を簡略化し、さまざまなツールに言語機能を公開するのに役立ちますフレームワークを提供することでした。

一般的なプロトコル、プログラミング言語機能を再利用して、言語のドメイン モデルの既存の実装によって収まりと開発ツールに統合できます。 言語サーバー バックエンドは、PHP、Python、または Java で記述できることし、LSP により、さまざまなツールに簡単に統合することです。 プロトコルは、ツールが、基になるドメイン モデルに固有の意味を完全に理解する必要がなくなりますリッチ言語サービスを提供できるように、一般的な抽象化レベルで動作します。

## <a name="how-work-on-the-lsp-started"></a>開始 LSP で機能するしくみ

LSP が時間の経過と共に進化してきましたおよび Version 3.0 では今日です。 言語のサーバーの概念がによってピックアップ OmniSharp c# の豊富な編集機能を提供するときに開始します。 最初に、OmniSharp は、JSON ペイロードで HTTP プロトコルを使用しなどいくつかのエディターに統合されている[Visual Studio Code](https://code.visualstudio.com)です。

同時期に、Microsoft は Emacs と Sublime テキストなどのエディターで TypeScript をサポートするという概念の TypeScript 言語サーバーの作業を開始します。 この実装では、エディターは、stdin/stdout TypeScript サーバー プロセスを経由して通信して、要求と応答について V8 デバッガー プロトコルに触発 JSON ペイロードを使用します。 TypeScript サーバーは、豊富な TypeScript を編集するため、TypeScript Sublime プラグインと VS Code に統合されています。

2 つの異なる言語サーバーを統合した後、VS Code チームは、エディターと Ide の言語の一般的なサーバー プロトコルの調査を開始しました。 一般的なプロトコルでは、さまざまな Ide で使用できる単一言語のサーバーを作成する言語プロバイダーを使用できます。 言語 server コンシューマーは、1 回、クライアント側のプロトコルを実装するだけにできます。 これは、言語プロバイダーと言語のコンシューマーの両方の確実な状況では結果します。

TypeScript サーバーによって使用される言語プロトコルの使用を開始が詳細の [全般] および言語に依存しません。 プロトコルは、着想を VS Code 言語 API を使用する言語機能を強化しました。 プロトコル自体は、その簡潔さとサポート ライブラリの多くのプログラミング言語によるリモート起動するため JSON RPC でサポートされます。

VS Code チーム dogfooded リンター言語のいくつかのサーバーを実装することで、プロトコルです。 リンター言語のサーバーでは、柔らかい (スキャン) ファイルへの要求に応答し、検出された警告とエラーのセットを返します。 目標が柔らかいにファイルがあることが多く linting 要求エディター セッション中にことを意味するドキュメントで、ユーザーによるコンテンツの編集します。 サーバーと各ユーザーの編集を開始する必要がある新しい linting プロセスようを実行し続けるための検出が行われます。 VS Code をなど、いくつかのリンター サーバーが実装された ESLint および TSLint 拡張機能です。 これら 2 つのリンター サーバーは両方で実装 Typescript/javascript され Node.js 上で実行します。 プロトコルのクライアントとサーバーの一部を実装しているライブラリを共有します。

## <a name="how-the-lsp-works"></a>LSP のしくみ

言語サーバーは、独自のプロセスで実行し、Visual Studio または VS Code などのツールが JSON RPC 経由で言語プロトコルを使用して、サーバーと通信します。 専用のプロセスで動作している言語のサーバーのもう 1 つの利点は、1 つのプロセス モデルに関連するパフォーマンスの問題を回避することです。 実際のトランスポート チャネルできます stdio、ソケット、名前付きパイプ、またはノード ipc クライアントとサーバーの両方が Node.js で記述された場合。

ルーチンの中に、ツールと言語のサーバーが通信する方法の例は以下がセッションを編集します。

![lsp フロー図](media/lsp-flow-diagram.png)

* **ユーザーが、ツールで (ドキュメントと呼ばれる) ファイルを開く**: ツールに通知、ドキュメントが開かれている言語のサーバー (' textDocument/didOpen ')。 ドキュメントの内容に関する情報源不要になったファイル システムはツールによってメモリに保持します。

* **ユーザーが編集を行う**: ドキュメントの変更 (' textDocument/didChange ') はサーバーに通知するツールと言語のサーバーによって、プログラムのセマンティック情報が更新されます。 このとき、言語のサーバーはこの情報を分析し、検出されたエラーおよび警告 (' textDocument/publishDiagnostics ') とツールを通知します。

* **エディター内のシンボルをユーザーが"定義へ移動 を実行**: ツールは 2 つのパラメーター 'textDocument/定義' 要求を送信します。 (1) ドキュメントの URI と (2) サーバーに定義要求への移動が開始位置からテキストの位置。 サーバーは、ドキュメントの URI と、ドキュメント内のシンボルの定義の位置を返します。

* **ユーザーがドキュメント (ファイル) を閉じる**: 'textDocument/didClose' 通知が、ツール、ドキュメントが不要になったメモリに現在の内容は今すぐ最新の状態、ファイル システムに言語のサーバーに通知を送信します。

この例では、プロトコルが「定義へ移動」、「すべての参照の検索」のようなエディター機能のレベルで言語のサーバーと通信する方法を示しています。 プロトコルによって使用されるデータ型には、エディターまたは IDE 'データ型の'、現在開いているテキスト ドキュメントなど、カーソルの位置です。 データ型が抽象構文ツリーおよびコンパイラ記号 (たとえば、解決済みの型、名前空間) は通常提供しているプログラミング言語のドメイン モデルのレベルではありません。これにより、プロトコルが大幅に合理化されます。

これで、' textDocument/定義 ' 要求さらに詳しく見てみましょう。 次は、クライアント ツールと C++ ドキュメントで 定義へ移動"要求の言語のサーバー間で移動されたペイロードを示します。

これが、要求。

```json
{
    "jsonrpc": "2.0",
    "id" : 1,
    "method": "textDocument/definition",
    "params": {
        "textDocument": {
            "uri": "file:///p%3A/mseng/VSCode/Playgrounds/cpp/use.cpp"
        },
        "position": {
            "line": 3,
            "character": 12
        }
    }
}
```

これは、応答を示します。

```json
{
    "jsonrpc": "2.0",
    "id": "1",
    "result": {
        "uri": "file:///p%3A/mseng/VSCode/Playgrounds/cpp/provide.cpp",
        "range": {
            "start": {
                "line": 0,
                "character": 4
            },
            "end": {
                "line": 0,
                "character": 11
            }
        }
    }
}
```

思えば、言語のプログラミング モデルのレベルではなく、エディターのレベルでのデータ型を記述するは、言語のサーバー プロトコルの成功のいずれかです。 はるかに簡単なテキスト ドキュメントの URI を標準化するために、またはカーソル位置が異なるプログラミング言語間で抽象構文ツリーとコンパイラ シンボルを標準化するときと比較します。

ユーザーは異なる言語で動作しているときに VS Code は通常それぞれのプログラミング言語の言語のサーバーを起動します。 次の例では、ユーザーが Java と SASS ファイルには機能、セッションを示します。

![java と sass](media/lsp-java-and-sass.png)

### <a name="capabilities"></a>機能

すべての言語のサーバーには、プロトコルで定義されているすべての機能をサポートできます。 そのため、クライアントとサーバーは、[機能] を介してがサポートされている機能セットを発表します。 例としては、サーバーは、' textDocument/定義 '要求を処理できますが、' ワークスペース/シンボル' 要求を処理する可能性がありますはないことを発表します。 同様に、クライアントが提供 ' 約 'を保存することができることをアナウンスすることが通知サーバーが自動的に編集済みのドキュメントの書式設定テキストの編集を計算できるように、ドキュメントが保存される前にします。

## <a name="integrating-a-language-server"></a>言語のサーバーを統合します。

特定のツールに言語のサーバーの実際の統合は、言語のサーバー プロトコルで定義されていないと、ツールの実装にはされません。 一部のツールでは、開始したり、任意の種類の言語のサーバーと通信できる拡張機能を含むにより、言語のサーバーを一般的に統合します。 他のユーザー、VS コードのように作成言語サーバーごとのカスタム拡張機能拡張機能が、一部のカスタム言語機能を提供することができるようにします。

言語のサーバーとクライアントの実装を簡略化の情報はライブラリまたは Sdk クライアントとサーバーの部分です。 これらのライブラリは、異なる言語に提供されます。 などがありますが、[言語クライアント npm モジュール](https://www.npmjs.com/package/vscode-languageclient)に VS Code 拡張機能と別の言語のサーバーの統合を容易に[language サーバー npm モジュール](https://www.npmjs.com/package/vscode-languageserver)Node.js を使用する言語のサーバーを書き込めません。 これは、現在[リスト](https://github.com/Microsoft/language-server-protocol/wiki/Protocol-Implementations)サポート ライブラリのです。

## <a name="using-the-language-server-protocol-in-visual-studio"></a>Visual Studio での言語のサーバー プロトコルの使用

* [サーバー プロトコルの言語拡張機能を追加する](adding-an-lsp-extension.md)-Visual Studio への言語のサーバーの統合について説明します。
