---
title: 変数にウォッチを設定する |Microsoft Docs
ms.custom: seodec18
ms.date: 10/11/2018
ms.topic: conceptual
f1_keywords:
- vs.debug.watch
helpviewer_keywords:
- debugging [Visual Studio], Watch window
- expressions [debugger], evaluating
- variables [debugger], evaluating
- expression evaluation
- registers, evaluating
- debugging [Visual Studio], expression evaluation
author: mikejo5000
ms.author: mikejo
manager: jillfra
ms.workload:
- multiple
ms.openlocfilehash: ea3d2a1e82e92473859fef29754fbb831cf3685b
ms.sourcegitcommit: 0b90e1197173749c4efee15c2a75a3b206c85538
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/07/2019
ms.locfileid: "74904049"
---
# <a name="watch-variables-with-watch-windows-and-quickwatch"></a>ウォッチウィンドウとクイックウォッチを使用した変数のウォッチ

デバッグ中に、**ウォッチ**ウィンドウと**クイックウォッチ**を使用して変数や式をウォッチできます。 ウィンドウは、デバッグセッション中にのみ使用できます。

**ウォッチ**ウィンドウでは、デバッグ中に複数の変数を同時に表示できます。 **[クイックウォッチ]** ダイアログボックスには、一度に1つの変数が表示されます。デバッグを続行するには、閉じる必要があります。

コードを初めてデバッグする場合は、この記事を読む前に、[絶対初心者向けのデバッグ](../debugger/debugging-absolute-beginners.md)や[手法とツール](../debugger/write-better-code-with-visual-studio.md)のデバッグをお読みになることをお勧めします。

## <a name="observe-variables-with-a-watch-window"></a>ウォッチウィンドウを使用して変数を観察する

複数の **[ウォッチ]** ウィンドウを開いて、 **[ウォッチ]** ウィンドウで複数の変数を確認できます。

たとえば、`a`の値のウォッチ式を設定するには、次のコードの `b`、および `c` ます。

```C++
int main()
{
    int a, b, c;
    a = 1;
    b = 2;
    c = 0;

    for (int i = 0; i < 10; i++)
    {
        a++;
        b *= 2;
        c = a + b;
    }

    return 0;
}

```

1. `c = a + b;` 行にブレークポイントを設定するには、左の余白をクリックし、[ > **デバッグ**]、[**ブレークポイント**の設定/解除] の順にクリックするか、 **F9**キーを押します。

1. デバッグを開始する**には、** 緑の**スタート**矢印を選択するか、デバッグ > **デバッグを開始**するか、 **F5**キーを押します。 ブレークポイントで実行が一時停止されます。

1. [ > **の > ** **デバッグ**] を選択して [ウォッチ] ウィンドウを開き **、[ウォッチ] > [** **ウォッチ 1**] をクリックするか、 **Ctrl**+**Alt**+**W** > **1**を押します。

   Windows **2**、 **3**、または**4**を選択すると、追加の**ウォッチ**ウィンドウを開くことができます。

1. **[ウォッチ]** ウィンドウで空の行を選択し、「variable `a`」と入力します。 `b` と `c`に対しても同じ操作を行います。

   ![ウォッチ変数](../debugger/media/watchvariables.png "WatchVariables")

1. デバッグを続行するには、[**デバッグ** > **ステップイン**] を選択するか、必要に応じて**F11**キーを押します。 **[ウォッチ]** ウィンドウの変数の値は、`for` ループを反復処理するときに変更されます。

>[!NOTE]
>のC++場合のみ、
>- 変数名または変数名を使用する式のコンテキストを修飾することが必要になる場合があります。 コンテキストは、変数が配置されている関数、ソースファイル、またはモジュールです。 コンテキストを修飾する必要がある場合は、 **[ウォッチ]** ウィンドウの**名前**に[コンテキストC++演算子 ()](../debugger/context-operator-cpp.md)構文を使用します。
>
>- レジスタ名と変数名を追加するには、 **$\<登録&nbsp;名 >** または@\< **[ウォッチ]** ウィンドウの**名前**に&nbsp;**名前 > を登録**します。 詳細については、「 [Pseudovariables](../debugger/pseudovariables.md)」を参照してください。

## <a name="use-expressions-in-a-watch-window"></a>ウォッチウィンドウで式を使用する

デバッガーによって認識された有効な式は、 **[ウォッチ]** ウィンドウで確認できます。

たとえば、前のセクションのコードでは、 **[ウォッチ]** ウィンドウに `(a + b + c) / 3` を入力して、3つの値の平均を取得できます。

![ウォッチ式](../debugger/media/watchexpression.png "ウォッチ式")

**[ウォッチ]** ウィンドウで式を評価するための規則は、通常、コード言語で式を評価するための規則と同じです。 式に構文エラーがある場合は、コードエディターと同じコンパイラエラーが想定されます。 たとえば、前の式の入力ミスでは、 **[ウォッチ]** ウィンドウにこのエラーが生成されます。

![ウォッチ式エラー](../debugger/media/watchexpressionerror.png "ウォッチ式エラー")

**[ウォッチ]** ウィンドウには、2つの波線アイコンを含む円が表示されます。 このアイコンは、スレッド間の依存関係があるため、デバッガーが式を評価しないことを意味します。 コードを評価するには、アプリ内の他のスレッドを一時的に実行する必要がありますが、中断モードになっているため、通常はアプリ内のすべてのスレッドが停止されます。 他のスレッドを一時的に実行できるようにすると、アプリの状態に予期しない影響が生じる可能性があります。デバッガーは、これらのスレッドでブレークポイントや例外などのイベントを無視できます。

::: moniker range=">= vs-2019" 
## <a name="search-in-the-watch-window"></a>ウォッチウィンドウを検索します

各ウィンドウの上にある検索バーを使用して、**ウォッチ**ウィンドウの [名前]、[値]、[型] の列でキーワードを検索できます。 ENTER キーを押すか、いずれかの矢印を選択して検索を実行します。 進行中の検索を取り消すには、検索バーの "x" アイコンを選択します。

検出された一致の間を移動するには、左矢印と右矢印 (Shift + F3 および F3 キー) を使用します。

![[ウォッチ] ウィンドウで検索](../debugger/media/ee-search-watch.png "[ウォッチ] ウィンドウで検索")

検索を詳細に行うには、 **[ウォッチ]** ウィンドウの上部にある 詳細の **[検索]** ドロップダウンを使用して、入れ子になったオブジェクトに検索するレベルの深さを選択します。 

## <a name="pin-properties-in-the-watch-window"></a>ウォッチウィンドウのプロパティを固定する

>[!NOTE]
> この機能は、.NET Core 3.0 以降でサポートされています。

**Pinnable properties**ツールを使用して、ウォッチウィンドウのプロパティでオブジェクトをすばやく調べることができます。  このツールを使用するには、プロパティの上にマウスポインターを移動し、表示されるピンアイコンを選択するか、右クリックして、結果のコンテキストメニューで [**お気に入りとしてメンバーをピン留め**する] オプションを選択します。  これにより、そのプロパティがオブジェクトのプロパティリストの先頭にバブルされ、 **[値]** 列にプロパティの名前と値が表示されます。  プロパティの固定を解除するには、ピンアイコンをもう一度選択するか、コンテキストメニューの [**メンバーをお気に入りにピン留め**する] オプションを選択します。

![ウォッチウィンドウのプロパティを固定する](../debugger/media/basic-pin-watch.gif "ウォッチウィンドウのプロパティを固定する")

また、ウォッチウィンドウでオブジェクトのプロパティリストを表示するときに、プロパティ名を切り替えたり、ピン留めされていないプロパティをフィルターで除外したりすることもできます。  両方のオプションにアクセスするには、[ウォッチ] ウィンドウの上のツールバーにあるボタンを選択します。

::: moniker-end

### <a name="bkmk_refreshWatch"></a>ウォッチ値の更新

式が評価されると、 **[ウォッチ]** ウィンドウに更新アイコン (円形の矢印) が表示されることがあります。 更新アイコンは、エラーまたは古い値を示します。

値を更新するには、更新アイコンを選択するか、space キーを押します。 デバッガーで、式の再評価が試行されます。 ただし、値が評価されなかった理由によっては、式を再評価する必要がない場合や、評価できない場合があります。

更新アイコンをポイントするか、式が評価されなかった理由の**値**列を参照します。 原因は次のとおりです。

- 前の例のように、式の評価中にエラーが発生しました。 タイムアウトが発生したか、変数がスコープ外になっている可能性があります。

- 式には、アプリで副作用を引き起こす可能性がある関数呼び出しがあります。 「[式](#bkmk_sideEffects)の副作用」を参照してください。

- プロパティの自動評価と暗黙的な関数呼び出しは無効になっています。

プロパティの自動評価と暗黙的な関数呼び出しが無効になっているために更新アイコンが表示された場合は、**ツール** > **オプション**の **プロパティの評価とその他の暗黙的な関数呼び出しを有効**にする >  を選択し**て > ** **全般** をクリックして有効にすることができます。

更新アイコンの使用方法を示すには、次の手順を実行します。

1. [**ツール** > **オプション** > **デバッグ** > **全般**] で、 **[プロパティの評価とその他の暗黙的な関数呼び出しを有効にする]** チェックボックスをオフにします。

1. 次のコードを入力し、 **[ウォッチ]** ウィンドウで `list.Count` プロパティのウォッチを設定します。

   ```csharp
   static void Main(string[] args)
   {
       List<string> list = new List<string>();
       list.Add("hello");
       list.Add("goodbye");
   }
   ```

1. デバッグを開始します。 **[ウォッチ]** ウィンドウには、次のようなメッセージが表示されます。

   ![ウォッチ式の更新](../debugger/media/refreshwatch.png "ウォッチ式の更新")

1. 値を更新するには、更新アイコンを選択するか、space キーを押します。 デバッガーによって式が再評価されます。

### <a name="bkmk_sideEffects"></a>式の副作用

一部の式を評価すると、変数の値を変更したり、アプリの状態に影響を与えたりする場合があります。 たとえば、次の式を評価すると、 `var1`の値が変わります。

```csharp
var1 = var2
```

このコードでは、[副作用](https://en.wikipedia.org/wiki/Side_effect_\(computer_science\))が発生する可能性があります。 副作用は、アプリの動作方法を変更することで、デバッグがより困難になる可能性があります。

副作用がある式は、最初に入力したときに1回だけ評価されます。 その後、式が **[ウォッチ]** ウィンドウに淡色表示され、さらに評価が無効になります。 ツールヒントまたは**値**列では、式が副作用を引き起こすことが説明されています。 再評価を強制するには、値の横に表示される更新アイコンを選択します。

副作用を回避する1つの方法は、関数の自動評価をオフにすることです。 [**ツール** > **オプション** > **デバッグ** > **全般**] で、 **[プロパティの評価とその他の暗黙的な関数呼び出しを有効にする]** をオフにします。

でC#のみ、プロパティの評価または暗黙的な関数呼び出しがオフになっている場合は、 **[ウォッチ]** ウィンドウで変数**名**に**ac**書式修飾子を追加することによって、評価を強制できます。 「[C# の書式指定子](../debugger/format-specifiers-in-csharp.md)」を参照してください。

## <a name="bkmk_objectIds"></a>ウォッチウィンドウでオブジェクト Id を使用するC# (および Visual Basic)

場合によっては、特定のオブジェクトの動作を確認する必要があります。 たとえば、変数がスコープ外になった後で、ローカル変数によって参照されるオブジェクトを追跡することができます。 C# と Visual Basic では、参照型の特定のインスタンスのオブジェクト ID を作成し、それらの ID を**ウォッチ** ウィンドウやブレークポイントの条件で使用できます。 オブジェクト ID は、共通言語ランタイム (CLR) のデバッグ サービスで生成されて、オブジェクトに関連付けられます。

> [!NOTE]
> オブジェクト Id は、オブジェクトがガベージコレクションされないようにする弱い参照を作成します。 オブジェクト ID は、現在のデバッグ セッションでのみ有効です。

次のコードでは、`MakePerson()` メソッドによって、ローカル変数を使用して `Person` が作成されます。

```csharp
class Person
{
    public Person(string name)
    {
        Name = name;
    }
    public string Name { get; set; }
}

public class Program
{
    static List<Person> _people = new List<Person>();
    public static void Main(string[] args)
    {
        MakePerson();
        DoSomething();
    }

    private static void MakePerson()
    {
        var p = new Person("Bob");
        _people.Add(p);
    }

    private static void DoSomething()
    {
        // more processing
         Console.WriteLine("done");
    }
}
```

`DoSomething()` メソッドで `Person` の名前を確認するには、 **[ウォッチ]** ウィンドウで `Person` オブジェクト ID への参照を追加します。

1. `Person` オブジェクトが作成された後に、コードにブレークポイントを設定します。

1. デバッグを開始します。

1. ブレークポイントで実行が一時停止したら、 **[デバッグ]**  > [ **Windows** > **ローカル**] の順に選択して **[ローカル]** ウィンドウを開きます。

1. **[ローカル]** ウィンドウで、`Person` 変数を右クリックし、 **[オブジェクト ID の作成]** を選択します。

   **[ローカル]** ウィンドウには、オブジェクト ID であるドル記号 ( **$** ) と数字が表示されます。

1. オブジェクト id を右クリックし、 **[ウォッチ式の追加]** を選択して、オブジェクト id を **[ウォッチ]** ウィンドウに追加します。

1. `DoSomething()` メソッドに別のブレークポイントを設定します。

1. デバッグを続行します。 `DoSomething()` メソッドで実行が一時停止すると、`Person` オブジェクトが **[ウォッチ]** ウィンドウに表示されます。

   > [!NOTE]
   > オブジェクトのプロパティ (`Person.Name`など) を表示するには、**ツール** >  ** >  > ** **オプション** の順に選択してプロパティの評価を有効にする必要があります。 **全般** > **プロパティの評価とその他の暗黙的な関数の呼び出しを有効に**します。

## <a name="dynamic-view-and-the-watch-window"></a>動的ビューとウォッチウィンドウ

一部のスクリプト言語 (JavaScript や Python など) は動的または[アヒル](https://en.wikipedia.org/wiki/Duck_typing)の型指定を使用し、.net バージョン4.0 以降では通常のデバッグウィンドウでは観察が困難なオブジェクトをサポートしています。

**[ウォッチ]** ウィンドウには、これらのオブジェクトが動的オブジェクトとして表示されます。これらのオブジェクトは、<xref:System.Dynamic.IDynamicMetaObjectProvider> インターフェイスを実装する型から作成されます。 動的オブジェクトノードには動的オブジェクトの動的メンバーが表示されますが、メンバー値の編集は許可されません。

**動的ビュー**の値を更新するには、[動的オブジェクト] ノードの横にある[更新アイコン](#bkmk_refreshWatch)を選択します。

オブジェクトの**動的ビュー**のみを表示するには、 **[ウォッチ]** ウィンドウで動的オブジェクト名の後に**動的**書式指定子を追加します。

- C# の場合: `ObjectName, dynamic`
- Visual Basic の場合: `$dynamic, ObjectName`

>[!NOTE]
>- デバッガー C#は、次のコード行にステップインするときに、**動的ビュー**の値を自動的に再評価しません。
>- Visual Basic デバッガーは、**動的ビュー**を通じて追加された式を自動的に更新します。
>- **動的ビュー**のメンバーを評価すると、[副作用](https://en.wikipedia.org/wiki/Side_effect_\(computer_science\))が発生する場合があります。

**オブジェクトを動的オブジェクトにキャストする新しいウォッチ変数を挿入するには、次のように入力します。**

1. **動的ビュー**の任意の子を右クリックします。
1. **[ウォッチ式の追加]** を選択します。 `object.name` が `((dynamic) object).name` になり、新しい **[ウォッチ]** ウィンドウに表示されます。

デバッガーでは、オブジェクトの**動的ビュー**の子ノードも **[自動変数]** ウィンドウに追加されます。 **[自動変数]** ウィンドウを開くには、デバッグ中に [**デバッグ** > **Windows** > **自動変数**] を選択します。

**動的ビュー**では、COM オブジェクトのデバッグも強化します。 デバッガーが **__ComObject**にラップされた COM オブジェクトに取得されると、そのオブジェクトの**動的ビュー**ノードが追加されます。

## <a name="observe-a-single-variable-or-expression-with-quickwatch"></a>[クイックウォッチ] を使用して1つの変数または式を観察する

**[クイックウォッチ]** を使用すると、1つの変数を確認できます。

たとえば、次のコードについては次のようになります。

```csharp
static void Main(string[] args)
{
    int a, b;
    a = 1;
    b = 2;
    for (int i = 0; i < 10; i++)
    {
        a = a + b;
    }
}
```

`a` 変数を確認するには、

1. `a = a + b;` の行にブレークポイントを設定します。

1. デバッグを開始します。 ブレークポイントで実行が一時停止されます。

1. コードで `a` 変数を選択します。

1. **[デバッグ]**  >  **[クイックウォッチ]** を選択し、 **Shift**キーを押し+**F9**キーを押すか、右クリックして **[クイックウォッチ]** を選択します。

   **[クイックウォッチ]** ダイアログが表示されます。 `a` 変数は、**値**が**1**の **[式]** ボックスにあります。

   ![[クイックウォッチ変数]](../debugger/media/quickwatchvariable.png "[クイックウォッチ変数]")

1. 変数を使用して式を評価するには、 **[式]** ボックスに「`a + b`」などの式を入力し、再 **[評価]** を選択します。

   ![クイックウォッチの式](../debugger/media/quickwatchexpression.png "クイックウォッチの式")

1. [**クイック**ウォッチ] から **[ウォッチ] ウィンドウに**変数または式を追加するには、[ウォッチ式の**追加**] を選択します。

1. **[閉じる]** を選択して **[クイックウォッチ]** ウィンドウを閉じます。 ( **[クイックウォッチ]** はモーダルダイアログであるため、開いている間はデバッグを続行できません)。

1. デバッグを続行します。 **ウォッチ**ウィンドウで変数を確認できます。

## <a name="see-also"></a>参照
- [デバッグとは](../debugger/what-is-debugging.md)
- [デバッグの技術とツール](../debugger/write-better-code-with-visual-studio.md)
- [デバッグに関する最初の確認](../debugger/debugger-feature-tour.md)
- [デバッガー ウィンドウ](../debugger/debugger-windows.md)
