---
title: 変数にウォッチを設定する |マイクロソフトドキュメント
ms.custom: seodec18
ms.date: 10/11/2018
ms.topic: conceptual
f1_keywords:
- vs.debug.watch
helpviewer_keywords:
- debugging [Visual Studio], Watch window
- expressions [debugger], evaluating
- variables [debugger], evaluating
- expression evaluation
- registers, evaluating
- debugging [Visual Studio], expression evaluation
author: mikejo5000
ms.author: mikejo
manager: jillfra
ms.workload:
- multiple
ms.openlocfilehash: ea3d2a1e82e92473859fef29754fbb831cf3685b
ms.sourcegitcommit: 95f26af1da51d4c83ae78adcb7372b32364d8a2b
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/13/2020
ms.locfileid: "79301015"
---
# <a name="watch-variables-with-watch-windows-and-quickwatch"></a>ウォッチウィンドウとクイックウォッチで変数を見る

デバッグ中は、[**ウォッチ]** ウィンドウと **[クイック ウォッチ]** を使用して変数と式をウォッチできます。 ウィンドウはデバッグ セッション中にのみ使用できます。

**ウォッチ**ウィンドウでは、デバッグ中に一度に複数の変数を表示できます。 **[クイック ウォッチ]** ダイアログボックスには一度に 1 つの変数が表示されます。

コードをデバッグする初めての場合は、この記事を参照する前に、[絶対初歩者向けのデバッグ](../debugger/debugging-absolute-beginners.md)と[デバッグのテクニックとツール](../debugger/write-better-code-with-visual-studio.md)を読んでいてもよいでしょう。

## <a name="observe-variables-with-a-watch-window"></a>ウォッチ ウィンドウで変数を観察する

複数の**ウォッチ**ウィンドウを開き、ウォッチ ウィンドウで複数の変数を**確認**できます。

たとえば、 `a`、、`b`および`c`の値にウォッチを設定するには、次のコードを使用します。

```C++
int main()
{
    int a, b, c;
    a = 1;
    b = 2;
    c = 0;

    for (int i = 0; i < 10; i++)
    {
        a++;
        b *= 2;
        c = a + b;
    }

    return 0;
}

```

1. 左マージン`c = a + b;`をクリックするか、**デバッグ** > **トグルブレークポイント**を選択するか、**または F9**キーを押して、行にブレークポイントを設定します。

1. 緑色の開始矢印または**デバッグ** > **開始**デバッグを選択して**デバッグを開始**するか **、F5**キーを押します。 実行はブレークポイントで一時停止します。

1.  > **[Windows**++**W** > **1** > **Watch 1** **Debug** > **ウォッチ ウォッチ**1 のデバッグ] を選択するか **、Ctrl****Alt W**1 を押して**ウォッチ**ウィンドウを開きます。

   ウィンドウ**2** **、3**、または**4**を選択して、追加の**ウォッチ**ウィンドウを開くことができます。

1. [**ウォッチ]** ウィンドウで空の行を選択し、「`a`変数」と入力します。 と に対`b`して`c`同じことを行います。

   ![ウォッチ変数](../debugger/media/watchvariables.png "ウォッチ変数")

1. デバッグを続行するには、[**デバッグ** > **ステップイン**] を選択するか、必要に応じて**F11 キー**を押して先に進めます。 [**ウォッチ]** ウィンドウの変数値は、ループを反復`for`処理すると変化します。

>[!NOTE]
>C++ の場合のみ、
>- 変数名のコンテキスト、または変数名を使用する式のコンテキストを修飾する必要がある場合があります。 コンテキストは、変数が置かれている関数、ソース ファイル、またはモジュールです。 コンテキストを修飾する必要がある場合は、**ウォッチ**ウィンドウの**Name**で[コンテキスト演算子 (C++)](../debugger/context-operator-cpp.md)構文を使用します。
>
>- [**ウォッチ**] ウィンドウの [**名前**] ** $ \<&nbsp;>>、レジスタ>****@\<&nbsp;** 名と変数名を追加できます。 詳細については、「 [Pseudovariables](../debugger/pseudovariables.md)」を参照してください。

## <a name="use-expressions-in-a-watch-window"></a>[ウォッチ] ウィンドウで式を使用する

デバッガーで認識された有効な式は **、ウォッチ**ウィンドウで確認できます。

たとえば、前のセクションのコードの場合は、[**ウォッチ]** ウィンドウに入力して、3 つの値の`(a + b + c) / 3`平均を取得できます。

![ウォッチ式](../debugger/media/watchexpression.png "ウォッチ式")

**[ウォッチ]** ウィンドウで式を評価するための規則は、通常、コード言語で式を評価するための規則と同じです。 式に構文エラーがある場合は、コード エディターと同じコンパイラ エラーが発生します。 たとえば、上記の式の入力ミスは **、ウォッチ**ウィンドウでこのエラーを生成します。

![ウォッチ式エラー](../debugger/media/watchexpressionerror.png "ウォッチ式エラー")

**[ウォッチ**] ウィンドウに、2 本の波線アイコンが表示されている円が表示されることがあります。 このアイコンは、スレッド間の依存関係が発生する可能性があるため、デバッガーが式を評価しないことを示します。 コードを評価するには、アプリ内の他のスレッドを一時的に実行する必要がありますが、中断モードであるため、通常はアプリ内のすべてのスレッドが停止します。 他のスレッドを一時的に実行できるようにすると、アプリの状態に予期しない影響が生じる可能性があり、デバッガーは、それらのスレッドのブレークポイントや例外などのイベントを無視する可能性があります。

::: moniker range=">= vs-2019" 
## <a name="search-in-the-watch-window"></a>[ウォッチ] ウィンドウで検索する

各ウィンドウの上にある検索バーを使用して、[**ウォッチ**] ウィンドウの [名前]、[値]、および [種類] 列のキーワードを検索できます。 ENTER キーを押すか、いずれかの矢印を選択して検索を実行します。 進行中の検索をキャンセルするには、検索バーの 「x」アイコンを選択します。

検索した一致の間を移動するには、左矢印と右矢印(それぞれ Shift+F3 と F3)を使用します。

![ウォッチ ウィンドウで検索](../debugger/media/ee-search-watch.png "ウォッチ ウィンドウで検索")

検索を多少徹底的にするには、[**ウォッチ**] ウィンドウの上部にある [**詳細**検索] ドロップダウンを使用して、ネストされたオブジェクトを検索する深さのレベルを選択します。 

## <a name="pin-properties-in-the-watch-window"></a>[ウォッチ] ウィンドウの [ピン] プロパティ

>[!NOTE]
> この機能は、.NET Core 3.0 以降でサポートされています。

[ウォッチ] ウィンドウの [**固定プロパティ]** ツールを使用して、オブジェクトのプロパティを使用して、オブジェクトをすばやく検査できます。  このツールを使用するには、プロパティにマウス ポインターを合わせて表示されるピン アイコンを選択するか、右クリックして表示されるコンテキスト メニューの **[メンバーをお気に入りとして固定]** オプションを選択します。  これにより、そのプロパティがオブジェクトのプロパティ リストの先頭に表示され、プロパティの名前と値が **[値]** 列に表示されます。  プロパティの固定を解除するには、ピン アイコンをもう一度選択するか、コンテキスト メニューの **[メンバーをお気に入りとして固定解除**] オプションを選択します。

![[ウォッチ] ウィンドウの [ピン] プロパティ](../debugger/media/basic-pin-watch.gif "[ウォッチ] ウィンドウの [ピン] プロパティ")

また、[ウォッチ] ウィンドウでオブジェクトのプロパティ リストを表示するときに、プロパティ名を切り替えたり、固定されていないプロパティを除外したりすることもできます。  両方のオプションにアクセスするには、ウォッチ ウィンドウの上にあるツールバーのボタンを選択します。

::: moniker-end

### <a name="refresh-watch-values"></a><a name="bkmk_refreshWatch"></a>ウォッチ値の更新

式が評価されると、更新アイコン (円形の矢印) が **[ウォッチ]** ウィンドウに表示されることがあります。 更新アイコンは、エラーまたは最新の値を示します。

値を更新するには、更新アイコンを選択するか、スペースバーを押します。 デバッガーで、式の再評価が試行されます。 ただし、値が評価されなかった理由によっては、式を再評価する必要がない場合や、式を再評価できない場合があります。

更新アイコンにカーソルを合わせるか、式が評価されなかった理由の **[値**] 列を表示します。 次のような理由が考えられます。

- 前の例のように、式の評価中にエラーが発生しました。 タイムアウトが発生したり、変数がスコープ外である可能性があります。

- 式には、アプリで副作用をトリガーする関数呼び出しがあります。 [式の副作用](#bkmk_sideEffects)を参照してください。

- プロパティの自動評価と暗黙的な関数呼び出しは無効になります。

プロパティの自動評価と暗黙的な関数呼び出しが無効になっているために更新アイコンが表示された場合は、[**ツール** > **オプション** > **のデバッグ** > **全般**] で [**プロパティ評価を有効にする] および [その他の暗黙的な関数呼び出し**] を選択して、このアイコンを有効にすることができます。

更新アイコンの使用をデモンストレーションするには、次の手順を実行します。

1. [**ツール** > **オプション** > **のデバッグ** > **全般**] で、[**プロパティの評価とその他の暗黙的な関数呼び出しを有効にする**] チェック ボックスをオフにします。

1. 次のコードを入力し、[**ウォッチ**] ウィンドウで、`list.Count`プロパティのウォッチを設定します。

   ```csharp
   static void Main(string[] args)
   {
       List<string> list = new List<string>();
       list.Add("hello");
       list.Add("goodbye");
   }
   ```

1. デバッグを開始します。 [**ウォッチ]** ウィンドウには、次のようなメッセージが表示されます。

   ![リフレッシュウォッチ](../debugger/media/refreshwatch.png "リフレッシュウォッチ")

1. 値を更新するには、更新アイコンを選択するか、スペースバーを押します。 デバッガーは式を再評価します。

### <a name="expression-side-effects"></a><a name="bkmk_sideEffects"></a>式の副作用

一部の式を評価すると、変数の値が変更されたり、アプリの状態に影響を与えたりする可能性があります。 たとえば、次の式を評価すると、 `var1`の値が変わります。

```csharp
var1 = var2
```

このコードは、[副作用](https://en.wikipedia.org/wiki/Side_effect_\(computer_science\))を引き起こす可能性があります。 副作用は、アプリの動作方法を変更することで、デバッグを困難にする可能性があります。

副作用を含む式は、最初に入力したときに 1 回だけ評価されます。 その後、[**ウォッチ]** ウィンドウで式が淡色表示され、さらに評価が無効になります。 ツールヒントまたは **[値]** 列では、式によって副作用が発生する場合が示されます。 値の横に表示される更新アイコンを選択して、再評価を強制することができます。

副作用の指定を防ぐ 1 つの方法は、自動関数の評価をオフにすることです。 [**ツール** > **オプション** > **のデバッグ** > **全般**] で、[**プロパティ評価とその他の暗黙的な関数呼び出しを有効にする**] の選択を解除します。

C# の場合のみ、プロパティの評価または暗黙的な関数呼び出しがオフになっている場合は、**ウォッチ**ウィンドウで変数**Name**に**ac** format 修飾子を追加することで、強制的に評価できます。 [C# の書式指定子を参照してください](../debugger/format-specifiers-in-csharp.md)。

## <a name="use-object-ids-in-the-watch-window-c-and-visual-basic"></a><a name="bkmk_objectIds"></a>ウォッチ ウィンドウでオブジェクト ID を使用する (C# および Visual Basic)

特定のオブジェクトの動作を観察したい場合があります。 たとえば、ローカル変数が参照するオブジェクトを、その変数がスコープ外に出た後に追跡できます。 C# と Visual Basic では、参照型の特定のインスタンスのオブジェクト ID を作成し、それらの ID を**ウォッチ** ウィンドウやブレークポイントの条件で使用できます。 オブジェクト ID は、共通言語ランタイム (CLR) のデバッグ サービスで生成されて、オブジェクトに関連付けられます。

> [!NOTE]
> オブジェクト ID は、オブジェクトがガベージ コレクションされるのを妨げるない弱い参照を作成します。 オブジェクト ID は、現在のデバッグ セッションでのみ有効です。

次のコードでは、メソッド`MakePerson()`はローカル変数`Person`を使用して作成します。

```csharp
class Person
{
    public Person(string name)
    {
        Name = name;
    }
    public string Name { get; set; }
}

public class Program
{
    static List<Person> _people = new List<Person>();
    public static void Main(string[] args)
    {
        MakePerson();
        DoSomething();
    }

    private static void MakePerson()
    {
        var p = new Person("Bob");
        _people.Add(p);
    }

    private static void DoSomething()
    {
        // more processing
         Console.WriteLine("done");
    }
}
```

`DoSomething()``Person`メソッド`Person`の名前を確認するには、[**ウォッチ]** ウィンドウでオブジェクト ID への参照を追加します。

1. オブジェクトの作成後に、コードに`Person`ブレークポイントを設定します。

1. デバッグを開始します。

1. ブレークポイントで実行が一時停止したら **、[Windows ローカルの****デバッグ** > **Windows** > ] を選択して [ローカル] ウィンドウ**を**開きます。

1. [**ローカル**] ウィンドウで変数を`Person`右クリックし、[**オブジェクト ID の作成**] を選択します。

   [**ローカル]** ウィンドウには、**$** オブジェクト ID であるドル記号 ( ) と数値が表示されます。

1. オブジェクト ID を右クリックし、[ウォッチの追加] を選択して、[**ウォッチ**] ウィンドウにオブジェクト ID を**追加**します。

1. メソッドに別のブレークポイント`DoSomething()`を設定します。

1. デバッグを続行します。 メソッド内で実行が一時停止すると、**ウォッチ**ウィンドウに`Person`オブジェクトが表示されます。 `DoSomething()`

   > [!NOTE]
   > `Person.Name`などのオブジェクトのプロパティを表示するには、[**ツール** > **オプション] [** > **全般をデバッグする** > **全般** > **] プロパティ評価およびその他の暗黙的な関数呼び出しを選択して、プロパティの評価を有効**にする必要があります。

## <a name="dynamic-view-and-the-watch-window"></a>動的ビューとウォッチ ウィンドウ

一部のスクリプト言語 (JavaScript や Python など) では動的または[アヒル](https://en.wikipedia.org/wiki/Duck_typing)の型指定が使用され、.NET バージョン 4.0 以降では、通常のデバッグ ウィンドウで観察が困難なオブジェクトがサポートされています。

[**ウォッチ]** ウィンドウには、これらのオブジェクトが動的オブジェクトとして表示され、インターフェイスを<xref:System.Dynamic.IDynamicMetaObjectProvider>実装する型から作成されます。 動的オブジェクト ノードは動的オブジェクトの動的メンバーを表示しますが、メンバー値の編集はできません。

**動的ビュー**の値を更新するには、動的オブジェクトノードの横にある[更新アイコン](#bkmk_refreshWatch)を選択します。

オブジェクトの**動的ビュー**のみを表示するには、[**ウォッチ]** ウィンドウで**動的**オブジェクト名の後に動的書式指定子を追加します。

- C# の場合: `ObjectName, dynamic`
- Visual Basic の場合: `$dynamic, ObjectName`

>[!NOTE]
>- C# デバッガーは、コードの次の行にステップ実行するときに**動的ビュー**の値を自動的に再評価しません。
>- Visual Basic デバッガーは **、動的ビュー**を使用して追加された式を自動的に更新します。
>- **動的ビュー**のメンバーを評価すると、[副作用](https://en.wikipedia.org/wiki/Side_effect_\(computer_science\))が発生する場合があります。

**オブジェクトを動的オブジェクトにキャストする新しいウォッチ変数を挿入するには、次の手順を実行します。**

1. **動的ビュー**の任意の子を右クリックします。
1. [**ウォッチの追加] を**クリックします。 が`object.name`表示`((dynamic) object).name`され、新しい**ウォッチ**ウィンドウに表示されます。

デバッガーは、オブジェクトの**動的ビュー**の子ノードを **[自動変数**] ウィンドウにも追加します。 **[自動**変数] ウィンドウを開くには、デバッグ中に **[Windows** > **の自動**処理を**デバッグ** > ] を選択します。

**動的ビュー**は、COM オブジェクトのデバッグも強化します。 デバッガーが**System.__ComObject**にラップされた COM オブジェクトに到達すると、そのオブジェクトの**動的ビュー**ノードが追加されます。

## <a name="observe-a-single-variable-or-expression-with-quickwatch"></a>クイックウォッチで単一の変数または式を観察する

1 つの変数を観察するには **、クイック ウォッチ**を使用できます。

たとえば、次のコードの場合を考えます。

```csharp
static void Main(string[] args)
{
    int a, b;
    a = 1;
    b = 2;
    for (int i = 0; i < 10; i++)
    {
        a = a + b;
    }
}
```

変数を観察`a`するには、

1. `a = a + b;` の行にブレークポイントを設定します。

1. デバッグを開始します。 実行はブレークポイントで一時停止します。

1. コード内の`a`変数を選択します。

1. [**Debug** > **クイック ウォッチのデバッグ]** を選択するか **、Shift**+**F9**キーを押すか、右クリックして [**クイック ウォッチ**] を選択します。

   **[クイック ウォッチ]** ダイアログボックスが表示されます。 変数`a`は [**式**] ボックスの**値**が 1 の**値**です。

   ![クイックウォッチ変数](../debugger/media/quickwatchvariable.png "クイックウォッチ変数")

1. 変数を使用して式を評価するには、[**式**] ボックス`a + b`に式などを入力し、[**再評価**] を選択します。

   ![クイックウォッチ式](../debugger/media/quickwatchexpression.png "クイックウォッチ式")

1. **[ウォッチ] ウィンドウに [クイック ウォッチ]** から変数または式を追加するには、[**ウォッチ**の**追加]** を選択します。

1. [**閉じる]** を選択して **、[クイックウォッチ**]ウィンドウを閉じます。 (**クイック ウォッチ**はモーダル ダイアログなので、開いている限りデバッグを続行できません)。

1. デバッグを続行します。 [ウォッチ] ウィンドウで変数を**確認**できます。

## <a name="see-also"></a>関連項目
- [デバッグとは](../debugger/what-is-debugging.md)
- [デバッグの技術とツール](../debugger/write-better-code-with-visual-studio.md)
- [まずデバッグを見る](../debugger/debugger-feature-tour.md)
- [デバッガー ウィンドウ](../debugger/debugger-windows.md)
