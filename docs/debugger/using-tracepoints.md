---
title: トレースポイントを使用して情報を記録する | Microsoft Docs
ms.date: 10/28/2019
ms.topic: how-to
helpviewer_keywords:
- tracepoints, about tracepoints
author: Sagar-S-S
ms.author: sashe
manager: AndSter
ms.workload:
- multiple
ms.openlocfilehash: 33b471122318038ab66bc4f73e437209c6da2ffe
ms.sourcegitcommit: d3bca34f82de03fa34ecdd72233676c17fb3cb14
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/22/2020
ms.locfileid: "89561339"
---
# <a name="log-info-to-the-output-window-using-tracepoints-in-visual-studio"></a>Visual Studio のトレースポイントを使用して出力ウィンドウに情報を記録する

トレースポイントを使用すると、コードの変更や停止を行うことなく、構成可能な条件の下で出力ウィンドウに情報を記録できます。 この機能は、マネージド言語 (C#、Visual Basic、F#) とネイティブ コードの両方と、JavaScript や Python などの言語でサポートされています。

## <a name="let39s-take-an-example"></a>例を見てみましょう

次のサンプル プログラムは、ループで新しい繰り返しが実行されるたびに 1 ずつ増加するカウンター変数を持つ単純な `for` ループです。

![カウンターの例](../debugger/media/counterexample.png "カウンターの例")

## <a name="set-tracepoints-in-source-code"></a>ソース コードでトレースポイントを設定する

トレースポイントを設定するには、 **[ブレークポイント設定]** ウィンドウの **[アクション]** チェックボックスで出力文字列を指定します。

1. トレースポイントを初期化するには、まずトレースポイントを設定する行番号の左側にある余白をクリックします。

   ![ブレークポイントの初期化](../debugger/media/breakpointinitialization.png "ブレークポイントの初期化")

2. 赤い円の上にマウス ポインターを移動し、歯車アイコンをクリックします。
3. **[ブレークポイント設定]** ウィンドウが開きます。

   ![ブレークポイント ウィンドウ](../debugger/media/breakpointwindow.png "ブレークポイント ウィンドウ")

4. **[アクション]** チェックボックスをオンにします。

   ![オンの [アクション] ボックス](../debugger/media/checkedactionsbox.png "オンの [アクション] ボックス")

   赤い円がひし形に変わり、ブレークポイントからトレースポイントに切り替わったことが示されます。

5. 記録するメッセージを **[出力ウィンドウにメッセージを表示します]** テキスト ボックスに入力します (詳細については、この記事の後半のセクションを参照してください)。

   これでトレースポイントが設定されました。 出力ウィンドウに情報を記録するだけの場合は、&quot;[閉じる]&quot; ボタンを押します。

6. メッセージが表示されるかどうかを決定する条件を追加する場合は、 **[条件]** チェックボックスを選択します。

   ![オンの [条件] ボックス](../debugger/media/checkedconditionsbox.png "オンの [条件] ボックス")

   条件には 3 つの選択肢があります。 **[条件式]** 、 **[フィルター]** 、 **[ヒット カウント]** です。

## <a name="actions-menu"></a>[アクション] メニュー

このメニューを使用すると、出力ウィンドウにメッセージを記録できます。 出力する文字列をメッセージ ボックスに入力します (引用符は必要ありません)。 変数の値を表示する場合は、中かっこで囲んでください。

たとえば、出力コンソールに `counter` 変数の値を表示する場合は、メッセージ ボックスに「{counter}」と入力します。

![カウンターの出力メッセージ](../debugger/media/counteroutputmessage.png "カウンターの出力メッセージ")

**[閉じる]** をクリックしてプログラムをデバッグすると ( **F5** キー)、出力ウィンドウに次の出力が表示されます。

![出力ウィンドウのアクション メッセージ](../debugger/media/actionsmessageinoutputwindow.png "出力ウィンドウのアクション メッセージ")

特別なキーワードを使用して、より具体的な情報を表示することもできます。 次のようにキーワードは正確に入力してください (各キーワードの前に "$" を使用し、キーワード自体にはすべて大文字を使用します)。

| キーワード | 表示される内容 |
| --- | --- |
| $ADDRESS | 現在の命令 |
| $CALLER | 関数名の呼び出し |
| $CALLSTACK | [呼び出し履歴] |
| $FUNCTION | 現在の関数名 |
| $PID | プロセス ID |
| $PNAME | プロセス名 |
| $TID | スレッド ID |
| $TNAME   | スレッド名 |
| $TICK | ティック数 (Windows GetTickCount から) |

## <a name="conditions-menu"></a>[条件] メニュー

[条件] を使用すると、特定のシナリオでのみ表示されるように出力メッセージをフィルター処理できます。 使用できる条件には、主に 3 つの種類があります。

### <a name="conditional-expression"></a>条件式
条件式の場合、特定の条件が満たされた場合にのみ出力メッセージが表示されます。

条件式の場合、特定の条件が true の場合または変更された場合にメッセージを出力するようにトレースポイントを設定できます。 たとえば、`for` ループの繰り返し中でもカウンターの値のみを表示する場合は、 **[true の場合]** オプションをオンにして、メッセージ テキスト ボックスに「`i%2 == 0`」と入力します。

![条件式の [true の場合]](../debugger/media/conditionalexpressionistrue.png "条件式の [true の場合]")

`for`ループの繰り返しが変更されたときにカウンターの値を出力する場合は、 **[変更された場合]** オプションをオンにして、メッセージ テキスト ボックスに「`i`」と入力します。

![条件式の [変更された場合]](../debugger/media/conditionalexpressionwhenchanged.png "条件式の [変更された場合]")

**[変更された場合]** オプションの動作は、プログラミング言語によって異なります。

- ネイティブ コードの場合、デバッガーでは条件の最初の評価が変更と見なされないため、最初の評価ではトレースポイントにヒットしません。
- マネージド コードの場合、デバッガーでは、 **[変更された場合]** がオンにされた後の最初の評価で、トレースポイントにヒットします。

条件を設定する際に使用できる有効な式の詳細については、[デバッガーの式](expressions-in-the-debugger.md)に関するページを参照してください。

### <a name="hit-count"></a>ヒット カウント
ヒット カウント条件を使用すると、トレースポイントが設定されているコード行が指定された回数実行された後にのみ、出力を送信できます。

ヒット カウントの場合、トレースポイントが設定されているコード行が、指定されたヒット カウント値と等しいか、その倍数か、またはそれ以上の回数実行されたときにメッセージを出力するように選択できます。 ニーズに最適なオプションを選択し、対象の繰り返しを表す整数値 (たとえば、5) をフィールドに入力します。

![条件式の [ヒット カウント]](../debugger/media/conditionalexpressionhitcount.png "条件式の [ヒット カウント]")

### <a name="filter"></a>フィルター
フィルター条件について、表示するデバイス、プロセス、またはスレッドの出力を指定します。

![条件式の [フィルター]](../debugger/media/conditionalexpressionfilter.png "条件式の [フィルター]")

フィルター式の一覧:

- MachineName = "name"
- ProcessId = value
- ProcessName = "name"
- ThreadId = value
- ThreadName = "name"

文字列 (名前など) は二重引用符で囲みます。 値は、引用符なしで入力できます。 句は、`&` (`AND`)、`||` (`OR`)、`!` (`NOT`) を使用して結合できます。

## <a name="considerations"></a>注意事項

トレースポイントは、デバッグをよりクリーンでスムーズなエクスペリエンスにすることを目的としていますが、使用する場合に注意する必要がある考慮事項がいくつかあります。

オブジェクトのプロパティまたは属性を検査すると、その値が変わる場合があります。 検査中に値が変化した場合、それはトレースポイント機能自体が原因のバグではありません。 ただし、トレースポイントを使用してオブジェクトを検査しても、このような偶発的な変更は避けられません。

**[アクション]** メッセージ ボックスで式が評価される方法は、その時点で開発に使用している言語と異なる場合があります。 たとえば、文字列を出力するために、通常は `Debug.WriteLine()` または `console.log()` を使用している場合でも、メッセージを引用符で囲む必要はありません。 また、出力式の中かっこ構文 (`{ }`) は、開発言語で値を出力する場合の規則とは異なることがあります (ただし、中かっこ (`{ }`) 内の内容は、開発言語の構文を使用して記述する必要があります)。

ライブ アプリケーションをデバッグしていて、同様の機能を探している場合は、スナップショット デバッガーのログポイント機能を確認してください。 スナップショット デバッガーは、運用アプリケーションの問題を調査するために使用されるツールです。 また、ログポイントを使用すると、ソース コードを変更することなく、また実行中のアプリケーションに影響を与えることなく、出力ウィンドウにメッセージを送信することができます。 詳細については、[ライブ Azure アプリケーションのデバッグ](../debugger/debug-live-azure-applications.md)に関するページを参照してください。

## <a name="see-also"></a>関連項目

- [デバッグとは](../debugger/what-is-debugging.md)
- [Visual Studio を使用してより良い C# コードを作成する](../debugger/write-better-code-with-visual-studio.md)
- [デバッグの概要](../debugger/debugger-feature-tour.md)
- [デバッガー内の式](expressions-in-the-debugger.md)
- [ブレークポイントの使用](../debugger/using-breakpoints.md)
- [ライブ Azure アプリケーションをデバッグする](../debugger/debug-live-azure-applications.md)
