---
title: プログラム エラーの修正とコードの改善
description: この記事では、Visual Studio を使用して、ユーザーがビルド エラー、コード分析、デバッグ ツール、単体テストなどのコードの問題を見つけて修正しやすくできる、基本的な方法について説明します。
ms.date: 05/02/2018
ms.prod: visual-studio-dev15
ms.technology: vs-ide-general
ms.topic: conceptual
ms.assetid: c3a14d28-d811-4ff3-bd09-21dce14025ca
author: gewarren
ms.author: gewarren
manager: douge
ms.workload:
- multiple
ms.openlocfilehash: 148d839ccfac7b3a8fb9b75ba4d7e1f632cb5676
ms.sourcegitcommit: 935e341a02dba1c2aa3b6e89469388aa6e626f7f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/20/2018
ms.locfileid: "53684822"
---
# <a name="make-code-work-in-visual-studio"></a>Visual Studio でコードを機能させる

Visual Studio は、プロジェクトのビルドとデバッグ ツールの強力な統合セットを提供します。 この記事では、Visual Studio でビルド出力、コード分析、デバッグ ツール、単体テストを使用して、コードの問題を見つけるために役立つ方法について確認します。

エディターを理解して、コードをいくつか作成しました。 ここで、コードが適切に動作するかを確認する必要があります。 ほとんどの IDE と同じように、Visual Studio には、コードを機能させるために 2 つのデバッグ フェーズがあります。1 つは、コードをビルドして、プロジェクト エラーとコンパイラ エラーをキャッチして解決するフェーズです。もう 1 つは、コードを実行し、実行時エラーと動的エラーを確認するフェーズです。

## <a name="build-your-code"></a>コードをビルドする

ビルドの構成には、**デバッグ**および**リリース**という 2 つの基本的な種類があります。 **デバッグ**構成では、より低速で大きな実行可能ファイルが生成され、対話型の実行時デバッグ機能はより豊富になります。 **デバッグ**の実行可能ファイルが出荷されることはありません。 **リリース**構成のビルドはより高速で、最適化された実行可能ファイルです。(少なくともコンパイラの観点から) このビルドが出荷に適しています。 既定のビルド構成は、**デバッグ**です。

プロジェクトをビルドする最も簡単な方法は **F7** キーを押す方法ですが、メイン メニューから **[ビルド]** > **[ソリューションのビルド]** を選択してビルドを開始することもできます。

![Visual Studio ビルド プロジェクト メニューの選択](../ide/media/vs_ide_gs_debug_build_menu_item.png)

ビルド プロセスは、Visual Studio UI の下部にある **[出力]** ウィンドウで監視できます。 エラー、警告、ビルド操作がここに表示されます。 エラーがあると (または構成されたレベルより上の警告があると)、ビルドは失敗します。 エラーと警告をクリックすると、それが発生した行に移動できます。 **F7** キーをもう一度押すか (エラーがあるファイルのみを再コンパイルする場合)、**Ctrl** + **Alt** + **F7** キーを押して (クリーンかつ完全な再ビルドの場合)、プロジェクトを再ビルドします。

エディターの下の結果ウィンドウに 2 つのタブ付きウィンドウが表示されます。1 つは **[出力]** ウィンドウで、このウィンドウには生のコンパイラの出力が表示されます (エラー メッセージを含む)。もう 1 つは **[エラー一覧]** ウィンドウで、このウィンドウにはすべてのエラーと警告の、ソートおよびフィルターが可能な一覧が表示されます。

ビルドが成功すると、**[出力]** ウィンドウに次のような結果が表示されます。

![Visual Studio の成功したビルドの出力](../ide/media/vs_ide_gs_debug_success_build.png)

## <a name="review-the-error-list"></a>エラー一覧の確認

前にコンパイルが成功したコードに変更を加えた場合、エラーが出ることが少なくありません。 コーディングに不慣れな場合には、その可能性が高くなります。 エラーは、単純な構文エラーや変数名の間違いのようにわかりやすいものもあれば、手がかりが暗号のようなコードしかないようなわかりにくい場合もあります。 問題を見やすくするには、**[出力]** ウィンドウの下部に移動し、**[エラー一覧]** タブをクリックします。これにより、プロジェクトのエラーと警告がより整理されて見やすくなり、いくつかの追加オプションも表示されます。

![Visual Studio の出力とエラー一覧](../ide/media/vs_ide_gs_debug_bad_build_error_list.png)

**[エラー一覧]** ウィンドウのエラー行をクリックし、エラーが発生した行にジャンプします。 (右上の **[クイック起動]** バーをクリックし、そこに "行番号" を入力し、**Enter** キーを押して、行番号をオンにします。 これは、**[オプション]** ダイアログを表示する最も簡単な方法です。そのダイアログで行番号をオンにすることができます。 **[クイック起動]** バーの使用について学ぶと、UI をクリックする回数を減らすことができます。)

![Visual Studio の行番号を含むエディター](../ide/media/vs_ide_gs_debug_line_numbers.png)

![Visual Studio の行番号オプション](../ide/media/vs_ide_gs_debug_options_line_numbers.png)

**Ctrl**+**G** キーを押すと、エラーが発生した行番号にすぐにジャンプできます。

エラーは、赤い "波線" の下線によって示されます。 その上に移動すると、追加の詳細が表示されます。 修正を加え (これによって新たなエラーが入り込む可能性はあります)、別の場所に移動します。 (これを "回帰" と呼びます。)

![Visual Studio のエラー ホバー](../ide/media/vs_ide_gs_debug_error_hover1.png)

エラー一覧を確認し、コード内のすべてのエラーを解決します。

![Visual Studio の [デバッグ エラー] ウィンドウ](../ide/media/vs_ide_gs_debug_error_list.png)

### <a name="review-errors-in-detail"></a>エラーの詳細の確認

コンパイラの観点からすると、多くのエラーはあまり意味がない可能性があります。 その場合、追加情報が必要です。 **[エラー一覧]** ウィンドウから Bing の自動検索を実行して、エラーまたは警告の詳細を取得することができます。 該当する入力行を右クリックしてコンテキスト メニューから **[エラーのヘルプを表示]** を選択するか、**[エラー一覧]** の **[コード]** 行でハイパーリンクされたエラー コードの値をクリックします。

![Visual Studio のエラー一覧の Bing 検索](../ide/media/vs_ide_gs_debug_error_list_error_help.png)

設定によって、Web ブラウザーでエラー コードとテキストの検索結果が表示されるか、または Visual Studio 内でタブが開いて Bing 検索の結果が表示されます。 インターネット上の異なるさまざまなソースからの結果を入手できますが、すべてが役立つ情報であるとは限りません。

## <a name="use-code-analysis"></a>コード分析の使用

コード アナライザーで、コード管理で実行時エラーまたは問題を引き起こす可能性がある、一般的なコードの問題を探します。

### <a name="c-and-visual-basic-code-analysis"></a>C# と Visual Basic コードの分析

Visual Studio 2017 には、入力したときに C# と Visual Basic のコードを検証する、組み込みの [.NET Compiler Platform アナライザー](../code-quality/roslyn-analyzers-overview.md)のセットが含まれます。 Visual Studio 拡張機能、または NuGet パッケージとして、追加のアナライザーをインストールできます。 規則違反が見つかった場合は、コード エディターで問題のあるコードの下に波線として報告され、**[エラー一覧]** にも報告されます。

### <a name="c-code-analysis"></a>C++ コードの分析

C++ コードを分析するには、[静的コード分析](../code-quality/quick-start-code-analysis-for-c-cpp.md)を実行します。 正常なビルドの妨げとなる明らかなエラーをクリーンアップしたら、静的コード分析を実行することを習慣づけてください。それによって生成される可能性がある警告に対処するための時間を取ってください。 将来の頭痛の種を取り除き、コード スタイルの手法をいくらか学ぶことができます。

**Alt** + **F11** キーを押して (または、上部のメニューから **[分析]** > **[ソリューションでコード分析を実行]** を選択して)、静的コード分析を開始します。

![Visual Studio コード分析のメニュー項目](../ide/media/vs_ide_gs_debug_run_code_analysis.png)

新しい警告または更新された警告があれば、IDE 下部の **[エラー一覧]** タブに表示されます。 警告をクリックすると、コード内の警告にジャンプします。

![Visual Studio の警告を含むエラー一覧](../ide/media/cpp-code-analysis-warning.png)

## <a name="use-light-bulbs-to-fix-or-refactor-code"></a>電球を使用したコードの修正またはリファクタリング

電球またはねじ回しアイコンから使用できる[クイック アクション](../ide/quick-actions.md)では、コードをインラインでリファクタリングできます。 これは、C#、C++、Visual Basic コードで一般的な警告を迅速かつ効率的に修正する簡単な方法です。 アクセスするには、警告の波線を右クリックして **[Quick Actions and refactorings]\(クイック アクションとリファクタリング\)** を選択します。 または、カーソルが色付きの波線のある行にある場合に、**Ctrl**+ **キーを押します。** もしくは、余白にある電球またはねじ回しアイコンを選択します。 そのコード行に適用できる修正またはリファクタリングの一覧が表示されます。

![Visual Studio 電球のプレビュー](../ide/media/quick-actions-options.png)

クイック アクションは、コード アナライザーが、コードの修正、リファクタリング、改善の機会があると判断したときにいつでも使用できます。 任意のコード行をクリックし、右クリックしてコンテキスト メニューを開き、**[Quick Actions and refactorings]\(クイック アクションとリファクタリング\)** を選択します。 リファクタリングまたは改善オプションを利用できる場合は、オプションが表示されます。 それ以外の場合は、"**クイック アクションはここでは使用できません**" というメッセージが、IDE の左下隅に表示されます。

![クイック アクションが使用できないというテキスト](../ide/media/vs_ide_gs_debug_light_bulb_no_options.png)

慣れてくれば、すばやく矢印キーと **Ctrl** + **.** キー を使用して、リファクタリング機会を簡単にチェックし、コードをクリーンアップできます。

## <a name="debug-your-running-code"></a>実行されているコードのデバッグ

これでコードが正常にビルドされ、クリーンアップが実行されたので、次に、**F5** キーを押すか **[デバッグ]** > **[デバッグの開始]** を選択してコードを実行します。 これにより、デバッグ環境でアプリが開始され、その動作を詳しく監視できるようになります。 Visual Studio IDE は、アプリの実行中に変更されます。**[出力]** ウィンドウは、2 つの新しいウィンドウに置き換えられます (既定のウィンドウ構成)。その 1 つは **[自動変数/ローカル/ウォッチ]** タブ付きウィンドウで、もう 1 つは **[呼び出し履歴/ブレークポイント/例外設定/出力]** タブ付きウィンドウです。 これらのウィンドウには複数のタブがあり、そのタブでアプリの変数、スレッド、呼び出し履歴、その他さまざまな動作を実行と同時に調べ、評価することができます。

![Visual Studio の自動変数ウィンドウと呼び出し履歴ウィンドウ](../ide/media/vs_ide_gs_debug_autos_and_call_stack.png)

**Shift** + **F5** キーを押すか、**[停止]** ボタンをクリックして、アプリを停止します。 あるいは、単にアプリのメイン ウィンドウ (またはコマンド ライン ダイアログ) を閉じます。

コードが完璧に、予想通りに実行されれば、成功です。 ただし、ハングまたはクラッシュする場合、あるいは予期しない結果になる場合、問題の原因を見つけ、バグを修正する必要があります。

### <a name="set-simple-breakpoints"></a>単純なブレークポイントの設定

[ブレークポイント](../debugger/using-breakpoints.md)は、信頼できるデバッグの最も基本的で重要な機能です。 ブレークポイントは、Visual Studio が実行コードを中断する場所を示します。これにより、変数の値またはメモリの動作を確認したり、コードの分岐が実行されるかどうかを確認したりすることができます。 ブレークポイントを設定して削除した後、プロジェクトを再ビルドする必要はありません。

中断させたい場所の行の外側の余白をクリックするか、**F9 キー**を押して、コードの現在の行にブレークポイントを設定します。 コードを実行すると、このコード行の命令が実行される前に一時停止 (*中断*) します。

![Visual Studio のブレークポイント](../ide/media/vs_ide_gs_debug_breakpoint1.png)

ブレークポイントの一般的な使用は、次のとおりです。

- クラッシュまたはハングの原因を絞り込むために、失敗の原因になっていると思われるメソッド呼び出しのコード全体またはその周辺にブレークポイントを散布します。 デバッガーでコードを実行するときは、問題の原因になっているコード行が見つかるまで、そこに近づくよう、コードのブレークポイントを削除してリセットしていきます。 デバッガーでコードを実行する方法については、次のセクションを参照してください。

- 新しいコードを導入するときに、その先頭にブレークポイントを設定し、コードを実行し、予想どおり動作するかを確かめます。

- 複雑な動作を実装している場合は、プログラムが中断したときに変数の値やデータを調べることができるよう、アルゴリズムのコードに対してブレークポイントを設定します。

- C または C++ コードを作成している場合、ブレークポイントを使用してコードを停止します。これにより、メモリに関連した障害をデバッグするときに、アドレス値 (NULL の検索) および参照カウントを調べることができます。

ブレークポイントの詳細については、[ブレークポイントの使用](../debugger/using-breakpoints.md)に関するページを参照してください。

### <a name="inspect-your-code-at-run-time"></a>実行時のコードの検査

実行中のコードがブレークポイントに達して一時停止するとき、黄色でマークされたコード行 (現在のステートメント) はまだ実行されていません。 この時点で、現在のステートメントを実行し、変更された値を確認することができます。 いくつかの*ステップ* コマンドを使用して、デバッガーでコードを実行することができます。 マークされているコードがメソッド呼び出しの場合、**F11 キー**を押してステップ インすることができます。 **F10 キー**を押して、コード行を "*ステップ オーバー*" することもできます。 コードをステップ実行するその他のコマンドと詳細については、「[Navigate code with the debugger](../debugger/navigating-through-code-with-the-debugger.md)」(デバッガーによるコードの操作) を参照してください。

![Visual Studio の実行時の値の検査](../ide/media/vs_ide_gs_debug_hit_breakpoint.png)

前の図では、**F10 キー**または **F11 キー**を押してデバッガーの 1 つのステートメントを進めることができます (この例ではメソッドの呼び出しがないため、両方のコマンドが同じ結果になります)。

デバッガーが一時停止されている間は、変数と呼び出し履歴を調べ、内容を確認することができます。 範囲内の値は、予期していたとおりのものですか。 呼び出しの順序は正しいですか。

![Visual Studio の実行時の値の検査](../ide/media/vs_ide_gs_debug_inspect_value.png)

変数の上にマウス カーソルを移動して、変数の現在の値と参照を表示します。 表示される値が予期していたものと異なる場合、先行するコードまたは呼び出しているコードにバグがある可能性があります。 デバッグ情報の詳細については、[デバッガーの使用方法](../debugger/debugger-feature-tour.md)に関するページを参照してください。

さらに、Visual Studio では **[診断ツール]** ウィンドウが表示されます。このウィンドウで、時間の経過に伴うアプリの CPU 使用率とメモリ使用量の変化を監視できます。 後でアプリケーションの開発時に、CPU 使用量やメモリの割り当てが予想外に多くなった場合に、これらのツールを使用して調べることができます。 これを **[ウォッチ]** ウィンドウおよびブレークポイントとともに使用して、予期していなかった多量の使用の原因となっているもの、または解放されていないリソースを特定します。 詳細については、「[プロファイリング機能ツアー](../profiling/profiling-feature-tour.md)」を参照してください。

## <a name="run-unit-tests"></a>単体テストを実行する

単体テストは、コードのバグに対する保護の最前線です。単体テストを正しく実行すると、コードの単一の "ユニット" (通常は 1 つの関数) がテストされるので、プログラム全体をデバッグするよりも簡単です。 Visual Studio は、マネージド コードおよびネイティブ コード用の Microsoft 単体テスト フレームワークをインストールします。 単体テスト フレームワークを使用して、単体テストを作成して実行し、そのテストの結果を報告します。 変更を加えたときは単体テストを再実行し、コードが正しく機能するかテストします。 Visual Studio Enterprise Edition を使用すると、ビルドの後でテストを自動的に実行できます。

最初に、「[IntelliTest でのコードの単体テストの生成](../test/generate-unit-tests-for-your-code-with-intellitest.md)」をお読みください。

Visual Studio の単体テストの詳細、およびより優れた品質のコードの作成に単体テストがどのように役立つかについては、「[単体テストの基本](../test/unit-test-basics.md)」をお読みください。

## <a name="see-also"></a>関連項目

- [デバッガー機能ツアー](../debugger/debugger-feature-tour.md)
- [デバッガーの使用方法の詳細](../debugger/debugger-feature-tour.md)
- [コードを生成し、修正する](../ide/code-generation-in-visual-studio.md)