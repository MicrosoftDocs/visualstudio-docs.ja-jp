---
title: "チュートリアル: サイトのカスタム ワークフロー アクティビティの作成 | Microsoft Docs"
ms.custom: ""
ms.date: "02/02/2017"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "office-development"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "VB"
  - "CSharp"
  - "VB"
  - "CSharp"
helpviewer_keywords: 
  - "カスタム ワークフロー アクティビティ [Visual Studio での SharePoint 開発]"
  - "Visual Studio での SharePoint 開発, カスタム ワークフロー アクティビティ"
  - "Visual Studio での SharePoint 開発, サイト ワークフロー"
  - "サイト ワークフロー [Visual Studio での SharePoint 開発]"
  - "ワークフロー アクティビティ [Visual Studio での SharePoint 開発]"
ms.assetid: 8219a779-c27b-4186-92c9-5bda03328aa9
caps.latest.revision: 20
author: "kempb"
ms.author: "kempb"
manager: "ghogen"
caps.handback.revision: 19
---
# チュートリアル: サイトのカスタム ワークフロー アクティビティの作成
  このチュートリアルでは、サイト レベルのワークフローに使用するカスタム アクティビティを [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)] で作成する方法について説明します。サイト レベルのワークフローは、サイト上のリストだけでなく、サイト全体に適用されます。カスタム アクティビティによって、バックアップのお知らせリストが作成され、そこにお知らせリストの内容がコピーされます。  
  
 このチュートリアルでは、次のタスクについて説明します。  
  
-   サイト レベルのワークフローを作成する。  
  
-   カスタム ワークフロー アクティビティを作成する。  
  
-   SharePoint リストを作成および削除する。  
  
-   リスト間で項目をコピーする。  
  
-   クイック起動バーにリストを表示する。  
  
 [!INCLUDE[note_settings_general](../sharepoint/includes/note-settings-general-md.md)]  
  
## 必須コンポーネント  
 このチュートリアルを実行するには、次のコンポーネントが必要です。  
  
-   サポート対象エディションの [!INCLUDE[TLA#tla_win](../sharepoint/includes/tlasharptla-win-md.md)] および SharePoint。  詳細については、「[SharePoint ソリューションの開発要件](../sharepoint/requirements-for-developing-sharepoint-solutions.md)」を参照してください。  
  
-   Visual Studio  
  
## サイトのカスタム ワークフロー アクティビティ プロジェクトの作成  
 まず、カスタム ワークフロー アクティビティを格納し、テストするプロジェクトを作成します。  
  
#### サイトのカスタム ワークフロー アクティビティ プロジェクトを作成するには  
  
1.  メニュー バーで、**\[新しいプロジェクト\]** ダイアログ ボックスを表示するには、**\[新規作成\]**、**\[プロジェクト\]\[ファイル\]** をクリックします。  
  
2.  **\[SharePoint\]** ノードを **\[Visual C\#\]** または **\[Visual Basic\]** で展開し、**2010** ノードを選択します。  
  
3.  **\[テンプレート\]** のペインで、**\[SharePoint 2010 プロジェクト\]** テンプレートを選択します。  
  
4.  **\[名前\]** ボックスに" AnnouncementBackup "と入力し、**\[OK\]** ボタンをクリックします。  
  
     **SharePoint カスタマイズ ウィザード**が表示されます。  
  
5.  **\[デバッグのサイトとセキュリティ レベルの指定\]** ページで、**\[ファーム ソリューションとして配置する\]** のオプション ボタンを選択し、信頼レベルと既定のサイトを受け入れるように **\[完了\]** ボタンをクリックします。  
  
     また、この段階で、ソリューションの信頼レベルがファーム ソリューション \(ワークフロー プロジェクトではこれ以外は選択できません\) として設定されます。  
  
6.  次に **\[ソリューション エクスプローラー\]** で、プロジェクト ノードを選択し、メニュー バーで、**\[プロジェクト\]** をクリックします、**\[新しいアイテムの追加\]** を選択します。  
  
7.  **\[Visual C\#\]** または **\[Visual Basic\]** で、**\[SharePoint\]** ノードを展開し、**2010** ノードを選択します。  
  
8.  **\[テンプレート\]** のペインで、**\[シーケンシャル ワークフロー \(ファーム ソリューションのみ\)\]** テンプレートを選択し、**\[追加\]** ボタンをクリックします。  
  
     **SharePoint カスタマイズ ウィザード**が表示されます。  
  
9. **\[デバッグのワークフロー名の指定\]** ページで、既定の名前 \(AnnouncementBackup \- Workflow1\) を受け入れます。  ワークフロー テンプレートの種類を **\[サイト ワークフロー\]** に変更し、**\[次へ\]** ボタンをクリックします。  
  
10. 残りの既定の設定を受け入れるように **\[完了\]** ボタンをクリックします。  
  
## カスタム ワークフロー アクティビティ クラスの追加  
 次に、カスタム ワークフロー アクティビティのコードを記述するためのクラスをプロジェクトに追加します。  
  
#### カスタム ワークフロー アクティビティ クラスを追加するには  
  
1.  メニュー バーで、**\[新しいアイテムの追加\]** ダイアログ ボックスを表示するには、**\[新しいアイテムの追加\]\[プロジェクト\]** をクリックします。  
  
2.  **\[インストールされているテンプレート\]** のツリー ビューで、**\[コード\]** ノードを選択し、プロジェクト項目テンプレートの一覧で **\[クラス\]** テンプレートを選択します。  既定の名前である Class1 を使用します。  **\[追加\]** ボタンをクリックします。  
  
3.  Class1 のすべてのコードを次のコードに置き換えます。  
  
     [!code-csharp[SP_AnnBackup#1](../snippets/csharp/VS_Snippets_OfficeSP/sp_annbackup/cs/class1.cs#1)]
     [!code-vb[SP_AnnBackup#1](../snippets/visualbasic/VS_Snippets_OfficeSP/sp_annbackup/vb/class1.vb#1)]  
  
4.  次に、プロジェクトを選択し、メニュー バーで保存し、**\[ソリューションのビルド\]\[ビルド\]** をクリックします。  
  
     Class1 が **\[AnnouncementBackup コンポーネント\]** タブの **\[ツールボックス\]** をカスタム動作として表示されます。  
  
## サイトのワークフローへのカスタム アクティビティの追加  
 次に、カスタム コードを含んだアクティビティをワークフローに追加します。  
  
#### サイトのワークフローにカスタム アクティビティを追加するには  
  
1.  ワークフロー デザイナーのデザイン ビューで Workflow1 を開きます。  
  
2.  `onWorkflowActivated1` アクティビティで表示し、Class1 のショートカット メニューを開き、**\[コピー\]** をクリックします、行のショートカット メニューを `onWorkflowActivated1` アクティビティで開き、**\[貼り付け\]** をクリックしますように **\[ツールボックス\]** の Class1 を。  
  
3.  プロジェクトを保存します。  
  
## サイトのカスタム ワークフロー アクティビティのテスト  
 次に、プロジェクトを実行して、サイトのワークフローを開始します。  カスタム アクティビティによって、バックアップのお知らせリストが作成され、そこに最新のお知らせリストの内容がコピーされます。  このコードは、バックアップ リストの作成前に、既存のバックアップ リストが存在するかどうかもチェックします。  既存のバックアップ リストが存在する場合は、それを削除します。  また、このコードは、SharePoint サイトのクイック起動バーに新しいリストへのリンクを追加します。  
  
#### サイトのカスタム ワークフロー アクティビティをテストするには  
  
1.  プロジェクトを実行し、SharePoint に配置するには、F5 キーを押します。  
  
2.  クイック起動バーに、SharePoint サイトで使用できるリストをすべて表示するに **\[リスト\]** リンクをクリックします。  **\[お知らせ\]**という名前のお知らせのリストが 1 つだけ表示されます。  
  
3.  SharePoint Web ページの一番上にある **\[サイト ワークフロー\]** リンクをクリックします。  
  
4.  新しいワークフローの開始セクションでは、**\[AnnouncementBackup – Workflow1\]** リンクをクリックします。  これで、サイトのワークフローが開始されて、カスタム動作のコードが実行されます。  
  
5.  クイック起動バーに、**\[お知らせのバックアップ\]** リンクをクリックします。  **\[お知らせ\]** ボックスにあるすべてのお知らせが、この新しいリストにコピーされていることがわかります。  
  
## 参照  
 [方法: イベント レシーバーを作成する](../sharepoint/how-to-create-an-event-receiver.md)   
 [Developing SharePoint Solutions](../sharepoint/developing-sharepoint-solutions.md)  
  
  