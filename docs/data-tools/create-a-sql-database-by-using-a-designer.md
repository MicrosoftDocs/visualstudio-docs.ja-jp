---
title: データベース ファイルを作成し、テーブル デザイナーを使用する
description: Visual Studio のテーブル デザイナーを使用して、データベースにテーブルと外部キーを追加する方法を説明するチュートリアル。 グラフィカル インターフェイスを使用してデータを追加する方法についても説明します。
ms.date: 09/19/2019
ms.topic: conceptual
helpviewer_keywords:
- database tables, creating
- database files, creating
- table designer
ms.assetid: 99c2b06f-47aa-414e-8057-a3453712fd23
author: ghogen
ms.author: ghogen
manager: jmartens
ms.workload:
- data-storage
ms.openlocfilehash: ed0df13f1dd281fcf56056809419af5d7ed6d3dc
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/08/2021
ms.locfileid: "99867205"
---
# <a name="create-a-database-and-add-tables-in-visual-studio"></a>Visual Studio でデータベースを作成し、テーブルを追加する

Visual Studio を使用して、SQL Server Express LocalDB のローカル データベース ファイルを作成および更新できます。 また、Visual Studio の **SQL Server オブジェクト エクスプローラー** ツール ウィンドウで Transact-SQL ステートメントを実行して、データベースを作成することもできます。 このトピックでは、 *.mdf* ファイルを作成し、テーブル デザイナーを使用してテーブルとキーを追加します。

## <a name="prerequisites"></a>必須コンポーネント

このチュートリアルを実行するには、Visual Studio にインストールされている **.NET デスクトップ開発** と **データの保存と処理** のワークロードが必要です。 これらをインストールするには、**Visual Studio インストーラー** を開き、変更する Visual Studio のバージョンの横にある **[変更]** (または **[その他]**  >  **[変更]** ) を選択します。

> [!NOTE]
> この記事の手順は、.NET Framework Windows フォーム プロジェクトにのみ適用され、.NET Core Windows フォーム プロジェクトには適用されません。

## <a name="create-a-project-and-a-local-database-file"></a>プロジェクトとローカル データベース ファイルを作成する

1. 新しい **Windows フォーム アプリ (.NET Framework)** プロジェクトを作成し、**SampleDatabaseWalkthrough** という名前を付けます。

2. メニュー バーで、 **[プロジェクト]**  >  **[新しい項目の追加]** の順に選択します。

3. 項目テンプレートの一覧で、下へスクロールし、 **[サービス ベースのデータベース]** を選択します。

   ![[アイテム テンプレート] ダイアログ ボックス](../data-tools/media/raddata-vsitemtemplates.png)

4. このデータベースに **SampleDatabase** という名前を付け、 **[追加]** をクリックします。

### <a name="add-a-data-source"></a>データ ソースの追加

1. **[データ ソース]** ウィンドウが開いていない場合は、**Shift** + **Alt** + **D** キーを押すか、メニュー バーで **[表示]**  >  **[その他のウィンドウ]**  >  **[データ ソース]** の順に選択して開きます。

1. **[データ ソース]** ウィンドウで、 **[新しいデータ ソースの追加]** を選択します。

   ![Visual Studio で新しいデータ ソースを追加する](media/add-new-data-source.png)

   **データ ソース構成ウィザード** が開きます。

1. **[データ ソースの種類の選択]** ページで、 **[データベース]** を選択し、 **[次へ]** を選択します。

1. **[データベース モデルの選択]** ページで、 **[次へ]** を選択して既定値 (データセット) を受け入れます。

1. **[データ接続の選択]** ページで、ドロップダウン リストから **SampleDatabase.mdf** ファイルを選択し、 **[次へ]** を選択します。

1. **[アプリケーション構成ファイルに接続文字列を保存]** ページで、 **[次へ]** を選択します。

1. **[データベース オブジェクトの選択]** ページに、データベースにオブジェクトが含まれていないことを示すメッセージが表示されます。 **[完了]** を選択します。

### <a name="view-properties-of-the-data-connection"></a>データ接続のプロパティを表示する

データ接続の [プロパティ] ウィンドウを開くと、*SampleDatabase.mdf* ファイルの接続文字列を表示できます。

- **[表示]**  >  **[SQL Server オブジェクト エクスプローラー]** の順に選択して、 **[SQL Server オブジェクト エクスプローラー]** ウィンドウを開きます。 **[(localdb)\MSSQLLocalDB]**  >  **[データベース]** の順に展開し、*SampleDatabase.mdf* を右クリックして、 **[プロパティ]** を選択します。

- または、 **[表示]**  >  **[サーバー エクスプローラー]** の順に選択することもできます (このウィンドウがまだ開いていない場合)。 **[データ接続]** ノードを展開して *SampleDatabase.mdf* を右クリックし、 **[プロパティ]** を選択して、[プロパティ] ウィンドウを開きます。

  > [!TIP]
  > [データ接続] ノードを展開できない場合、または SampleDatabase.mdf 接続が表示されていない場合は、サーバー エクスプローラーのツール バーの **[データベースへの接続]** ボタンを選択します。 **[接続の追加]** ダイアログ ボックスの **[データ ソース]** で、 **[Microsoft SQL Server データベース ファイル]** が選択されていることを確認し、SampleDatabase.mdf ファイルを参照して選択します。 **[OK]** を選択して、接続の追加を完了します。

## <a name="create-tables-and-keys-by-using-table-designer"></a>テーブル デザイナーを使用してテーブルとキーを作成する

このセクションでは、2 つのテーブル、各テーブルの主キー、サンプル データのいくつかの行を作成します。 また、外部キーを作成して、一方のテーブルのレコードがもう一方のテーブルのレコードにどのように対応するかを指定します。

### <a name="create-the-customers-table"></a>Customers テーブルを作成する

1. **サーバー エクスプローラー** で、 **[データ接続]** ノードを展開し、 **[SampleDatabase.mdf]** ノードを展開します。

   [データ接続] ノードを展開できない場合、または SampleDatabase.mdf 接続が表示されていない場合は、サーバー エクスプローラーのツール バーの **[データベースへの接続]** ボタンを選択します。 **[接続の追加]** ダイアログ ボックスの **[データ ソース]** で、 **[Microsoft SQL Server データベース ファイル]** が選択されていることを確認し、SampleDatabase.mdf ファイルを参照して選択します。 **[OK]** を選択して、接続の追加を完了します。

2. **[テーブル]** を右クリックし、 **[新しいテーブルの追加]** を選択します。

   [テーブル デザイナー] は、作成しているテーブルの 1 つの列を表す、1 つの既定の行のグリッドを開いて表示します。 行をグリッドに追加することによって、テーブルに列を追加します。

3. グリッドで、次のエントリのそれぞれに行を追加します。

   |列名|データ型|Null を許容|
   |-----------------|---------------|-----------------|
   |`CustomerID`|`nchar(5)`|false (オフ)|
   |`CompanyName`|`nvarchar(50)`|false (オフ)|
   |`ContactName`|`nvarchar (50)`|true (オン)|
   |`Phone`|`nvarchar (24)`|true (オン)|

4. `CustomerID` 行を右クリックし、 **[主キーの設定]** を選択します。

5. 既定の行 (`Id`) を右クリックし、 **[削除]** を選択します。

6. スクリプト ペインの最初の行の次のサンプルのように更新して、Customers (顧客) をテーブルと名前を付けます:

   ```sql
   CREATE TABLE [dbo].[Customers]
   ```

   次のような結果が表示されます。

   ![テーブル デザイナー (Table Designer)](../data-tools/media/table-designer.png)

7. **テーブル デザイナー** の左上隅にある **[更新]** を選択します。

8. **[データベース更新のプレビュー]** ダイアログ ボックスで、 **[データベースの更新]** を選択します。

   ローカル データベース ファイルに Customers テーブルが作成されます。

### <a name="create-the-orders-table"></a>Orders テーブルを作成する

1. 別のテーブルを追加し、次の表の各エントリの行を追加します。

   |列名|データ型|Null を許容|
   |-----------------|---------------|-----------------|
   |`OrderID`|`int`|false (オフ)|
   |`CustomerID`|`nchar(5)`|false (オフ)|
   |`OrderDate`|`datetime`|true (オン)|
   |`OrderQuantity`|`int`|true (オン)|

2. **OrderID** を主キーとして設定した後、既定の行を削除します。

3. スクリプト ペインの最初の行の次のサンプルのように更新して、Orders (注文) をテーブルと名前を付けます:

   ```sql
   CREATE TABLE [dbo].[Orders]
   ```

4. **テーブル デザイナー** の左上隅にある **[更新]** を選択します。

5. **[データベース更新のプレビュー]** ダイアログ ボックスで、 **[データベースの更新]** を選択します。

   ローカル データベース ファイルに Orders テーブルが作成されます。 サーバー エクスプローラーで **[テーブル]** ノードを展開すると、2 つのテーブルが表示されます。

   ![サーバー エクスプローラーで展開された [テーブル] ノード](media/server-explorer-tables-node.png)

### <a name="create-a-foreign-key"></a>外部キーを作成する

1. Orders テーブルのテーブル デザイナー グリッドの右側にあるコンテキスト ペインで、 **[外部キー]** を右クリックし、 **[新しい外部キーを追加]** を選択します。

   ![Visual Studio のテーブル デザイナーで外部キーを追加する](../data-tools/media/add-foreign-key.png)

2. 表示されるテキスト ボックスで、**ToTable** というテキストを **Customers** に置き換えます。

3. T-SQL ペインで、次のサンプルに合わせて最後の行を更新します。

   ```sql
   CONSTRAINT [FK_Orders_Customers] FOREIGN KEY ([CustomerID]) REFERENCES [Customers]([CustomerID])
   ```

4. **テーブル デザイナー** の左上隅にある **[更新]** を選択します。

5. **[データベース更新のプレビュー]** ダイアログ ボックスで、 **[データベースの更新]** を選択します。

   外部キーが作成されます。

## <a name="populate-the-tables-with-data"></a>テーブルにデータを読み込む

1. **サーバー エクスプローラー** または **SQL Server オブジェクト エクスプローラー** で、サンプル データベースのノードを展開します。

2. **[テーブル]** ノードのショートカット メニューを開き、 **[最新の情報に更新]** を選択した後、 **[テーブル]** ノードを展開します。

3. Customers テーブルのショートカット メニューを開き、 **[テーブル データの表示]** を選択します。

4. 数人の顧客に任意のデータを追加します。

    顧客 ID には任意の 5 文字を指定できます。この手順では、後で使用するために、少なくとも 1 つを選択します。

5. Orders テーブルのショートカット メニューを開き、 **[テーブル データの表示]** を選択します。

6. いくつかの注文のデータを追加します。

    > [!IMPORTANT]
    > すべての注文 ID および注文数量が整数であり、各顧客 ID が、Customers テーブルの **CustomerID** 列で指定した値と一致することを確認します。

7. メニュー バーで、 **[ファイル]**  >  **[すべてを保存]** の順に選択します。

## <a name="see-also"></a>関連項目

- [Visual Studio でのデータへのアクセス](accessing-data-in-visual-studio.md)
