---
title: 'CA1021: out パラメーターを使用しません'
ms.date: 11/04/2016
ms.topic: reference
f1_keywords:
- CA1021
- AvoidOutParameters
helpviewer_keywords:
- AvoidOutParameters
- CA1021
ms.assetid: 970f2304-842c-4fb7-9734-f3871da8d479
author: mikejo5000
ms.author: mikejo
manager: jillfra
ms.workload:
- multiple
ms.openlocfilehash: 579b04f26af972ac025b0bfc07bc8dc9eb636d12
ms.sourcegitcommit: 98421670ed0b8170aaa32d3d6f8681298f401a1d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/18/2020
ms.locfileid: "81638028"
---
# <a name="ca1021-avoid-out-parameters"></a>CA1021: out パラメーターを使用しません

|||
|-|-|
|TypeName|AvoidOutParameters|
|CheckId|CA1021|
|カテゴリ|マイクロソフトの設計|
|互換性に影響する変更点|あり|

## <a name="cause"></a>原因
パブリック型のパブリック メソッドまたはプロテクト メソッド`out`には、パラメーターがあります。

既定では、このルールは外部から参照できる型のみを検索しますが、これは[構成可能](#configurability)です。

## <a name="rule-description"></a>規則の説明
参照による型の渡し`out` `ref`(または ) を使用するには、ポインターの経験、値型と参照型の違い、および複数の戻り値を持つメソッドの処理が必要です。 また、パラメータとパラメータ`out`の`ref`違いは広く理解されていない。

参照型が "参照渡し" で渡される場合、メソッドはパラメーターを使用してオブジェクトの別のインスタンスを返します。 参照による参照型の受け渡しは、ダブル ポインター、ポインターへのポインター、またはダブル間接参照を使用する方法とも呼ばれます。 "値渡し" を渡す既定の呼び出し規約を使用すると、参照型を受け取るパラメーターは既にオブジェクトへのポインターを受け取ります。 ポインターは、ポインターが指すオブジェクトではなく、値によって渡されます。 値渡しは、メソッドが参照型の新しいインスタンスを指すポインターを変更できないことを意味します。 ただし、ポイントするオブジェクトの内容を変更することはできます。 ほとんどのアプリケーションでは、これで十分であり、目的の動作を生成します。

メソッドが別のインスタンスを返す必要がある場合は、メソッドの戻り値を使用してこれを実現します。 文字列を<xref:System.String?displayProperty=fullName>操作し、文字列の新しいインスタンスを返すさまざまなメソッドについては、クラスを参照してください。 このモデルを使用する場合、呼び出し元は元のオブジェクトが保持されているかどうかを判断する必要があります。

戻り値は一般的で頻繁に使用されますが、パラメータと`out``ref`の適切な適用には、中間設計とコーディングのスキルが必要です。 一般の聴衆のために設計する図書館のアーキテクトは、ユーザーが`out`作業`ref`やパラメータをマスターすることを期待すべきではありません。

## <a name="how-to-fix-violations"></a>違反の修正方法
値型によって引き起こされるこの規則違反を修正するには、メソッドに戻り値としてオブジェクトを返すようにします。 メソッドが複数の値を返す必要がある場合は、値を保持するオブジェクトの単一インスタンスを返すように再設計します。

参照型によって引き起こされるこの規則違反を修正するには、目的の動作が参照の新しいインスタンスを返すことを確認します。 この場合、メソッドは戻り値を使用してこれを行う必要があります。

## <a name="when-to-suppress-warnings"></a>警告を抑制する場合
この規則からの警告を抑制しても安全です。 ただし、この設計は、ユーザビリティの問題を引き起こす可能性があります。

## <a name="configurability"></a>構成可能の有無

このルールを[FxCop アナライザ](install-fxcop-analyzers.md)から実行している場合 (レガシ分析ではなく)、コードベースのどの部分でこのルールを実行するかは、そのアクセシビリティに基づいて設定できます。 たとえば、非パブリック API サーフェスに対してのみルールを実行するように指定するには、プロジェクトの .editorconfig ファイルに次のキーと値のペアを追加します。

```ini
dotnet_code_quality.ca1021.api_surface = private, internal
```

このオプションは、このルール、すべてのルール、またはこのカテゴリ (Design) のすべてのルールに対して構成できます。 詳細については、 [FxCop アナライザーの設定](configure-fxcop-analyzers.md)を参照してください。

## <a name="example"></a>例
次のライブラリは、ユーザーのフィードバックに対する応答を生成するクラスの 2 つの実装を示しています。 最初の実装`BadRefAndOut`( ) は、ライブラリ ユーザーに 3 つの戻り値を強制的に管理します。 2 番目の`RedesignedRefAndOut`実装 ( ) は、データを 1 つの単位`ReplyData`として管理するコンテナー クラス ( ) のインスタンスを返すことで、ユーザー エクスペリエンスを簡素化します。

[!code-csharp[FxCop.Design.NoRefOrOut#1](../code-quality/codesnippet/CSharp/ca1021-avoid-out-parameters_1.cs)]

## <a name="example"></a>例
次のアプリケーションは、ユーザーのエクスペリエンスを示しています。 再設計されたライブラリ (`UseTheSimplifiedClass`メソッド) の呼び出しは簡単で、メソッドから返される情報は簡単に管理できます。 2 つのメソッドからの出力は同じです。

[!code-csharp[FxCop.Design.TestNoRefOrOut#1](../code-quality/codesnippet/CSharp/ca1021-avoid-out-parameters_2.cs)]

## <a name="example"></a>例
次のライブラリ例では、参照`ref`型のパラメーターの使用方法を示し、この機能を実装する優れた方法を示します。

[!code-csharp[FxCop.Design.RefByRefNo#1](../code-quality/codesnippet/CSharp/ca1021-avoid-out-parameters_3.cs)]

## <a name="example"></a>例
次のアプリケーションは、ライブラリ内の各メソッドを呼び出して動作を示します。

[!code-csharp[FxCop.Design.TestRefByRefNo#1](../code-quality/codesnippet/CSharp/ca1021-avoid-out-parameters_4.cs)]

この例を実行すると、次の出力が生成されます。

```txt
Changing pointer - passed by value:
12345
12345
Changing pointer - passed by reference:
12345
12345 ABCDE
Passing by return value:
12345 ABCDE
```

## <a name="try-pattern-methods"></a>パターンメソッドを試す

### <a name="description"></a>説明
Try <xref:System.Int32.TryParse%2A?displayProperty=fullName> **\<Something>** パターンを実装するメソッドは、この違反を発生しません。 メソッドを実装する構造体 (値型) の例を<xref:System.Int32.TryParse%2A?displayProperty=fullName>次に示します。

### <a name="code"></a>コード
[!code-csharp[FxCop.Design.TryPattern#1](../code-quality/codesnippet/CSharp/ca1021-avoid-out-parameters_5.cs)]

## <a name="related-rules"></a>関連ルール
[CA1045: 型を参照によって渡しません](../code-quality/ca1045.md)
