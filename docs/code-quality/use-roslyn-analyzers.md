---
title: Analyzer ルールの重要度と抑制
ms.date: 03/26/2019
ms.topic: conceptual
helpviewer_keywords:
- code analysis, managed code
- analyzers
- Roslyn analyzers
author: gewarren
ms.author: gewarren
manager: jillfra
ms.workload:
- dotnet
ms.openlocfilehash: 6362d3f14065aaf9661e85266753642e4201ca48
ms.sourcegitcommit: 209ed0fcbb8daa1685e8d6b9a97f3857a4ce1152
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/16/2019
ms.locfileid: "69548038"
---
# <a name="use-code-analyzers"></a>コードアナライザーを使用する

.NET Compiler Platform ("Roslyn") コードアナライザーではC# 、入力に応じてコードまたは Visual Basic が分析されます。 各*診断*または規則には、プロジェクトで上書きできる既定の重大度と抑制状態があります。 この記事では、ルールの重要度の設定、ルールセットの使用、および違反の抑制について説明します。

## <a name="analyzers-in-solution-explorer"></a>ソリューションエクスプローラーのアナライザー

**ソリューションエクスプローラー**から、analyzer 診断のカスタマイズの多くを行うことができます。 アナライザーを NuGet パッケージとして[インストール](../code-quality/install-roslyn-analyzers.md)すると、**ソリューションエクスプローラー**の **[参照]** ノードまたは **[依存関係]** ノードの下に **[アナライザー]** ノードが表示されます。 [アナライザー]を展開してから、いずれかのアナライザーアセンブリを展開すると、アセンブリ内のすべての診断が表示されます。

![ソリューションエクスプローラーのアナライザーノード](media/analyzers-expanded-in-solution-explorer.png)

**[プロパティ]** ウィンドウでは、診断のプロパティや既定の重要度などを表示できます。 プロパティを表示するには、ルールを右クリックして **[プロパティ]** を選択するか、ルールを選択して、 **Alt**+キーを押します。

![プロパティウィンドウの診断プロパティ](media/analyzer-diagnostic-properties.png)

診断のオンラインドキュメントを表示するには、診断を右クリックし、 **[ヘルプの表示]** を選択します。

**ソリューションエクスプローラー**の各診断の横にあるアイコンは、エディターで開いたときにルールセットに表示されるアイコンに対応します。

- 円の "i" は**情報**の[重大度](#rule-severity)を示します。
- 三角形の "!" は**警告**の[重大度](#rule-severity)を示します。
- 円の "x" は**エラー**の[重大度](#rule-severity)を示します。
- 明るい色の背景にある円の "i" は、**非表示**の[重要度](#rule-severity)を示します。
- 円の下向き矢印は、診断が抑制されていることを示します。

![ソリューションエクスプローラーの診断アイコン](media/diagnostics-icons-solution-explorer.png)

## <a name="rule-sets"></a>規則セット

[ルールセット](../code-quality/using-rule-sets-to-group-code-analysis-rules.md)は、個々の診断の重大度と抑制状態を格納する XML ファイルです。

> [!NOTE]
> ルールセットには、レガシ分析とコードアナライザーの両方のルールを含めることができます。

ルールセットエディターでアクティブなルールセットを編集するには、**ソリューションエクスプローラー**の [**参照** > **アナライザー** ] ノードを右クリックし、 **[アクティブなルールセットを開く]** を選択します。 規則セットを初めて編集する場合は、Visual Studio によって *\<* 既定の規則セットファイルのコピーが作成され、projectname > という名前が設定され、プロジェクトに追加されます。 このカスタム規則セットは、プロジェクトのアクティブな規則セットにもなります。

プロジェクトのアクティブな規則セットを変更するには、プロジェクトのプロパティの **[コード分析]** タブに移動します。 [**この規則セットを実行**する] の一覧から規則セットを選択します。 規則セットを開くには、 **[開く]** を選択します。

> [!NOTE]
> .NET Core と .NET Standard のプロジェクトでは、 **[アクティブな規則セットを開く]** など、**ソリューションエクスプローラー**の規則セットのメニューコマンドはサポートされていません。 .NET Core または .NET Standard プロジェクトに対して既定以外の規則セットを指定するには、 [ **CodeAnalysisRuleSet**プロパティ](using-rule-sets-to-group-code-analysis-rules.md#specify-a-rule-set-for-a-project)をプロジェクトファイルに手動で追加します。 ただし、Visual Studio の規則セットエディター UI で規則セット内の規則を構成することはできます。

## <a name="rule-severity"></a>ルールの重要度

アナライザーを NuGet パッケージとして[インストール](../code-quality/install-roslyn-analyzers.md)した場合は、analyzer ルールまたは*診断*の重大度を構成できます。 次の表に、診断の重要度オプションを示します。

|重要度|ビルド時の動作|エディターの動作|
|-|-|-|
|Error|**エラー一覧**とコマンドラインのビルド出力で、違反が*エラー*として表示され、ビルドが失敗します。|問題のあるコードに赤い波線が表示され、スクロールバーに小さな赤色のボックスが付きます。|
|警告|**エラー一覧**とコマンドラインのビルド出力では、違反は*警告*として表示されますが、ビルドが失敗することはありません。|問題のあるコードには緑色の波線が表示され、スクロールバーには小さな緑色のボックスが付きます。|
|Info|違反は、コマンドラインのビルド出力ではなく、**エラー一覧**に*メッセージ*として表示されます。|問題のあるコードは灰色の波で下線が引かれ、スクロールバーの小さな灰色のボックスによってマークされます。|
|非表示|ユーザーに表示されません。|ユーザーに表示されません。 ただし、診断は IDE 診断エンジンに報告されます。|
|なし|完全に抑制されます。|完全に抑制されます。|

また、規則の重要度を "**既定**" に設定することによって、"リセット" できます。 各診断には、 **[プロパティ]** ウィンドウに表示される既定の重要度があります。

次のスクリーンショットは、3つの異なる重大度を持つコードエディターの3つの異なる診断違反を示しています。 波線の色に加え、右側のスクロールバーの小さなボックスも注目してください。

![コードエディターのエラー、警告、および情報の違反](media/diagnostics-severity-colors.png)

次のスクリーンショットは、**エラー一覧**に表示されるのと同じ3つの違反を示しています。

![エラー一覧のエラー、警告、および情報の違反](media/diagnostics-severities-in-error-list.png)

規則の重要度は、**ソリューションエクスプローラー**から変更することも、**ソリューションエクスプローラー**で規則の重要度を変更した後にソリューションに追加される *\<projectname >* ファイル内で変更することもできます。

![ソリューションエクスプローラーの規則セットファイル](media/ruleset-in-solution-explorer.png)

### <a name="set-rule-severity-from-solution-explorer"></a>ルールの重要度をソリューションエクスプローラーから設定

1. **ソリューションエクスプローラー**で、[**参照** > **アナライザー** ] (.net Core プロジェクトの**依存関係** > **アナライザー** ) を展開します。

1. 重要度を設定するルールが含まれているアセンブリを展開します。

1. ルールを右クリックし、 **[ルールセットの重要度の設定]** を選択します。 [] ボックスの [重要度] オプションの1つを選択します。

   ルールの重要度は、アクティブなルールセットファイルに保存されます。

### <a name="set-rule-severity-in-the-rule-set-file"></a>規則セットファイルで規則の重要度を設定する

1. **ソリューションエクスプローラー**で[ルールセット](analyzer-rule-sets.md)ファイルをダブルクリックして開きます。 **[アナライザー]** ノードの右クリックメニューで **[アクティブなルールセットを開く]** を選択するか、 **[コード分析]** プロパティページで **[開く]** を選択します。プロジェクト。

1. コンテナーのアセンブリを展開して、規則を参照します。

1. **[アクション]** 列で、値を選択してドロップダウンリストを開き、一覧から目的の重要度を選択します。

   ![エディターでルールセットファイルを開く](media/ruleset-file-in-editor.png)

## <a name="suppress-violations"></a>違反を抑制する

規則違反を抑制する方法は複数あります。

- **[分析]** メニューから

  現在 > のすべての違反を抑制するには、メニューバーの [**実行コード分析を分析し、アクティブな問題を抑制**する] を選択します。 これは、"基準" と呼ばれることもあります。

- **ソリューションエクスプローラー**から

  **ソリューションエクスプローラー**の違反を抑制するには、ルールの重大度を **[なし**] に設定します。

- **規則セットエディター**から

  規則セットエディターからの違反を抑制するには、名前の横のチェックボックスをオフにするか、 **[アクション]** を **[なし**] に設定します。

- **コードエディター**から

  コードエディターからの違反を抑制するには、コード行の違反を含むカーソルを置き、 **ctrl**+キーを押し**ます。** を開いて、 **[クイックアクション]** メニューを開きます。 [**ソース/抑制ファイル**での**caxxxx** > の抑制] を選択します。

  ![クイックアクションメニューの診断を抑制する](media/suppress-diagnostic-from-editor.png)

- **エラー一覧**から

  **エラー一覧**から1つまたは複数の診断を抑制するには、非表示にするものを選択し、右クリックして [**ソース/抑制ファイルで** **抑制** > ] を選択します。

  - **ソースで**非表示にすると、 **[変更のプレビュー]** ダイアログが開き、 C#ソースコードに追加された[#pragma 警告](/dotnet/csharp/language-reference/preprocessor-directives/preprocessor-pragma-warning)または Visual Basic [#Disable 警告](/dotnet/visual-basic/language-reference/directives/directives)ディレクティブのプレビューが表示されます。

    ![コードファイルでの #pragma 警告の追加のプレビュー](media/pragma-warning-preview.png)

  - **[抑制ファイル内]** を選択すると、 **[変更のプレビュー]** ダイアログが開き<xref:System.Diagnostics.CodeAnalysis.SuppressMessageAttribute> 、グローバル抑制ファイルに追加された属性のプレビューが表示されます。

    ![抑制ファイルへの SuppressMessage 属性の追加のプレビュー](media/preview-changes-in-suppression-file.png)

  **[変更のプレビュー]** ダイアログで、 **[適用]** を選択します。

  > [!NOTE]
  > **ソリューションエクスプローラー**に **[抑制]** メニューオプションが表示されない場合、違反はビルドから発生し、ライブ分析は行われない可能性があります。 **エラー一覧**には、ライブコード分析とビルドの両方からの診断または規則違反が表示されます。 ビルド診断は古くなる可能性があるため、たとえば、違反を修正するようにコードを編集してもリビルドされていない場合は、**エラー一覧**からこれらの診断を抑制することはできません。 ライブ分析または IntelliSense からの診断は、常に最新のソースを使用して最新の状態にあり、**エラー一覧**によって抑制できます。 選択した*ビルド*診断を除外するには、**エラー一覧**ソースフィルターを [ビルド] + **[Intellisense]** から **[intellisense のみ]** に切り替えます。 次に、非表示にする診断を選択し、前述のように続行します。
  >
  > ![Visual Studio でのエラー一覧ソースフィルター](media/error-list-filter.png)

## <a name="command-line-usage"></a>コマンドラインの使用方法

コマンドラインでプロジェクトをビルドすると、次の条件が満たされた場合に、規則違反がビルド出力に表示されます。

- アナライザーは、VSIX 拡張機能としてではなく、Nuget パッケージとしてインストールされます。

- プロジェクトのコードで1つ以上の規則に違反しています。

- 違反しているルールの[重要度](#rule-severity)は、いずれかの**警告**に設定されます。この場合、違反が発生してもビルドは失敗しません。**エラー**の場合は、違反が発生してもビルドは失敗します。

ビルド出力の詳細度は、規則違反が表示されるかどうかには影響しません。 **低**レベルの詳細度でも、ルール違反はビルド出力に表示されます。

> [!TIP]
> *FxCopCmd* 、または**runcodeanalysis**フラグを使用した msbuild を使用してコマンドラインからレガシ分析を実行することに慣れている場合は、コードアナライザーを使用してこれを行う方法を次に示します。

Msbuild を使用してプロジェクトをビルドするときに、コマンドラインでアナライザーの違反を確認するには、次のようなコマンドを実行します。

```cmd
msbuild myproject.csproj /target:rebuild /verbosity:minimal
```

次の図は、アナライザーの規則違反を含むプロジェクトをビルドしたときのコマンドラインビルド出力を示しています。

![ルール違反を示す MSBuild 出力](media/command-line-build-analyzers.png)

## <a name="dependent-projects"></a>依存プロジェクト

.NET Core プロジェクトでは、NuGet アナライザーを含むプロジェクトへの参照を追加すると、それらのアナライザーも依存プロジェクトに自動的に追加されます。 この動作を無効にするには、たとえば、依存プロジェクトが単体テストプロジェクトの場合、 **Privateassets**属性を設定して、参照されるプロジェクトの *.csproj*ファイルまたは *.vbproj*ファイルで NuGet パッケージを private としてマークします。

```xml
<PackageReference Include="Microsoft.CodeAnalysis.FxCopAnalyzers" Version="2.9.0" PrivateAssets="all" />
```

## <a name="see-also"></a>関連項目

- [Visual Studio のコードアナライザーの概要](../code-quality/roslyn-analyzers-overview.md)
- [コードアナライザーのバグを送信する](https://github.com/dotnet/roslyn-analyzers/issues)
- [規則セットを使用する](../code-quality/using-rule-sets-to-group-code-analysis-rules.md)
- [コード分析の警告を表示しない](../code-quality/in-source-suppression-overview.md)
