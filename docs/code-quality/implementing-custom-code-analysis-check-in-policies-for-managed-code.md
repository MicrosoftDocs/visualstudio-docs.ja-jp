---
title: "マネージ コード用のカスタム コード分析チェックイン ポリシーの実装 | Microsoft Docs"
ms.custom: ""
ms.date: "12/12/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "vs-ide-general"
ms.tgt_pltfrm: ""
ms.topic: "article"
f1_keywords: 
  - "vs.code.analysis.selecttfsrulesets"
  - "vs.code.analysis.browsefortfsruleset"
  - "vs.code.analysis.policyeditor"
ms.assetid: fd029003-5671-4b24-8b6f-032e0a98b2e8
caps.latest.revision: 21
caps.handback.revision: 21
author: "stevehoag"
ms.author: "shoag"
manager: "wpickett"
---
# マネージ コード用のカスタム コード分析チェックイン ポリシーの実装
[!INCLUDE[vs2017banner](../code-quality/includes/vs2017banner.md)]

コード分析チェックイン ポリシーは、バージョン コントロールにチェックインする前のソース コードに対してチーム プロジェクトのメンバーが実行する必要がある規則のセットを指定します。  Microsoft では、コード分析規則を機能区分でグループ化した標準の*規則セット*を提供しています。  *チェックイン ポリシーのカスタム規則セット*は、チーム プロジェクトに固有のコード分析規則セットを指定します。  規則セットは .ruleset ファイルに格納されます。  
  
 チェックイン ポリシーはチーム プロジェクト レベルで設定され、バージョン コントロール ツリー内の .ruleset ファイルの場所で指定されます。  チーム ポリシーのカスタム規則セットのバージョン コントロール場所に関する制限はありません。  
  
 コード分析は、各プロジェクトのプロパティ ウィンドウで、個々のコード プロジェクトに対して構成されます。  コード プロジェクトのカスタム規則セットは、ローカル コンピューター上の .ruleset ファイルの場所で指定されます。  コード プロジェクトと同じドライブにある .ruleset ファイルを指定した場合、Visual Studio は、プロジェクト構成でファイルの相対パスを使用します。  
  
 チーム プロジェクトのカスタム規則セットを作成する際には、チェックイン ポリシーの .ruleset ファイルを、コード プロジェクトの一部ではない特別なフォルダーに格納することをお勧めします。  規則ファイルを専用フォルダーに格納すると、ファイルを編集できるユーザーを制限するアクセス許可を適用したり、プロジェクトが含まれるディレクトリ構造を別のディレクトリまたはコンピューターに簡単に移動したりできます。  
  
## チーム プロジェクトのカスタム チェックイン規則セットの作成  
 チーム プロジェクトのカスタム規則セットを作成するには、まず、**ソース管理エクスプローラー**でチェックイン ポリシーの規則セット用の特別なフォルダーを作成します。  次に、規則セット ファイルを作成し、バージョン コントロールに追加します。  最後に、規則セットをチーム プロジェクトのコード分析チェックイン ポリシーとして指定します。  
  
> [!NOTE]
>  チーム プロジェクト内にフォルダーを作成するには、まず、チーム プロジェクトのルートをローカル コンピューター上の場所にマップする必要があります。  詳細については、「[Create and work with workspaces \(old\)](http://msdn.microsoft.com/ja-jp/db4d5692-179a-44fe-ad31-0c1c900c9cb2)」を参照してください。  
  
#### チェックイン ポリシーの規則セット用のバージョン コントロール フォルダーを作成するには  
  
1.  [!INCLUDE[esprtfc](../code-quality/includes/esprtfc_md.md)]で、チーム プロジェクトのノードを展開し、**\[ソース管理\]** をクリックします。  
  
2.  **\[フォルダー\]** ペインで、チーム プロジェクトを右クリックし、**\[新しいフォルダー\]** をクリックします。  
  
3.  ソース管理のメイン ペインで、**\[新しいフォルダー\]** を右クリックし、**\[名前の変更\]** をクリックし、規則セット フォルダーの名前を入力します。  
  
#### チェックイン ポリシーの規則セットを作成するには  
  
1.  **\[ファイル\]** メニューの **\[新規作成\]** をポイントし、**\[ファイル\]** をクリックします。  
  
2.  **\[カテゴリ\]** ボックスの一覧の **\[全般\]** をクリックします。  
  
3.  **\[テンプレート\]** ボックスの一覧の **\[コード分析規則セット\]** をダブルクリックします。  
  
4.  規則セットに含める規則を指定し、作成した規則セット フォルダーに規則セット ファイルを保存します。  
  
     詳細については、「[カスタム規則セットの作成](../code-quality/creating-custom-code-analysis-rule-sets.md)」を参照してください。  
  
#### 規則セット ファイルをバージョン コントロールに追加するには  
  
1.  **ソース管理エクスプローラー**で、新しいフォルダーを右クリックし、**\[項目をフォルダーに追加\]** をクリックします。  
  
     詳細については、「[バージョン管理の使用](../Topic/Use%20version%20control.md)」を参照してください。  
  
2.  作成した規則セット ファイルをクリックし、**\[完了\]** をクリックします。  
  
     ファイルがソース管理に追加され、チェックアウトされます。  
  
3.  **ソース管理エクスプローラー**の詳細ウィンドウで、ファイル名を右クリックし、**\[保留中の変更をチェックイン\]** をクリックします。  
  
4.  **\[チェックイン\]** ダイアログ ボックスで、必要に応じてコメントを追加し、**\[チェックイン\]** をクリックします。  
  
    > [!NOTE]
    >  チーム プロジェクトに対して既にコード分析チェックイン ポリシーを構成していて、**\[現在のソリューションの一部であるファイルのみのチェックインを強制\]** がオンになっている場合、ポリシー エラーの警告が発生します。  その場合は、\[ポリシー エラー\] ダイアログ ボックスで **\[ポリシー エラーをオーバーライドして、チェックインを続行\]** チェック ボックスをオンにします。  必要なコメントを追加し、**\[OK\]** をクリックします。  
  
#### 規則セット ファイルをチェックイン ポリシーとして指定するには  
  
1.  **\[チーム\]** メニューの **\[チーム プロジェクトの設定\]** をポイントし、**\[ソース管理\]** をクリックします。  
  
2.  **\[チェックイン ポリシー\]** をクリックし、**\[追加\]** をクリックします。  
  
3.  **\[チェックイン ポリシー\]** の一覧で、**\[コード分析\]** をダブルクリックし、**\[マネージ コードのコード分析を強制\]** チェック ボックスがオンになっていることを確認します。  
  
4.  **\[この規則セットを実行 \]** の一覧で、**\[\<ソース管理から規則セットを選択\>\]** をクリックします。  
  
5.  バージョン コントロール内のチェックイン ポリシーの規則セット ファイルのパスを入力します。  
  
     パスは、次の構文に従っている必要があります。  
  
     **$\/** `TeamProjectName` **\/** `VersionControlPath`  
  
    > [!NOTE]
    >  パスをコピーするには、**ソース管理エクスプローラー**で次のいずれかの手順を実行します。  
  
    -   **\[フォルダー\]** ペインで、規則セット ファイルが格納されているフォルダーをクリックします。  **Source** ボックスに表示されているフォルダーのバージョン コントロール パスをコピーし、規則セット ファイルの名前を手動で入力します。  
  
    -   詳細ウィンドウで、規則セット ファイルを右クリックし、**\[プロパティ\]** をクリックします。  **\[全般\]** タブで、**\[サーバー名\]** の値をコピーします。  
  
## コード プロジェクトとチェックイン ポリシーの規則セットの同期  
 チーム プロジェクトのチェックイン ポリシーの規則セットは、コード プロジェクトのプロパティ ダイアログ ボックスで、コード プロジェクト構成のコード分析規則セットとして指定します。  規則セットがコード プロジェクトと同じドライブにある場合、ファイル ダイアログ ボックスでパスが選択されると、相対パスを使用して規則セットが指定されます。  相対パスにより、プロジェクトのプロパティ設定を、同じローカル バージョン コントロール構造を使用する他のコンピューターに移植できます。  
  
#### チーム プロジェクトの規則セットをコード プロジェクトの規則セットとして指定するには  
  
1.  必要に応じて、チェックイン ポリシーの規則セット フォルダーおよびファイルをバージョン コントロールから取得します。  
  
     この手順を実行するには、**ソース管理エクスプローラー**で規則セット フォルダーを右クリックし、**\[最新バージョンの取得\]** をクリックします。  
  
2.  **ソリューション エクスプローラー**でコード プロジェクトを右クリックし、**\[プロパティ\]** をクリックします。  
  
3.  **\[コード分析\]** をクリックします。  
  
4.  必要に応じて、**\[構成\]** の一覧および **\[プラットフォーム\]** の一覧のオプションをクリックします。  
  
5.  指定した構成を使用してコード プロジェクトをビルドするたびにコード分析を実行するには、**\[ビルドに対するコード分析の有効化 \(CODE\_ANALYSIS 定数を定義\)\]** チェック ボックスをオンにします。  
  
6.  他社のコンポーネントのコードを無視するには、**\[生成されたコードの結果を表示しない\]** チェック ボックスをオフにします。  
  
7.  **\[この規則セットを実行 \]** の一覧で、**\[\<参照...\>\]** をクリックします。  
  
8.  チェックイン ポリシーの規則セット ファイルのローカル バージョンを指定します。