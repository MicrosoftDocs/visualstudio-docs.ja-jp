---
title: UML クラス図からコードを生成する |Microsoft Docs
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: vs-ide-modeling
ms.topic: conceptual
f1_keywords:
- vs.teamarch.logicalclassdiagram.shapes.properties.Templates
- vs.teamarch.logicalclassdiagram.shapes.properties.Templates.TextTransformationDataCollectionEditor
helpviewer_keywords:
- code generation, UML class diagrams
- class diagrams - UML, generating code
- UML diagrams, generating code
ms.assetid: 2790e64d-7728-4c2e-a4dd-4131e795f730
caps.latest.revision: 53
author: jillre
ms.author: jillfra
manager: jillfra
ms.openlocfilehash: 75120b2f09c2eba3254a1b94e78875d8130c5225
ms.sourcegitcommit: 6cfffa72af599a9d667249caaaa411bb28ea69fd
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/02/2020
ms.locfileid: "72666127"
---
# <a name="generate-code-from-uml-class-diagrams"></a>UML クラス ダイアグラムからコードを生成する
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

Visual Studio で UML クラス図から Visual C# .NET コードを生成するには、[ **コードの生成** ] コマンドを使用します。 既定では、このコマンドにより、選択したそれぞれの UML 型に対して C# の型が生成されます。 コードを生成するテキスト テンプレートを変更またはコピーすることで、この動作を変更および拡張できます。 モデルの異なるパッケージに含まれる型に対して、異なる動作を指定することもできます。

 [ **コードの生成** ] コマンドは、ユーザーが選択した要素からコードを生成する場合や、UML クラスまたはその他の要素ごとに1つのファイルを生成する場合に特に適しています。 たとえば、次のスクリーンショットには、2 つの UML クラスから生成された 2 つの C# ファイルが示されています。

 また、生成されたファイルに UML 要素と1:1 の関係がないコードを生成する場合は、[ **すべてのテンプレートの変換** ] コマンドを使用して呼び出されるテキストテンプレートを記述することもできます。 このメソッドの詳細については、「 [UML モデルからファイルを生成](../modeling/generate-files-from-a-uml-model.md)する」を参照してください。

 ![UML クラス図および生成された C&#35; クラスファイル。](../modeling/media/oob-gencode1.png "oob_GenCode1")

 Visual Studio での UML クラス図の詳細については、次のトピックを参照してください。

- [UML クラス図: リファレンス](../modeling/uml-class-diagrams-reference.md)

- [UML クラス図: ガイドライン](../modeling/uml-class-diagrams-guidelines.md)

  UML クラス図をサポートする Visual Studio のバージョンを確認するには、「 [アーキテクチャツールとモデリングツールのバージョンサポート](../modeling/what-s-new-for-design-in-visual-studio.md#VersionSupport)」を参照してください。

## <a name="using-the-generate-code-command"></a>[コードの生成] コマンドの使用
 次の手順では、[コードの **生成** ] コマンドの既定の動作について説明します。

#### <a name="to-generate-a-separate-file-for-each-element"></a>要素ごとに異なるファイルを生成するには

1. クラスを含む UML モデルを作成します。 モデル要素にはステレオタイプを適用できます。

    詳細については、「 [既定のコード生成変換](#default)」を参照してください。

2. クラスダイアグラムまたは **UML モデルエクスプローラー**で、コードを生成する要素を選択します。 次のいずれかを選択できます。

   - 要素の特定のセット。

   - パッケージまたはモデル。その内容からコードを生成します。

   - 図。図のすべての要素を選択します。

3. 選択した要素のショートカットメニューを開き、[ **コードの生成**] を選択します。

    特定のモデルでコードを最初に **生成** するときに、ダイアログボックスが表示されます。 このダイアログ ボックスでは、モデルのコード生成パラメーターを編集できます。

    これらのパラメーターを変更することがわかっている場合を除き、 **[OK]** をクリックします。

    後でこのダイアログボックスに戻るには、 **UML モデルエクスプローラー**を開きます。 モデリングプロジェクトのショートカットメニューを開き、[ **コード生成の設定**] をクリックします。 詳細については、「 [[コードの生成] コマンドのカスタマイズ](#custom)」を参照してください。

   C# コードが含まれるファイルが生成されます。 既定の設定では、C# クラス ライブラリ プロジェクトに、型ごとのファイルが生成されます。 ただし、この動作はカスタマイズできます。 詳細については、「 [[コードの生成] コマンドのカスタマイズ](#custom)」を参照してください。

   いくつかの検証テストがモデルに適用されて、C# に変換できることが確認されます。 テストが失敗した場合は、エラー メッセージが表示され、コードの生成は実行されません。 検証メニュー コマンドを作成してある場合は、検証コマンドが失敗した要素に対してはコードが生成されません。 詳細については、「 [UML モデルの検証制約を定義する](../modeling/define-validation-constraints-for-uml-models.md)」を参照してください。

## <a name="default-code-generation-transforms"></a><a name="default"></a> 既定のコード生成の変換
 このセクションでは、コマンドをカスタマイズしない限り、[ **コードの生成** ] コマンドによって生成される結果の概要を示します。 詳細については、「 [[コードの生成] コマンドのカスタマイズ](#custom)」を参照してください。

- UML モデルで選択した型ごとに 1 つの C# 型が生成されます。 それぞれの型は、作成される **コード** フォルダーの下にある別のコードファイルに配置されます。

- UML の型がパッケージに含まれる場合、生成される C# 型は名前空間の内部に格納され、ファイルは名前空間と同じ名前のフォルダーに生成されます。

- UML クラスの `Attribute` ごとに、C# のプロパティが生成されます。

- UML 型の各 `Operation` に対して、C# のメソッドが生成されます。

- クラスが参加している誘導可能な関連付けごとに、C# のフィールドが生成されます。

  各 UML 型にステレオタイプを追加することで、生成される C# 型の他のプロパティを制御できます。

|**作成する C# 型**|**作成する UML 型**|**適用するステレオタイプ**|
|---------------------------------|----------------------------|-------------------------------|
|クラス|クラス|\<none> または<br /><br /> C# class|
|インターフェイス|インターフェイス|\<none> または<br /><br /> C# interface|
|列挙|列挙|\<none> または<br /><br /> C# enum|
|代理人|クラス|C# delegate|
|構造体|クラス|C# struct|

#### <a name="to-set-a-stereotype-on-a-type-or-other-element"></a>型または他の要素にステレオタイプを設定するには

1. 図または **UML モデルエクスプローラー**で要素のショートカットメニューを開き、[ **プロパティ**] を選択します。

2. [ **プロパティ** ] ウィンドウで、[ **ステレオタイプ** ] プロパティのドロップダウン矢印をクリックし、適用するステレオタイプのチェックボックスをオンにします。

   > [!TIP]
   > C# のステレオタイプが表示されない場合は、対象のモデル要素が含まれるモデルまたはパッケージの C# プロファイルを有効にします。 **UML モデルエクスプローラー**で、パッケージまたはモデルのルートを選択します。 次に、[ **プロパティ** ] ウィンドウで [ **プロファイル**] を選択し、C# プロファイルを有効にします。

3. [ **ステレオタイプ** ] プロパティを展開して、設定できる追加のプロパティを確認します。

   型、属性、操作、およびアソシエーションの **Description** プロパティは、生成されたコード内のコメントに書き込まれ `<summary>` ます。 型にリンクされているコメント要素は、`<remarks>` コメントに書き込まれます。

## <a name="varying-the-generated-code"></a>生成されたコードの変更
 生成されるコードは、各型、属性、または操作のプロパティによって異なります。 たとえば、クラスの **Abstract** プロパティを true に設定すると、生成された `abstract` クラスにキーワードが表示されます。 属性の**多重度**を** \* 0.**. に設定すると、生成されるプロパティの型はになります。 `IEnumerable<>`

 さらに、それぞれのステレオタイプでは、設定できる追加のプロパティが提供されます。 これらの値は、C# コードでは適切なキーワードに変換されます。 たとえば、クラスで `Is Static` プロパティを設定した場合、C# クラスは `static` になります。

 これらの追加プロパティを設定するには、図でクラスまたは他の要素を選択します。 プロパティウィンドウで、[ **ステレオタイプ**] を展開し、c# **クラス**などの c# ステレオタイプを展開します。  クラスの場合、次のような追加プロパティがあります。

- CLR 属性

- Is Partial

- Is Static

- Is Unsafe

- パッケージの可視性

  各属性と操作にも、設定できるステレオタイプ プロパティがあります。 新しい属性にプロパティが表示されない場合は、[ **コードの生成**] を実行します。

## <a name="customizing-the-generate-code-command"></a><a name="custom"></a> [コードの生成] コマンドのカスタマイズ
 [ **コードの生成** ] コマンドは、一連のテキストテンプレートを使用してモデル要素を変換することによって機能します。 テキストテンプレートの詳細については、「 [コード生成と T4 テキストテンプレート](../modeling/code-generation-and-t4-text-templates.md)」を参照してください。

 テンプレートは、一連の *テキストテンプレートバインディング*で指定されます。 テキストテンプレートバインディングでは、適用するテンプレート、生成される出力を配置する場所、および [ **コードの生成** ] コマンドのその他のパラメーターを指定します。

 特定のモデルに対して [ **コードの生成** ] コマンドを初めて実行すると、テンプレートバインドの既定のセットがモデルのルートにアタッチされます。 これらのバインディングは、モデルのすべての要素に適用されます。

 ただし、パッケージ、クラス、または他の要素に独自のバインディングをアタッチすることで、既定のバインディングをオーバーライドし、既定のバインディングに追加できます。 バインディングは、アタッチされている要素に含まれるすべての要素に適用されます。 たとえば、特定のパッケージに含まれるすべての型を、異なるテンプレートのセットで変換する場合、または異なるフォルダーに出力する場合は、パッケージにテンプレート バインディングをアタッチできます。

 モデル要素にアタッチされているテンプレートバインドを検査するには、プロパティウィンドウの "**テキストテンプレートバインド**" プロパティで省略記号 **[...]** をクリックします。

 [ **コードの生成** ] コマンドは、選択した各モデル要素にテンプレートを適用します。 各要素に対して適用されるテンプレートのセットは、モデルのルートに至るまで (ルートを含む) の上位コンテナーにアタッチされているテンプレートの組み合わせです。

 このセットに同じ名前のテンプレート バインディングがある場合は、小さいコンテナーのバインディングによって大きいコンテナーのバインディングがオーバーライドされます。 たとえば、モデルルートには、 **クラステンプレート**という名前のバインディングがあります。 独自のテンプレートを特定のパッケージの内容に適用するには、name **Class template**を持つ独自のテンプレートバインディングを定義します。

 1 つのモデル要素に複数のテンプレートを適用できます。 各モデル要素から複数のファイルを生成できます。

> [!NOTE]
> モデルのルートにアタッチされているバインディングは、そのモデルのすべての要素に対する既定値になります。 これらの既定のバインドを表示するには、 **UML モデルエクスプローラー**を開きます。 モデリングプロジェクトのショートカットメニューを開き、[ **コード生成の設定**] を選択します。 また、UML モデル エクスプローラーで、モデルのルートを選択することもできます。 プロパティウィンドウで、"**テキストテンプレートバインド**" プロパティの **[...]** を選択します。 バインドは、[ **コードの生成** ] コマンドを少なくとも1回使用するまで表示されません。 テンプレート バインディングを図にアタッチすることはできません。

#### <a name="to-attach-text-template-bindings-to-a-package-or-other-model-element"></a>テキスト テンプレート バインディングをパッケージまたは他のモデル要素にアタッチするには

1. **UML モデルエクスプローラー**で、モデル要素のショートカットメニューを開き、[**プロパティ**] をクリックします。 通常は、パッケージまたはモデルのルートに対してテキスト テンプレート バインディングをアタッチします。

2. [**プロパティ**] ウィンドウで、"**テキストテンプレートバインド**" プロパティの省略記号ボタン (**[...]**) を選択します。

    [ **テキストテンプレートのバインド** ] ダイアログボックスが表示されます。

3. [ **追加** ] を選択して、新しいテキストテンプレートバインドを作成します。

    \- または

    既存のバインディングを選択して編集します。

    各テンプレート バインディングでは、指定したテンプレートを選択したモデル要素に適用する方法、および含まれる他のモデル要素が定義されています。

4. ダイアログ ボックスで、テキスト テンプレート バインディングのプロパティを設定します。

   |    **プロパティ**    |                                                                                                                                                                                                                                                                                                                    **説明**                                                                                                                                                                                                                                                                                                                    |
   |--------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
   |        名前        |                                                                                                                                                                                                                                                  このバインディングの名前。 上位のパッケージまたはモデルから継承されたバインディングをオーバーライドするには、オーバーライド対象のバインディングと同じ名前を使用します。                                                                                                                                                                                                                                                  |
   |     Overwrite      |                                                                                                                                                                                                                                                                                                      true の場合、既存のコードを上書きします。                                                                                                                                                                                                                                                                                                       |
   |    ターゲット名     | 生成されるファイルの名前。<br /><br /> またはのようなこの文字列に式を挿入でき `{Name}` `{Owner.Name}` ます。 たとえば、と記述でき `{Owner.Name}_{Name}` ます。 式は、モデル要素に対して評価されます。 要素のプロパティは使用できますが、メソッドのプロパティは使用できません。 使用できるプロパティを見つけるには、 **VisualStudio \* **の型のプロパティを参照してください。 \*\*重要: \* \* `{Name}` またはは `{Owner.Name}` 、**ターゲット名**プロパティでのみ使用できます。   生成されるクラスの名前を変更するには、テンプレートを変更する必要があります。 詳細については、「 [テキストテンプレートを作成する](#writing)」を参照してください。 |
   |    プロジェクト パス    |                                                                      変換の出力ファイルを格納する [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] プロジェクトへのパスを指定します。 新しいプロジェクトを作成するには、型指定された値を使用します。 省略記号ボタン (**[...]**) をクリックして、既存のプロジェクトを選択します。<br /><br /> 存在しない場合は、新しいプロジェクトが作成されます。 作成されるプロジェクトは、C# クラス ライブラリ プロジェクトになります。<br /><br /> そのためには、プロジェクト ディレクトリを入力する必要があります。 %ProgramFiles% や %LocalAppData% などの環境変数マクロを使用できます。                                                                       |
   |  ターゲット ディレクトリ  |                                                                                          ターゲット ファイルが生成されるフォルダー。 このパスはプロジェクト フォルダーが基準になります。<br /><br /> 上位のパッケージの名前に対応するパスを挿入するには、`{PackageStructure}` 式を使用できます。 既定値は `\GeneratedCode\{PackageStructure}` です。 %TEMP% や %HomePath% などの環境変数を使用することもできます。 **重要:** `{PackageStructure}`**ターゲットディレクトリ**プロパティでのみ使用できます。                                                                                            |
   | テンプレート ファイル パス |                                                                                                                                                           変換を実行するテンプレート。<br /><br /> 提供されているテンプレートを使用することも、独自に作成することもできます。 提供されているテンプレートは、次の場所にあります。<br /><br /> …\Program Files\Microsoft Visual Studio 12.0\Common7\IDE\Extensions\Microsoft\Architecture Tools\Extensibility\Templates\Text\                                                                                                                                                           |

5. 必要なだけいくつでもバインディングを要素にアタッチできます。

## <a name="writing-a-text-template"></a><a name="writing"></a> テキストテンプレートの作成
 独自のテキスト テンプレートを作成できます。 テキスト テンプレートでは、プログラム コードまたは他の任意の種類のテキスト ファイルを生成できます。

 標準テンプレートのコピーを変更することをお勧めします。 テンプレートは次の場所からコピーできます。

 …\Program Files\Microsoft Visual Studio 12.0\Common7\IDE\Extensions\Microsoft\Architecture Tools\Extensibility\Templates\Text\

 テキスト テンプレートの詳細については、次のトピックを参照してください。

- テキスト テンプレートは生成されるファイルのプロトタイプであり、生成されるテキストと、モデルを読み取るプログラム コードの両方が含まれます。 詳細については、「 [コード生成と T4 テキストテンプレート](../modeling/code-generation-and-t4-text-templates.md)」を参照してください。

- プログラム コードで UML モデル内を移動するには、UML API を使用する必要があります。 詳細については、「uml [モデルを操作する](../modeling/navigate-the-uml-model.md) 」および「 [Uml モデリング機能拡張の API リファレンス](../modeling/api-reference-for-uml-modeling-extensibility.md)」を参照してください。

  [ **コードの生成** ] コマンドでテンプレートを使用するには、モデリングディレクティブを含める必要があります。 次に例を示します。

  `<#@ Modeling ElementType="Microsoft.VisualStudio.Uml.Classes.IClass" Processor="ModelingProcessor" #>`

  `ElementType` 属性では、このテンプレートを適用する UML 要素の種類を定義します。

  テンプレートでは、`this` は次のプロパティを持つ一時クラスに属します。

- `Element` = テンプレートが適用される UML [Ielement](/previous-versions/dd516035(v=vs.140)) 。

- `Errors`: <xref:System.CodeDom.Compiler.CompilerErrorCollection>

- `Host`: [ITextTemplatingEngineHost](/previous-versions/visualstudio/visual-studio-2012/bb126505(v=vs.110))

- `ModelBus`: [Modelbus](/previous-versions/ee904639(v=vs.140))。 詳細については、「 [UML モデルを他のモデルおよびツールと統合](../modeling/integrate-uml-models-with-other-models-and-tools.md)する」を参照してください。

- `ProfileName` = "C#Profile"

- `ServiceProvider`: <xref:System.IServiceProvider>

- `Session`: <xref:Microsoft.VisualStudio.TextTemplating.TextTemplatingSession>.

- `Store`: <xref:Microsoft.VisualStudio.Modeling.Store>. これは、UML ModelStore が実装されている Visualization and Modeling SDK ストアです。 UML [Imodelstore](/previous-versions/ee789385(v=vs.140))を取得するには、を使用し `this.Element.GetModelStore()` ます。

  テキスト テンプレートを作成するときは、以下のことが役に立つ場合があります。 この情報の詳細につい [ては、「コード生成と T4 テキストテンプレート](../modeling/code-generation-and-t4-text-templates.md)」を参照してください。

- 生成されるファイル名の拡張子は、`Output` ディレクティブで設定できます。 すべてのテキスト テンプレートに `Output` ディレクティブが 1 つ必要です。

- 一部のアセンブリはテンプレートで自動的に参照されます。 このようなアセンブリの例としては、System.dll や Microsoft.VisualStudio.Uml.Interfaces.dll などがあります。

   生成用のプログラム コードで他のアセンブリを使用するには、`Assembly` ディレクティブを使用します。 次に例を示します。

   `<#@ Assembly Name="%ProgramFiles%\Microsoft Visual Studio 12.0\Common7\IDE\PublicAssemblies\Microsoft.VisualStudio.ArchitectureTools.Extensibility.dll" #>`

- `System` などの一部の名前空間は、プログラム コードに自動的にインポートされます。 他の名前空間については、`Import` ディレクティブを `using` ステートメントと同じ方法で使用できます。 次に例を示します。

   `<#@ Import Namespace="Microsoft.VisualStudio.Uml.Classes" #>`

   `<#@ Import Namespace="Microsoft.VisualStudio.ArchitectureTools.Extensibility.Uml" #>`

- 別のファイルのテキストを参照するには、`Include` ディレクティブを使用します。

- 角かっこで囲まれたテンプレートの部分 `<# ... #>` は、[ **コードの生成** ] コマンドによって実行されます。 かっこの外側にあるテンプレートの部分は、生成されるファイルにコピーされます。 生成するコードと生成されるテキストを区別することが重要です。 生成されるテキストには任意の言語を使用できます。

- `<#= Expressions #>` が評価され、文字列に変換されます。

## <a name="see-also"></a>参照
 [Uml クラス図: リファレンス](../modeling/uml-class-diagrams-reference.md) [uml クラス図: ガイドライン](../modeling/uml-class-diagrams-guidelines.md) [uml モデルからファイルを生成する](../modeling/generate-files-from-a-uml-model.md)
