---
title: 'チュートリアル: マルチスレッドアプリケーションのデバッグ |Microsoft Docs'
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: vs-ide-debug
ms.topic: conceptual
dev_langs:
- FSharp
- VB
- CSharp
- C++
helpviewer_keywords:
- multithreaded debugging, walkthrough
- walkthroughs, multithreaded debugging
ms.assetid: 590ffd57-0556-43d8-8962-ee27e5b2b7d7
caps.latest.revision: 42
author: MikeJo5000
ms.author: mikejo
manager: jillfra
ms.openlocfilehash: 33ce391523a256bcb195deccf0c14868b5eae707
ms.sourcegitcommit: 6cfffa72af599a9d667249caaaa411bb28ea69fd
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/02/2020
ms.locfileid: "65683092"
---
# <a name="walkthrough-debugging-a-multithreaded-application"></a>チュートリアル : マルチスレッド アプリケーションのデバッグ
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

[!INCLUDE[vs_dev11_long](../includes/vs-dev11-long-md.md)] では、 **スレッド** 化されたアプリケーションのデバッグが容易になるように、強化されたスレッドウィンドウとその他のユーザーインターフェイスの機能強化が提供されます このチュートリアルにはあまり時間がかかりませんが、これを完了することで、マルチスレッド アプリケーションのデバッグに使用する新しいインターフェイスを理解できます。  
  
 このチュートリアルを始めるには、マルチスレッド アプリケーション プロジェクトが必要です。 次の手順に従って、このようなプロジェクトを作成します。  
  
#### <a name="to-create-the-walkthrough-project"></a>チュートリアル用のプロジェクトを作成するには  
  
1. [ **ファイル** ] メニューの [ **新規作成** ] をポイントし、[ **プロジェクト**] をクリックします。  
  
     **[新しいプロジェクト]** ダイアログ ボックスが表示されます。  
  
2. [ **プロジェクトの種類**] ボックスで、選択した言語 ([ **Visual Basic**]、[ **Visual C#**]、または [ **Visual C++**]) をクリックします。  
  
3. [ **テンプレート** ] ボックスで、[ **コンソールアプリケーション** ] または [ **CLR コンソールアプリケーション**] を選択します。  
  
4. [ **名前** ] ボックスに、名前として「mythread/アプリ」と入力します。  
  
5. **[OK]** をクリックします。  
  
     新しいコンソール プロジェクトが表示されます。 プロジェクトが作成されると、ソース ファイルが表示されます。 選択した言語に応じて、ソース ファイル名はそれぞれ Module1.vb、Program.cs、MyThreadWalkthroughApp.cpp などとなります。  
  
6. ソースファイルに表示されているコードを削除し、「スレッドを [作成して開始時にデータを渡す](https://msdn.microsoft.com/library/52b32222-e185-4f42-91a7-eaca65c0ab6d)」のトピックの「スレッドの作成」に記載されているコード例に置き換えます。  
  
7. **[ファイル]** メニューの **[すべてを保存]** をクリックします。  
  
#### <a name="to-begin-the-walkthrough"></a>チュートリアルを開始するには  
  
- ソース コード ウィンドウで、次のコードを探します。  
  
    ```vb  
    Thread.Sleep(3000)   
    Console.WriteLine(  
    ```  
  
```csharp  
Thread.Sleep(3000);  
Console.WriteLine();  
```  
  
```cpp  
Thread::Sleep(3000);  
Console.WriteLine();  
```  
  
#### <a name="to-start-debugging"></a>デバッグを開始するには  
  
1. ステートメントを右クリックして [ `Console.WriteLine` **ブレークポイント** ] をポイントし、[ **ブレークポイントの挿入**] をクリックします。  
  
     ソース ウィンドウ左端の余白に赤い丸が表示されます。 これは、ブレークポイントがその場所に設定されていることを示します。  
  
2. **[デバッグ]** メニューの **[デバッグの開始]** をクリックします。  
  
     デバッグが開始され、コンソール アプリケーションの実行が始まり、ブレークポイントで停止します。  
  
3. このとき、フォーカスがコンソール アプリケーション ウィンドウにある場合は、[!INCLUDE[vsprvs](../includes/vsprvs-md.md)] ウィンドウの内側をクリックして、フォーカスを [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] に戻します。  
  
4. ソース ウィンドウで、次のコードが含まれている行を探します。  
  
    ```vb  
    Thread.Sleep(5000)   
    ```  
  
```csharp  
Thread.Sleep(3000);  
```  
  
```cpp  
Thread::Sleep(3000);  
```  
  
1. 
  
#### <a name="to-discover-the-thread-marker"></a>スレッド マーカーを見つけるには  
  
1. [ **スレッド** ] ウィンドウを右クリックし、[ **ソースのスレッドを表示**] をクリックします。  
  
2. ウィンドウ左端の余白に注目します。 マーカーがある行には、2 色のより糸の形をしたアイコンがあります。 色は、片方は赤で、もう片方は青です。 スレッド マーカーは、スレッドが停止している位置を示します。 このことから、スレッドはこの位置で停止していると考えられます。  
  
3. スレッド マーカーの上にポインターを置きます。 データヒントが表示されます。 データヒントは、停止したスレッドごとに名前とスレッド ID 番号を表示します。 この場合、スレッドは 1 つだけで、名前は `<noname>` です。  
  
4. スレッド マーカーを右クリックします。 ショートカット メニューに表示される項目に注目します。  
  
   このアイコンは *スレッドマーカー*です。  
  
   ![スレッド マーカー](../debugger/media/threadmarker.gif "ThreadMarker")  
  
## <a name="flagging-and-unflagging-threads"></a>スレッドに対するフラグの設定と設定解除  
 [!INCLUDE[vs_orcas_long](../includes/vs-orcas-long-md.md)] では、特に注目するスレッドにフラグを設定できます。 スレッドに対するフラグの設定は、重要なスレッドを追跡し、注目する必要がないスレッドを無視するのに適しています。  
  
#### <a name="to-flag-threads"></a>スレッドにフラグを設定するには  
  
1. [ **表示** ] メニューの [ **ツールバー**] をポイントします。  
  
     [ **デバッグの場所** ] ツールバーが選択されていることを確認します。  
  
2. [デバッグの **場所** ] ツールバーに移動し、[ **スレッド** ] ボックスの一覧をクリックします。  
  
    > [!NOTE]
    > このツールバーは、 **プロセス**、 **スレッド**、 **スタックフレーム**という3つの目立つリストで認識できます。  
  
3. ボックスに表示されているスレッド数に注目します。  
  
4. ソースウィンドウに戻り、 **スレッド** マーカーをもう一度右クリックします。  
  
5. ショートカットメニューの [ **フラグ**] をポイントし、スレッド名と ID 番号をクリックします。  
  
6. [デバッグの **場所** ] ツールバーに戻り、 **スレッド** の一覧をもう一度クリックします。  
  
     今度は、フラグが設定されたスレッドのみがボックスに表示されます。 **スレッド**一覧の右側にあるフラグボタン。 そのボタンに表示されるフラグ アイコンは、それまでは淡色表示でした。 明るい赤で塗りつぶされたアイコンに変わっていることを確認します。  
  
7. フラグ アイコンの上にポインターを置きます。  
  
     ポップアップが表示されます。 このポップアップでは、 **スレッド** 一覧がどのモードになっているかがわかります。 **フラグ付きのスレッドのみを表示**します。  
  
8. [フラグ] ボタンをクリックして、[ **すべてのスレッドの表示** ] モードに戻します。  
  
9. **スレッド**の一覧をもう一度クリックして、すべてのスレッドが再び表示されることを確認します。  
  
10. フラグボタンをクリックして、フラグが設定された **スレッドのみを表示**するように切り替えます。  
  
11. **[デバッグ]** メニューの **[ウィンドウ]** をポイントし、 **[スレッド]** をクリックします。  
  
     [ **スレッド** ] ウィンドウが表示されます。 1 つのスレッドに、目立つ色のフラグ アイコンが割り当てられています。  
  
12. ソース ウィンドウで、スレッド マーカーをもう一度右クリックします。  
  
     ショートカット メニューに今回表示される項目に注目します。 **フラグ**の代わりに [フラグ解除] が表示**されます**。 [ **フラグ**解除] をクリックしないでください。  
  
13. スレッドのフラグ解除に関する次の手順に進みます。  
  
#### <a name="to-unflag-threads"></a>スレッドのフラグを解除するには  
  
1. [ **スレッド** ] ウィンドウで、フラグが設定されたスレッドに対応する行を右クリックします。  
  
     ショートカット メニューが表示されます。 すべての **フラグ** を解除し、 **フラグ**を解除するオプションがあります。  
  
2. スレッドのフラグを解除するには、[ **フラグ**解除] をクリックします。  
  
3. 赤いフラグ アイコンをクリックします。  
  
4. [デバッグの **場所** ] ツールバーをもう一度確認します。 フラグ ボタンが再び淡色表示になっていることを確認します。 フラグ解除されたのは、フラグが設定された唯一のスレッドでした。 フラグが設定されたスレッドがないため、ツールバーは [ **すべてのスレッドの表示]** モードに戻ります。 **スレッド**の一覧をクリックし、すべてのスレッドが表示されることを確認します。  
  
5. [ **スレッド** ] ウィンドウに戻り、情報列を確認します。  
  
     各列の先頭に表示されるボタンのほとんどに、列の内容を示すタイトルが表示されます。 ただし、左端の列にはタイトルはありません。 その代わりにアイコンがありますが、これはフラグの枠です。 スレッドの一覧の各行にも同じ枠があります。 この枠は、スレッドにフラグが設定されていないことを示しています。  
  
6. 一覧の下から 2 番目と 3 番目の 2 つのスレッドのフラグ枠をクリックします。  
  
     フラグ アイコンが中空の枠から塗りつぶされた赤に変わります。  
  
7. フラグ列の最上部にあるボタンをクリックします。  
  
     このボタンをクリックすると、スレッドの一覧順序が変わります。 スレッドのリストが並べ替えられ、フラグが設定されたスレッドが先頭になります。  
  
8. 再び、フラグ列の最上部にあるボタンをクリックします。  
  
     並べ替え順序がまた変わります。  
  
## <a name="more-about-the-threads-window"></a>[スレッド] ウィンドウの詳細  
  
#### <a name="to-learn-more-about-the-threads-window"></a>[スレッド] ウィンドウについての理解を深めるには  
  
1. [ **スレッド** ] ウィンドウで、左の3番目の列を確認します。 この列の上部にあるボタンには、 **ID**と表示されます。  
  
2. [ **ID**] をクリックします。  
  
     スレッドの一覧がスレッド ID 番号で並べ替えられます。  
  
3. 一覧の中から任意のスレッドを右クリックします。 ショートカットメニューの [ **16 進表示**] をクリックします。  
  
     スレッド ID 番号の書式が変わります。  
  
4. マウス ポインターを一覧の任意のスレッドの上に置きます。  
  
     少し遅れて、データヒントが表示されます。 ここには、スレッドの呼び出し履歴の一部が表示されます。  
  
5. 左側の4番目の列 ([ **カテゴリ]**) を確認します。 スレッドはカテゴリ別に分類されています。  
  
     プロセスで最初に作成されたスレッドは、メイン スレッドと呼ばれます。 スレッドの一覧でそれを探します。  
  
6. メインスレッドを右クリックし、[ **スレッドに切り替え] を**クリックします。  
  
     警告のダイアログ ボックスが表示されます。 そこには、[!INCLUDE[vsprvs](../includes/vsprvs-md.md)] がメイン スレッドのソース コードを表示できないというメッセージが表示されます。  
  
     **[OK]** をクリックします。  
  
7. [ **呼び出し履歴** ] ウィンドウと [ **デバッグの場所** ] ツールバーを確認します。  
  
     [ **呼び出し履歴** ] ウィンドウの内容が変更されました。  
  
## <a name="switching-the-active-thread"></a>アクティブ スレッドの切り替え  
  
#### <a name="to-switch-threads"></a>スレッドを切り替えるには  
  
1. [ **スレッド** ] ウィンドウで、左から2番目の列を確認します。 この列の最上部にあるボタンにはテキストもアイコンもありません。 この列は **アクティブスレッド** 列です。  
  
2. [ **アクティブスレッド** ] 列を見て、1つのスレッドに黄色の矢印が表示されていることを確認します。 これは *アクティブスレッドインジケーター*です。  
  
3. アクティブ スレッド インジケーターがあるスレッド ID 番号をメモしておきます。 これからアクティブ スレッド インジケーターを動かしますが、完了したら元に戻す必要があるためです。  
  
4. 別のスレッドを右クリックし、[ **スレッドに切り替え] を**クリックします。  
  
5. ソースウィンドウの [ **呼び出し履歴** ] ウィンドウを確認します。 内容が変わっていることを確認します。  
  
6. [デバッグの **場所** ] ツールバーを確認します。 アクティブ スレッドも変わっていることを確認します。  
  
7. [デバッグの **場所** ] ツールバーに移動します。 [ **スレッド** ] ボックスをクリックし、ドロップダウンリストから別のスレッドを選択します。  
  
8. [ **スレッド** ] ウィンドウを確認します。 アクティブ スレッド インジケーターが変わっていることを確認します。  
  
9. ソース ウィンドウで、スレッド マーカーを右クリックします。 ショートカットメニューで、[ **切り替え先** ] をポイントし、スレッド名と ID 番号をクリックします。  
  
     これで、アクティブスレッドを変更する3つの方法が表示されました。 [**スレッド**] ウィンドウ、[**デバッグの場所**] ツールバーの [**スレッド**] ボックス、およびソースウィンドウのスレッドインジケーターを使用します。  
  
     スレッド インジケーターを使用すると、特定の場所で停止されたスレッドのみを切り替えることができます。 **[スレッド]** ウィンドウと **[デバッグの場所]** ツール バーを使用すると、任意のスレッドに切り替えることができます。  
  
## <a name="freezing-and-thawing-thread-execution"></a>スレッド実行の凍結と凍結解除  
  
#### <a name="to-freeze-and-unfreeze-threads"></a>スレッドを凍結および凍結解除するには  
  
1. [ **スレッド** ] ウィンドウで、任意のスレッドを右クリックし、[ **フリーズ**] をクリックします。  
  
2. アクティブ スレッド列に注目します。 2 本の垂直バーが表示されることを確認します。 この 2 本の青いバーは、スレッドが凍結していることを示しています。  
  
3. **中断**列を確認します。 スレッドの中断カウントが 1 になっていることを確認します。  
  
4. 凍結されたスレッドを右クリックし、[ **凍結**解除] をクリックします。  
  
     アクティブスレッド列と **中断** 列が変更されます。  
  
## <a name="see-also"></a>参照  
 [マルチスレッドアプリケーションのデバッグ](../debugger/debug-multithreaded-applications-in-visual-studio.md)   
 [方法: デバッグ中に別のスレッドに切り替える](../debugger/how-to-switch-to-another-thread-while-debugging.md)
