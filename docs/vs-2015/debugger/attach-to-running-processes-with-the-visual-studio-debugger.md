---
title: デバッガーを使用して実行中のプロセスにアタッチする |Microsoft Docs
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: vs-ide-debug
ms.topic: conceptual
f1_keywords:
- vs.debug.processes.attach
- vs.debug.process
- vs.debug.programs
- vs.debug.detaching
- vs.debug.processes
- vs.debug.error.attach
- vs.debug.remotemachine
dev_langs:
- C++
- CSharp
- FSharp
- VB
- c++
helpviewer_keywords:
- remote debugging, attaching to programs
- processes, attaching to running processes
- Attach to Process dialog box
- debugging [Visual Studio], attaching to processes
- debugger, processes
ms.assetid: 27900e58-090c-4211-a309-b3e1496d5824
caps.latest.revision: 62
author: MikeJo5000
ms.author: mikejo
manager: jillfra
ms.openlocfilehash: cf4d63d7d00e91daa2564992f801896075f73aab
ms.sourcegitcommit: 6cfffa72af599a9d667249caaaa411bb28ea69fd
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/02/2020
ms.locfileid: "75918942"
---
# <a name="attach-to-running-processes-with-the-visual-studio-debugger"></a>実行中のプロセスへのアタッチ
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

ローカルまたはリモート コンピューターで実行中のプロセスに、Visual Studio デバッガーをアタッチできます。 プロセスが実行されたら、[デバッグ]、[ **プロセスにアタッチ** ] の順にクリックします (または、 **CTRL + ALT + P**キーを押して [ **プロセスにアタッチ** ] ダイアログボックスを開きます)。

この機能を使用して、ローカルまたはリモートコンピューターで実行されているアプリをデバッグしたり、複数のプロセスを同時にデバッグしたり、Visual Studio で作成されていないアプリケーションをデバッグしたりできます。 多くの場合、アプリをデバッグするときには便利ですが、何らかの理由で、デバッガーがアタッチされた状態で Visual Studio からアプリを起動することはできません。 たとえば、デバッガーを使用せずにアプリを実行しているときに例外が発生した場合は、アプリを実行しているプロセスにアタッチして、デバッグを開始することができます。

> [!TIP]
> デバッグシナリオで [ **プロセスにアタッチ** ] を使用する必要があるかどうかを確認してください。 「[一般的なデバッグ シナリオ](#BKMK_Scenarios)」を参照してください。 IIS に配置されている ASP.NET アプリケーションをデバッグする場合は、 [リモートの iis コンピューター上のリモートデバッグ ASP.NET に関する](../debugger/remote-debugging-aspnet-on-a-remote-iis-7-5-computer.md)詳細を参照してください。

## <a name="attach-to-a-running-process-on-the-local-machine"></a><a name="BKMK_Attach_to_a_running_process"></a> ローカルコンピューターで実行中のプロセスにアタッチする
 プロセスにアタッチするには、プロセスの名前を把握しておく必要があります (いくつかの一般的なプロセス名の [一般的なデバッグシナリオ](#BKMK_Scenarios) を参照してください)。

1. Visual Studio で、[デバッグ]、[ **プロセスにアタッチ** ] の順に選択します (または、 **CTRL + ALT + P**キーを押します)。

2. **[プロセスにアタッチ]** ダイアログ ボックスの **[選択可能なプロセス]** ボックスの一覧で、アタッチするプログラムを探します。

     目的のプロセスをすばやく選択するには、プロセス名の最初の文字を入力します。 プロセス名がわからない場合は、「 [一般的なデバッグシナリオ](#BKMK_Scenarios)」を参照してください。

     ![DBG_Basics_Attach_To_Process](../debugger/media/dbg-basics-attach-to-process.png "DBG_Basics_Attach_To_Process")

     プロセスが別のユーザー アカウントで実行されている場合は、 **[すべてのユーザーからのプロセスを表示する]** チェック ボックスをオンにします。

3. **[アタッチ先]** ボックスに、デバッグするコードの種類が表示されていることを確認します。 既定の **[自動]** 設定では、デバッグするコードの種類が自動的に判断されます。 コードの種類を手動で設定するには、次の操作を行います

    1. **[プロセスにアタッチ]** ボックスで、 **[選択]** をクリックします。

    2. **[コードの種類の選択]** ダイアログ ボックスで、 **[次のコードの種類をデバッグする]** をクリックし、デバッグする種類を選択します。

    3. **[OK]** をクリックします。

4. **[アタッチ]** をクリックします。

## <a name="attach-to-a-process-on-a-remote-computer"></a><a name="BKMK_Attach_to_a_process_on_a_remote_computer"></a>リモート コンピューター上のプロセスにアタッチする
 プロセスにアタッチするには、プロセスの名前を把握しておく必要があります (いくつかの一般的なプロセス名の [一般的なデバッグシナリオ](#BKMK_Scenarios) を参照してください)。 IIS に配置されている ASP.NET アプリの詳細なガイダンスについては、 [リモートの iis コンピューターでのリモートデバッグ ASP.NET に](../debugger/remote-debugging-aspnet-on-a-remote-iis-7-5-computer.md)関する説明を参照してください。 他のアプリについては、タスク マネージャーで、プロセスの名前を検索できる場合があります。

 **[プロセスにアタッチ]** ダイアログ ボックスでは、リモート デバッグ用にセットアップした他のコンピューターを選択できます。 詳細については、「[リモート デバッグ](https://msdn.microsoft.com/library/90f45630-0d26-4698-8c1f-63f85a12db9c)」を参照してください。 リモート コンピューターを選択すると、そのコンピューターで実行されている選択可能なプロセスの一覧を表示して、1 つ以上のプロセスにアタッチしてデバッグを実行できます。

 **リモート コンピューターを選択するには:**

1. Visual Studio で、[デバッグ]、[ **プロセスにアタッチ** ] の順に選択します (または、 **CTRL + ALT + P**キーを押します)。

2. **[プロセスにアタッチ]** ダイアログ ボックスの **[トランスポート]** ボックスの一覧で、該当する接続の種類を選択します。 **[既定値]** は、ほとんどの場合に適切な設定です。

   **[トランスポート]** の設定は、デバッグ セッション間で保持されます。

3. **[修飾子]** ボックスの一覧でリモート コンピューター名を選択します。以下のいずれかの方法を使用します。

   1. **[修飾子]** ボックスの一覧に名前を入力します。

      > [!NOTE]
      > 後の手順で、リモートコンピューター名を使用して接続できない場合は、IP アドレスを使用します。 (プロセスを選択した後、ポート番号が自動的に表示される場合があります。 手動で入力することもできます。 次の図では、リモートデバッガーの既定のポートは4020です)。

   2. **[修飾子]** ボックスの一覧の横のドロップダウン矢印をクリックし、一覧でコンピューター名を選択します。

   3. [**修飾子**] の一覧の横にある [**検索**] ボタンをクリックして、[**リモートデバッガー接続の選択**] ダイアログボックスを開きます。 **[リモート デバッガー接続の選択]** ダイアログ ボックスには、ローカル サブネット上にあるデバイスと、イーサネット ケーブルで自分のコンピューターに直接接続されているデバイスがすべて表示されます。 目的のコンピューターまたはデバイスをクリックし、 **[選択]** をクリックします。

      **[修飾子]** の設定は、その修飾子でデバッグ接続が成功した場合のみ、デバッグ セッション間で保持されます。

4. **[最新の情報に更新]** をクリックします。

     **[プロセス]** ダイアログ ボックスを開くと、 **[選択可能なプロセス]** ボックスが自動的に表示されます。 このダイアログ ボックスが開いている間に、プロセスをバックグラウンドで開始および停止できます。 このため、内容が常に最新であるとは限りません。 **[更新]** をクリックすると、いつでも一覧の内容を更新して、現在のプロセス一覧を確認できます。

5. **[プロセスにアタッチ]** ダイアログ ボックスの **[選択可能なプロセス]** ボックスの一覧で、アタッチするプログラムを探します。

    プロセスが別のユーザー アカウントで実行されている場合は、 **[すべてのユーザーからのプロセスを表示する]** チェック ボックスをオンにします。

6. **[アタッチ]** をクリックします。

## <a name="additional-info"></a>追加情報

デバッグ中には複数のプログラムにアタッチできますが、デバッガーでアクティブになっているプログラムは常に 1 つだけです。 アクティブなプログラムは、 **[デバッグの場所]** ツール バーまたは **[プロセス]** ウィンドウで設定できます。 詳細については、「 [方法 : 現在のプロセスを設定する](https://msdn.microsoft.com/7e1d7fa5-0e40-44cf-8c41-d3dba31c969e)」を参照してください。

信頼関係のないユーザー アカウントによって所有されているプロセスにアタッチしようとすると、セキュリティ警告の確認ダイアログ ボックスが表示されます。 詳細については、「[セキュリティ警告: 信頼されていないユーザーが所有するプロセスにアタッチするには危険が伴います。以下の情報に関して疑わしい点がある場合や、不明な場合は、このプロセスにアタッチしないでください](/visualstudio/debugger/security-warning-attaching-to-a-process-owned-by-an-untrusted-user?view=vs-2015)」を参照してください。

リモート デスクトップ (ターミナル サービス) セッションでのデバッグ時には、 **[選択可能なプロセス]** ボックスに、使用可能なプロセスのすべてが表示されない場合があります。 Visual Studio を、制限付きユーザー アカウントを持つユーザーとして実行している場合、 **[選択可能なプロセス]** ボックスの一覧には、セッション 0 で実行しているプロセスは表示されません。セッション 0 は、サービスおよび w3wp.exe を含むその他のサーバー プロセス用に使用されます。 この問題を解決するには、管理者アカウントで [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] を実行するか、ターミナル サービス セッションからではなくサーバー コンソールから [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] を実行します。 どちらの方法も実行できない場合、3 つ目の方法として、Windows コマンド ラインから `vsjitdebugger.exe -p` *ProcessId* を実行することによって、プロセスにアタッチできます。 プロセス ID は tlist.exe を使用して確認できます。 tlist.exe を入手するには、「  [WDK と WinDbg のダウンロード](/windows-hardware/drivers/dashboard/)」で入手できる Windows 用デバッグツールをダウンロードしてインストールします。

## <a name="common-debugging-scenarios"></a><a name="BKMK_Scenarios"></a> 一般的なデバッグ シナリオ

**プロセスにアタッチ**する必要があるかどうか、およびアタッチするプロセスを指定するために、いくつかの一般的なデバッグシナリオがここに示されています (一覧は完全ではありません)。 詳細な手順については、リンクを提供します。

一部の種類のアプリ (Windows ストアアプリなど) では、プロセス名に直接アタッチしませんが、代わりに [ **インストールされているアプリパッケージのデバッグ** ] メニューオプションを使用します (表を参照)。

> [!NOTE]
> Visual Studio での基本的なデバッグの詳細については、「 [デバッガーの概要](../debugger/getting-started-with-the-debugger.md)」を参照してください。

|シナリオ|Debug メソッド|[プロセス名]|メモとリンク|
|-|-|-|-|
|ローカルコンピューターでマネージアプリまたはネイティブアプリをデバッグする|プロセスへのアタッチまたは[標準のデバッグ](../debugger/getting-started-with-the-debugger.md)を使用する|*appname*|ダイアログボックスにすばやくアクセスするには、 **CTRL + ALT + P キー** を使用して、プロセス名の最初の文字を入力します。|
|デバッガーを使用せずにアプリを起動した後、ローカルコンピューターで ASP.NET アプリをデバッグする|プロセスにアタッチを使用する|iiexpress.exe|これは、(たとえば) プロファイリング時など、アプリの読み込みを高速化するために役立ちます。 |
|IIS サーバー上の ASP.NET 4 または 4.5 をリモート デバッグする|リモートツールを使用してプロセスにアタッチする|w3wp.exe|「リモートの[IIS コンピューターでのリモートデバッグ ASP.NET」を](../debugger/remote-debugging-aspnet-on-a-remote-iis-7-5-computer.md)参照してください。|
|IIS コンピューター上で ASP.NET Core をリモート デバッグする|リモートツールを使用してプロセスにアタッチする|dnx.exe|アプリの配置については、[IIS への発行](https://docs.asp.net/en/latest/publishing/iis.html)に関するページを参照してください。 デバッグについては、「リモート[デバッグ ASP.NET](../debugger/remote-debugging-aspnet-on-a-remote-iis-7-5-computer.md) 」を参照してください。|
|サーバー プロセスでサポートされている他の種類のアプリをデバッグする|リモートツールを使用し (サーバーがリモートの場合)、プロセスにアタッチする|iexplore.exe またはその他のプロセス|必要に応じて、タスクマネージャーを使用してプロセスを特定します。 このトピックの「 [リモートデバッグ](../debugger/remote-debugging.md) 」および「後のセクション」を参照してください。|
|Windows デスクトップ アプリをリモート デバッグする|リモートツールと F5|該当なし| [リモートデバッグ](../debugger/remote-debugging.md)に関する参照|
|Windows Universal (UWP)、OneCore、HoloLens、または IoT アプリのリモートデバッグ|インストールされているアプリ パッケージのデバッグ|N/A|**プロセスにアタッチする代わりに**、**デバッグ/その他のデバッグターゲットを使用する/インストールされているアプリケーションパッケージをデバッグ**する|
|Visual Studio から起動していない Windows ユニバーサル (UWP)、OneCore、HoloLens、または IoT アプリをデバッグする|インストールされているアプリ パッケージのデバッグ|N/A|**プロセスにアタッチする代わりに**、**デバッグ/その他のデバッグターゲットを使用する/インストールされているアプリケーションパッケージをデバッグ**する|

> [!WARNING]
> JavaScript で記述された Windows ユニバーサル アプリにアタッチするには、まずそのアプリに対してデバッグを有効にする必要があります。 Windows デベロッパー センター内の「 [Attach the debugger](../debugger/start-a-debugging-session-for-store-apps-in-visual-studio-javascript.md#BKMK_Attach_the_debugger) 」をご覧ください。

> [!NOTE]
> C++ で記述されたコードにデバッガーをアタッチするには、コードが `DebuggableAttribute`を生成する必要があります。 [/ASSEMBLYDEBUG](https://msdn.microsoft.com/library/94443af3-470c-41d7-83a0-7434563d7982) リンカー オプションを使ってリンクすると、これを自動的にコードに追加できます。

## <a name="what-debugger-features-can-i-use"></a>どのようなデバッガー機能を使用できますか。

プロセスにアタッチするときに Visual Studio デバッガーのすべての機能 (ブレークポイントのヒットなど) を使用するには、実行可能ファイルがローカルのソースとシンボルと完全に一致している必要があります (つまり、デバッガーは正しい [シンボル (pbd) ファイル](../debugger/specify-symbol-dot-pdb-and-source-files-in-the-visual-studio-debugger.md)を読み込む必要があります)。 既定では、これにはデバッグ ビルドが必要です。

リモート デバッグのシナリオでは、Visual Studio でソース コード (またはソース コードのコピー) を開いておく必要があります。 リモート マシンでコンパイルされたアプリ バイナリは、ローカル コンピューター上と同じビルドのものである必要があります。

一部のローカルデバッグシナリオでは、適切なシンボルファイルがアプリに存在する場合、ソースにアクセスせずに Visual Studio でデバッグできます (既定では、デバッグビルドが必要です)。 詳細については、「 [シンボルとソースファイルの指定](../debugger/specify-symbol-dot-pdb-and-source-files-in-the-visual-studio-debugger.md)」を参照してください。

## <a name="troubleshoot-attach-errors"></a><a name="BKMK_Troubleshoot_attach_errors"></a>アタッチ エラーをトラブルシューティングする
 実行中のプロセスにデバッガーがアタッチすると、このプロセスは、1 種類以上のコードを含むことができます。 デバッガーをアタッチできるコードの種類は **[コードの種類の選択]** ダイアログ ボックスで表示されて選択されています。

 デバッガーは、ある種類のコードに正常にアタッチできても、別の種類にはアタッチできないことがあります。 この問題は、リモート コンピューターで動作しているプロセスにアタッチしようとする場合に発生することがあります。 リモート コンピューターには、一部の種類のコードにしか対応しないリモート デバッグ コンポーネントがインストールされている場合があるためです。 また、ダイレクト データベース デバッグのために複数のプロセスにアタッチしようとした場合にも発生することがあります。 SQL デバッグ機能は、単一プロセスへのアタッチのみをサポートします。

 デバッガーが一部の種類のコードにしかアタッチできない場合は、アタッチできなかった種類を識別するメッセージが表示されます。

 デバッガーが少なくとも 1 種類のコードに正常にアタッチできる場合は、プロセスのデバッグを開始できます。 正常にアタッチされたコードの種類のみをデバッグできます。 上記のメッセージの例は、種類がスクリプトのコードにアタッチできなかったことを示しています。 この場合、プロセス内でスクリプト コードをデバッグできません。 プロセス内のスクリプト コードはそのまま実行されますが、スクリプトでのブレークポイントの設定、データの表示、またはその他のデバッグ操作は実行できません。

 デバッガーがコードの種類へのアタッチに失敗した理由についてより詳しい情報が必要な場合は、該当するコードの種類のみに再アタッチを試行できます。

 **コードの種類のアタッチに失敗した理由に関する特定の情報を取得するには**

1. プロセスからデタッチします。 **[デバッグ]** メニューの **[すべてデタッチ]** をクリックします。

2. コードの種類を 1 つだけ選択して、プロセスに再度アタッチします。

   1. [ **プロセスにアタッチ** ] ダイアログボックスで、[選択 **可能なプロセス** ] ボックスの一覧からプロセスを選択します。

   2. **[選択]** をクリックします。

   3. **[コードの種類の選択]** ダイアログ ボックスの **[次のコードの種類をデバッグする]** をクリックし、アタッチに失敗したコードの種類を選択します。 他のコードをすべてオフにします。

   4. **[OK]** をクリックします。 **[コードの種類の選択]** ダイアログ ボックスが閉じます。

   5. **[プロセスにアタッチ]** ダイアログ ボックスで、 **[アタッチ]** をクリックします。

      このとき、アタッチは完全に失敗し、詳細なエラー メッセージが表示されます。

## <a name="see-also"></a>参照
 [複数のプロセスのデバッグ](../debugger/debug-multiple-processes.md) [Just-in-time デバッグ](../debugger/just-in-time-debugging-in-visual-studio.md)[リモートデバッグ](../debugger/remote-debugging.md)
