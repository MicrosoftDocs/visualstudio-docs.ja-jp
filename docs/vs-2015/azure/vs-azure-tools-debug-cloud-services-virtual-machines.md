---
title: Azure クラウド サービスまたは Visual Studio での仮想マシンのデバッグ |Microsoft Docs
description: Visual Studio でのクラウド サービスまたは仮想マシンのデバッグ
author: mikejo5000
manager: douge
ms.assetid: 945e06e0-2100-41af-b218-72347367ddab
ms.topic: conceptual
ms.custom: vs-azure
ms.workload: azure-vs
ms.date: 11/11/2016
ms.author: mikejo
ms.prod: visual-studio-dev14
ms.technology: vs-ide-debug
ms.openlocfilehash: b2c67ce81a42df4a17761fcee2dcd2f8a67c4941
ms.sourcegitcommit: e481d0055c0724d20003509000fd5f72fe9d1340
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/05/2018
ms.locfileid: "51002942"
---
# <a name="debugging-an-azure-cloud-service-or-virtual-machine-in-visual-studio"></a>Azure クラウド サービスまたは Visual Studio での仮想マシンのデバッグ

Visual Studio では、Azure cloud services および仮想マシンをデバッグするためのさまざまなオプションを提供します。

## <a name="debug-your-cloud-service-on-your-local-computer"></a>ローカル コンピューターにクラウド サービスをデバッグします。

時間を節約でき、money、Azure を使用してコンピューティング エミュレーターは、ローカル コンピューターで、クラウド サービスをデバッグします。 展開する前に、サービスをローカルでデバッグ、コンピューティング時間に対して料金を支払うことがなくの信頼性とパフォーマンスを向上できます。 ただし、一部のエラーが発生する Azure でクラウド サービスを実行する場合にのみ自体。 サービスを発行し、ロール インスタンスにデバッガーをアタッチすると、リモート デバッグを有効にした場合、これらのエラーをデバッグすることができます。

エミュレーターでは、Azure コンピューティング サービスをシミュレートし、テストして展開する前に、クラウド サービスをデバッグできるように、ローカル環境で実行します。 エミュレーターでは、ロール インスタンスのライフ サイクルを処理し、ローカル ストレージなどのシミュレートされるリソースへのアクセスを提供します。 デバッグを Visual Studio からサービスを実行したりするときに自動的にバック グラウンド アプリケーションとして、エミュレーターが起動し、サービスがエミュレーターにデプロイされます。 エミュレーターを使用して、ローカル環境での実行時にサービスを表示することができます。 完全なバージョンまたは express のバージョンのエミュレーターを実行できます。 (Azure 2.3 以降、エミュレーターの express バージョンは、既定値) です。参照してください[Emulator Express を使用したクラウド サービスをローカル実行し、デバッグに](vs-azure-tools-emulator-express-debug-run.md)します。

### <a name="to-debug-your-cloud-service-on-your-local-computer"></a>ローカル コンピューターに、クラウド サービスをデバッグするには

1. メニュー バーで、**デバッグ**、**デバッグの開始** Azure クラウド サービス プロジェクトを実行します。 代わりに、f5 キーを押すことができます。 コンピューティング エミュレーターが起動するメッセージが表示されます。 エミュレーターの起動時に、システム トレイ アイコンを確認します。

    ![システム トレイの azure エミュレーター](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC783828.png)

2. 通知領域で Azure アイコンのショートカット メニューを開くことで、コンピューティング エミュレーターのユーザー インターフェイスを表示し、選択**コンピューティング エミュレーター UI**します。

    UI の左側のウィンドウには、コンピューティング エミュレーターと各サービスが実行されているロール インスタンスに現在展開されているサービスが表示されます。 サービスまたは右側のペインにライフ サイクル、ログ、および診断情報を表示するロールを選択できます。 含まれているウィンドウの上余白にフォーカスを移動する場合は、ウィンドウの右ペイン全体に展開します。

3. アプリケーションをステップ実行コマンドを選択して、**デバッグ**メニューと、コードにブレークポイントを設定します。 デバッガーでアプリケーションをステップ実行すると、ペインは、アプリケーションの現在の状態で更新されます。 デバッグを停止すると、アプリケーションのデプロイは削除されます。 Web ロールを含むアプリケーションの web ブラウザーを起動するスタートアップ アクション プロパティを設定した場合は、Visual Studio は、ブラウザーで web アプリケーションを起動します。 サービス構成でロールのインスタンスの数を変更する場合は、クラウド サービスを停止し、ロールのこれらの新しいインスタンスをデバッグするため、デバッグを再開する必要があります。

    **注:** の実行や、サービスのデバッグを停止すると、ローカル計算エミュレーターおよびストレージ エミュレーターは停止しません。 通知領域から明示的に停止する必要があります。

## <a name="debug-a-cloud-service-in-azure"></a>Azure でクラウド サービスをデバッグする

リモート コンピューターからクラウド サービスをデバッグするには、必要があります機能を有効にその明示的にために必要なサービス (msvsmon.exe など) は、ロール インスタンスを実行する仮想マシンにインストールされているように、クラウド サービスをデプロイするときにします。 サービスを発行したときに、リモート デバッグを有効にしていない場合は、リモート デバッグを有効に、サービスを再発行する必要があります。

クラウド サービスのリモート デバッグを有効にした場合は、パフォーマンスが低下または追加料金が発生しません。 使用しない運用環境のサービスでのリモート デバッグ サービスを利用するクライアントに悪影響を受ける可能性があるためです。

> [!NOTE]
> できるように Visual Studio からクラウド サービスを発行するときに**IntelliTrace**を .NET Framework 4 または .NET Framework 4.5 を対象とする役割がそのサービス内の。 使用して**IntelliTrace**過去にロール インスタンスで発生したイベントを確認し、その時点からコンテキストを再現できます。 参照してください[IntelliTrace および Visual Studio で発行済みのクラウド サービスのデバッグ](http://go.microsoft.com/fwlink/?LinkID=623016)と[IntelliTrace を使用した](https://msdn.microsoft.com/library/dd264915.aspx)します。

### <a name="to-enable-remote-debugging-for-a-cloud-service"></a>クラウド サービスのリモート デバッグを有効にするには

1. Azure のプロジェクトのショートカット メニューを開きを選択します**発行**します。

2. 選択、**ステージング**環境と**デバッグ**構成します。

    これは、単なるガイドラインです。 テスト環境を運用環境で実行できます。 ただし、運用環境でのリモート デバッグを有効にした場合のユーザーに悪影響可能性があります。 リリース構成を選択できますが、デバッグ構成がデバッグは簡単です。

    ![デバッグ構成を選択します。](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746717.gif)

3. 通常の手順に従いますが、選択、**すべてのロールのリモート デバッガーを有効にする**チェック ボックスをオン、**詳細設定**タブ。

    ![デバッグ構成](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746718.gif)

### <a name="to-attach-the-debugger-to-a-cloud-service-in-azure"></a>Azure でクラウド サービスにデバッガーをアタッチするには

1. サーバー エクスプ ローラーでは、クラウド サービスのノードを展開します。

2. に接続し、選択するロールまたはロール インスタンスのショートカット メニューを開き**デバッガーのアタッチ**します。

    ロールをデバッグする場合は、そのロールの各インスタンスに、Visual Studio デバッガーがアタッチされます。 コード行を実行し、そのブレークポイントの条件を満たしている最初のロール インスタンスのブレークポイントでデバッガーが中断されます。 インスタンス、そのインスタンスとその特定のインスタンスがそのコード行を実行し、ブレークポイントの条件を満たしている場合にのみ、ブレークポイントで停止するデバッガーのアタッチをデバッグするかどうか。

    ![デバッガーのアタッチ](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746719.gif)

3. デバッガーは、インスタンスにアタッチして後で通常どおりにデバッグします。 デバッガーは、自動的に、ロールの適切なホスト プロセスにアタッチします。 によって、ロールは、デバッガーは、w3wp.exe、WaWorkerHost.exe、または WaIISHost.exe にアタッチします。 デバッガーがアタッチされているプロセスを確認するには、サーバー エクスプ ローラーでインスタンス ノードを展開します。 参照してください[Azure ロール アーキテクチャ](http://blogs.msdn.com/b/kwill/archive/2011/05/05/windows-azure-role-architecture.aspx)Azure プロセスの詳細についてはします。

    ![コードの種類 ダイアログ ボックスを選択します。](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC718346.png)

4. デバッガーがアタッチされているプロセスを識別するために、メニュー バー、デバッグ、Windows、プロセスを選択して、プロセス ダイアログ ボックスを開きます。 (キーボード: Ctrl + Alt + Z)特定のプロセスをデタッチするには、ショートカット メニューを開いて選び**プロセスのデタッチ**します。 または、サーバー エクスプ ローラーでインスタンス ノードを特定、プロセス、そのショートカット メニューを開いて見つけて選択します**プロセスのデタッチ**します。

    ![プロセスのデバッグ](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC690787.gif)

> [!WARNING]
> ときに、リモートのブレークポイントで長時間停止させるを避けるためのデバッグします。 Azure では、応答不能と、数分間より長くが停止し、そのインスタンスへのトラフィック送信を停止するプロセスを処理します。 長期間停止した場合、msvsmon.exe はプロセスからデタッチされます。

インスタンスまたはロールのすべてのプロセスからデバッガーをデタッチするには、ロールまたはインスタンスをデバッグし、ショートカット メニューを開き**デバッガーのデタッチ**します。

## <a name="limitations-of-remote-debugging-in-azure"></a>Azure でのリモート デバッグの制限事項

Azure SDK 2.3 以降は、リモート デバッグと、次の制限があります。

* リモート デバッグを有効にすると、任意のロールに 25 を超えるインスタンスがであるクラウド サービスを発行することはできません。
* デバッガーは、ポートは、30400 ~ 30424、31400 ~ 31424、および 32400 ~ 32424 です。 これらのポートを使用しようとする場合、サービスを発行することはできませんし、次のエラー メッセージの 1 つは、Azure のアクティビティ ログに表示されます。

  * .Csdef ファイルに対して .cscfg ファイルを検証中にエラー。
    エンドポイントの予約済みのポート範囲 '範囲' Microsoft.WindowsAzure.Plugins.RemoteDebugger.Connector のロール 'ロール' は、既に定義されているポートまたは範囲と重複します。
  * 割り当てに失敗しました。 後で再試行して、VM のサイズまたはロール インスタンスの数を減らしてくださいか、別のリージョンにデプロイしてみてください。

## <a name="debugging-azure-virtual-machines"></a>Azure の仮想マシンのデバッグ

Visual Studio でサーバー エクスプ ローラーを使用して、Azure virtual machines で実行されるプログラムをデバッグすることができます。 Azure の仮想マシンでリモート デバッグを有効にすると、Azure は、仮想マシンにリモート デバッグ拡張機能をインストールします。 次に、仮想マシン上のプロセスにアタッチし、通常どおりにデバッグできます。

> [!NOTE]
> Azure リソース マネージャー スタックを通して作成された仮想マシンは、Visual Studio 2015 のクラウド エクスプ ローラーを使用してリモートでデバッグできます。 詳細については、次を参照してください。[クラウド エクスプ ローラーでの Azure リソースの管理](http://go.microsoft.com/fwlink/?LinkId=623031)します。

### <a name="to-debug-an-azure-virtual-machine"></a>Azure の仮想マシンをデバッグするには

1. サーバー エクスプ ローラーで、仮想マシン ノードを展開し、デバッグする仮想マシンのノードを選択します。

2. コンテキスト メニューを開き、選択**デバッグを有効にする**します。 仮想マシンでデバッグを有効にする場合を確認するメッセージが表示されたら**はい**します。

    Azure では、デバッグを有効にする仮想マシンにリモート デバッグ拡張機能をインストールします。

    ![仮想マシンのデバッグ コマンドを有効にします。](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746720.png)

    ![Azure アクティビティ ログ](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746721.png)

3. 仮想マシンのコンテキスト メニューを開き、リモート デバッグ拡張機能では、インストールが完了すると、選択**デバッガーのアタッチしています.**

    Azure では、仮想マシンでプロセスの一覧を取得しにアタッチするプロセス ダイアログ ボックスでそれらを表示します。

    ![コマンドのデバッガーをアタッチします。](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746722.png)

4. **プロセスにアタッチ**ダイアログ ボックスで、**選択**をデバッグするコードの種類のみを表示する結果の一覧に制限します。 32 ビットまたは 64 ビットのマネージ コード、ネイティブ コード、またはその両方をデバッグすることができます。

    ![コードの種類 ダイアログ ボックスを選択します。](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC718346.png)

5. 仮想マシンでデバッグしを選択するプロセスを選択して**アタッチ**します。 たとえば、仮想マシン上の web アプリをデバッグする場合は、w3wp.exe プロセスを選択可能性があります。 参照してください[または Visual Studio での複数のプロセスの 1 つのデバッグ](https://msdn.microsoft.com/library/jj919165.aspx)と[Azure ロール アーキテクチャ](http://blogs.msdn.com/b/kwill/archive/2011/05/05/windows-azure-role-architecture.aspx)詳細についてはします。

## <a name="create-a-web-project-and-a-virtual-machine-for-debugging"></a>Web プロジェクトとデバッグ用の仮想マシンを作成します。

Azure プロジェクトを発行する前に役立つ、デバッグと、テスト シナリオをサポートして、テストおよびモニタリング プログラムをインストールする、格納されている環境でテストすることです。 このようなテストを実行する 1 つの方法では、仮想マシンでアプリケーションをリモートでデバッグします。

Visual Studio の ASP.NET プロジェクトでは、アプリをテストするために使用できる便利な仮想マシンを作成するオプションを提供します。 仮想マシンには、PowerShell、リモート デスクトップ、WebDeploy など、一般的に必要なエンドポイントが含まれています。

### <a name="to-create-a-web-project-and-a-virtual-machine-for-debugging"></a>Web プロジェクトとデバッグ用の仮想マシンを作成するには

1. Visual Studio で新しい ASP.NET Web アプリケーションを作成します。

2. [新しい ASP.NET プロジェクト] ダイアログ ボックスの [Azure] セクションで、次のように選択します。**仮想マシン**ボックスの一覧にします。 ままに、**リモート リソースを作成する**チェック ボックスをオンします。 選択**OK**を続行します。

    **On Azure 仮想マシンを作成する** ダイアログ ボックスが表示されます。

    ![ASP.NET web プロジェクト ダイアログ ボックスを作成します。](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746723.png)

    **注:** サインインしていない場合は、Azure アカウントにサインインを求められます。

3. 仮想マシンのさまざまな設定を選択し、選択**OK**します。 参照してください[仮想マシン](http://go.microsoft.com/fwlink/?LinkId=623033)詳細についてはします。

    DNS 名を入力した名前は、仮想マシンの名前になります。

    ![Azure のダイアログ ボックスでの仮想マシンを作成します。](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746724.png)

    Azure 仮想マシンとし、プロビジョニングを作成し、リモート デスクトップと Web 配置など、エンドポイントを構成します。

4. 仮想マシンを完全に構成した後は、サーバー エクスプ ローラーで、仮想マシンのノードを選択します。

5. コンテキスト メニューを開き、選択**デバッグを有効にする**します。 仮想マシンでデバッグを有効にする場合を確認するメッセージが表示されたら**はい**します。

    Azure では、デバッグを有効にする仮想マシンにリモート デバッグ拡張機能をインストールします。

    ![仮想マシンのデバッグ コマンドを有効にします。](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746720.png)

    ![Azure アクティビティ ログ](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746721.png)

6. 説明したようにプロジェクトを発行[方法: デプロイを Web プロジェクトを使用してワンクリックで Visual Studio で発行](https://msdn.microsoft.com/library/dd465337.aspx)します。 仮想マシンでデバッグするため、**設定**のページ、 **Web の発行**ウィザードで、**デバッグ**として構成します。 これにより、デバッグ中に、コードのシンボルが使用できることを確認します。

    ![発行の設定](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC718349.png)

7. **ファイル発行オプション**、**転送先に追加のファイルを削除**プロジェクトは以前の時点で既に配置されている場合。

8. サーバー エクスプ ローラーで、仮想マシンのコンテキスト メニューで、プロジェクトを発行したら選択**デバッガーのアタッチしています.**

    Azure では、仮想マシンでプロセスの一覧を取得しにアタッチするプロセス ダイアログ ボックスでそれらを表示します。

    ![コマンドのデバッガーをアタッチします。](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC746722.png)

9. **プロセスにアタッチ**ダイアログ ボックスで、**選択**をデバッグするコードの種類のみを表示する結果の一覧に制限します。 32 ビットまたは 64 ビットのマネージ コード、ネイティブ コード、またはその両方をデバッグすることができます。

    ![コードの種類 ダイアログ ボックスを選択します。](./media/vs-azure-tools-debug-cloud-services-virtual-machines/IC718346.png)

10. 仮想マシンでデバッグしを選択するプロセスを選択して**アタッチ**します。 たとえば、仮想マシン上の web アプリをデバッグする場合は、w3wp.exe プロセスを選択可能性があります。 参照してください[または Visual Studio での複数のプロセスの 1 つのデバッグ](https://msdn.microsoft.com/library/jj919165.aspx)詳細についてはします。

## <a name="next-steps"></a>次の手順

* 使用**Intellitrace**リリース サーバーからの呼び出しおよびイベント ログを収集します。 参照してください[IntelliTrace および Visual Studio で発行済みのクラウド サービスのデバッグ](http://go.microsoft.com/fwlink/?LinkID=623016)します。

* 使用**Azure 診断**ロールは、開発環境または Azure で実行しているかどうか、ロール内で実行されているコードから詳細情報を記録します。 参照してください[Azure 診断を使用したログ データの収集](http://go.microsoft.com/fwlink/p/?LinkId=400450)します。
