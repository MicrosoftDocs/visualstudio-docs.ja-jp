---
title: Azure ツールを使用してクラウド サービスの発行 |Microsoft Docs
description: Visual Studio を使用して Azure クラウド サービス プロジェクトを発行する方法について説明します。
author: ghogen
manager: douge
assetId: 1a07b6e4-3678-4cbf-b37e-4520b402a3d9
ms.prod: visual-studio-dev14
ms.technology: vs-azure
ms.custom: vs-azure
ms.workload: azure-vs
ms.topic: conceptual
ms.date: 11/11/2017
ms.author: ghogen
ms.openlocfilehash: cf29e1cdde71d2e8ef7caa9bc91bc31c30c7bc41
ms.sourcegitcommit: e481d0055c0724d20003509000fd5f72fe9d1340
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/05/2018
ms.locfileid: "51002859"
---
# <a name="publishing-a-cloud-service-using-visual-studio"></a>Visual Studio を使用したクラウド サービスの発行

Visual Studio では、クラウド サービスのステージング環境と運用環境の両方の環境のサポートを Azure に直接アプリケーションを発行できます。 発行するときは、デプロイ環境と展開パッケージに一時的に使用されるストレージ アカウントを選択します。

開発や、Azure アプリケーションをテストしている、Web Deploy を使用、web ロールの変更を段階的発行するのにことができます。 デプロイ環境にアプリケーションを発行した後、Web デプロイによって、その web ロールを実行している仮想マシンに直接変更をデプロイできます。 パッケージ化して Azure アプリケーション全体に変更をテストする web ロールを更新するたびに発行する必要はありません。 この方法により、デプロイ環境に発行されたアプリケーションがあるを待たなくてもテスト用のクラウドで使用可能な web ロールの変更ことができます。

Azure アプリケーションを発行して、Web Deploy を使用して web ロールの更新は、次の手順を使用します。

- Visual Studio から Azure アプリケーションをパッケージ化または発行
- 開発およびテスト サイクルの一部としての web ロールを更新します。

## <a name="publish-or-package-an-azure-application-from-visual-studio"></a>Visual Studio から Azure アプリケーションをパッケージ化または発行

Azure アプリケーションを発行するときに、次のタスクのいずれかの操作を行います。

- サービス パッケージを作成します。 からデプロイ環境にアプリケーションを発行する、このパッケージとサービス構成ファイルを使用することができます、 [Azure portal](https://portal.azure.com)します。

- Visual Studio から Azure プロジェクトを発行します。 Azure に直接アプリケーションを発行するには、発行ウィザードを使用します。 詳しくは、次を参照してください。 [Azure アプリケーション発行ウィザード](vs-azure-tools-publish-azure-application-wizard.md)します。

### <a name="to-create-a-service-package-from-visual-studio"></a>Visual Studio からサービス パッケージを作成するには

1. アプリケーションを発行する準備ができたら、ソリューション エクスプ ローラーを開くしの役割を含む Azure プロジェクトのショートカット メニューを開き発行 を選択します。

1. サービス パッケージのみを作成するには、次の手順を実行します。

   a.  Azure プロジェクトのショートカット メニューを選択して**パッケージ**します。

   b.  **Azure アプリケーションのパッケージ**ダイアログ ボックスで、パッケージを作成するサービス構成を選択し、ビルド構成を選択します。

   c. (省略可能)オンにするリモート デスクトップ、クラウド サービスの発行した後、次のように選択します。**すべてのロールのリモート デスクトップを有効にする**、し、**設定**リモート デスクトップ資格情報を構成します。 詳細については、次を参照してください。 [Visual Studio を使用して Azure Cloud services ロールのリモート デスクトップ接続を有効にする](/azure/cloud-services/cloud-services-role-enable-remote-desktop-visual-studio)します。

      パブリッシュした後は、クラウド サービスをデバッグする場合を選択して、リモート デバッグを有効にする**すべてのロールのリモート デバッガーを有効にする**します。

   d. パッケージを作成するには、選択、**パッケージ**リンク。

      ファイル エクスプ ローラーでは、新しく作成したパッケージのファイルの場所が表示されます。 Azure portal から使用できるように、この場所をコピーできます。

   e. デプロイ環境にこのパッケージを発行するには、クラウド サービスを作成して、Azure portal で、環境にこのパッケージを展開するときに、パッケージの場所としてこの場所を使用する必要があります。

1. (省略可能)アクティビティ ログの行項目のショートカット メニューで、デプロイ プロセスをキャンセルするには、**キャンセルし、削除**します。 このコマンドは、展開プロセスを停止し、Azure からデプロイ環境を削除します。 デプロイ後に、環境を削除するには、Azure portal を使用します。

1. (省略可能)Visual Studio が自動的にデプロイ環境を表示して、ロール インスタンスが起動すると、 **Cloud Services**サーバー エクスプ ローラー ノード。 ここでは、個々 のロール インスタンスの状態を確認できます。 参照してください[クラウド エクスプ ローラーで管理する Azure リソース](vs-azure-tools-resources-managing-with-cloud-explorer.md)します。次の図は、まだ初期化中の状態では、ロール インスタンスを示します。

    ![VST_DeployComputeNode](./media/vs-azure-tools-publishing-a-cloud-service/IC744134.png)

## <a name="update-a-web-role-as-part-of-the-development-and-testing-cycle"></a>開発およびテスト サイクルの一部としての web ロールを更新します。

アプリのバックエンド インフラストラクチャは安定していて、web ロールより頻繁に更新する場合は、Web Deploy を使用してプロジェクトの web ロールのみを更新します。 Web Deploy は、再構築し、バックエンド worker ロールを再デプロイしない場合、または複数の web ロールがあるし、web ロールの 1 つだけを更新する場合に便利です。

### <a name="requirements-for-using-web-deploy"></a>Web Deploy を使用するための要件

- **開発とテストのみを目的として**: web ロールが実行されている仮想マシンに直接適用は、変更します。 この仮想マシンをリサイクルする場合、元のパッケージを発行したが、ロールの仮想マシンを再作成に使用されるため、変更は失われます。 Web ロールの最新の変更を取得するアプリケーションを再発行します。

- **Web ロールのみを更新できる**: Worker ロールを更新することはできません。 さらに、更新することはできません、`RoleEntryPoint`で`web role.cs`します。

- **Web ロールの 1 つのインスタンスしかサポート**: デプロイ環境で web ロールの複数のインスタンスを持つことはできません。 ただし、複数の web ロールごとの 1 つだけのインスタンスとはサポートされます。

- **リモート デスクトップ接続を有効にする**: この要件により、インターネット インフォメーション サービス (IIS) を実行しているサーバーに変更をデプロイする仮想マシンに接続するユーザーとパスワードを使用して Web 配置ができます。 さらに、この仮想マシンで IIS に信頼された証明書を追加する仮想マシンに接続する必要があります。 (この証明書により、Web Deploy によって使用される IIS のリモート接続が安全である)。

次の手順を使用しているものと、 **Azure アプリケーションの発行**ウィザード。

### <a name="enable-web-deploy-when-you-publish-your-application"></a>アプリケーションを発行するときに、Web Deploy を有効に

1. 有効にする、**すべての web ロールの Web Deploy を有効にする**オプションでは、まず、リモート デスクトップ接続を構成する必要があります。 選択**リモート デスクトップを有効にする**すべてのロールの後に、リモート接続に使用される資格情報を入力、**リモート デスクトップ構成**表示されるボックス。 参照してください[Visual Studio を使用して Azure Cloud services ロールのリモート デスクトップ接続を有効にする](/azure/cloud-services/cloud-services-role-enable-remote-desktop-visual-studio)します。

1. アプリケーション内のすべての web ロールの Web Deploy を有効にするに**すべての web ロールの Web Deploy を有効にする**します。

    警告の黄色い三角形が表示されます。 Web Deploy は、機密データをアップロードするのには使用しないで、既定で信頼されていない自己署名証明書を使用します。 このプロセスの機微なデータを保護する必要がある場合は、Web Deploy の接続に使用する SSL 証明書を追加できます。 この証明書を信頼された証明書が必要です。 詳細については、次を参照してください。 [web 配置のセキュリティを確保](#make-web-deploy-secure)します。

1. 選択 **[次へ]** を表示する、**概要**画面を選び、**発行**クラウド サービスをデプロイします。

    クラウド サービスが公開されます。 作成される仮想マシンには、それらを再発行しなくても、web ロールを更新する Web Deploy を使用できるように IIS を有効になっているリモートの接続があります。

   > [!NOTE]
   > Web ロール用に構成された 1 つ以上のインスタンスがある場合は、web ロールごとに 1 つのインスタンスでは、アプリケーションを発行する作成されるパッケージのみに制限されていることを示す警告メッセージが表示されます。 選択**OK**を続行します。 要件セクションで述べたように、各ロールのインスタンスを 1 つだけが、web ロールを 1 つ以上のことができます。

### <a name="update-your-web-role-by-using-web-deploy"></a>Web Deploy を使用して、web ロールを更新します。

1. Web Deploy を使用するには、発行とし、ソリューションでは、このプロジェクト ノードを右クリックし をポイントする Visual Studio で web ロールのいずれかのプロジェクトにコードの変更を加える**発行**します。 **Web の発行** ダイアログ ボックスが表示されます。

1. (省略可能)IIS のリモート接続に使用する信頼された SSL 証明書を追加する場合は、オフ、**信頼されていない証明書を許可する**チェック ボックスをオンします。 Web Deploy のセキュリティに証明書を追加する方法については、セクションをご覧ください。**に Web デプロイを確保する**この記事で後述します。

1. Web Deploy を使用するには、発行メカニズムは、ユーザー名とパスワードを最初に、パッケージを発行したときに、リモート デスクトップ接続を設定する必要があります。

   a.  **ユーザー名**ユーザー名を入力します。

   b.  **パスワード**パスワードを入力します。

   c. (省略可能)このプロファイルでこのパスワードを保存する場合は、選択**パスワードの保存**します。

1. Web ロールへの変更を発行する**発行**します。

    状態行を表示します**発行を開始しました**します。 発行が完了したら、**発行は成功しました**が表示されます。 変更は、仮想マシンで web ロールにデプロイされているようになりました。 今すぐ変更をテストする Azure 環境で Azure アプリケーションを開始できます。

### <a name="make-web-deploy-secure"></a>Web 配置のセキュリティを確保します。

1. Web Deploy は、機密データをアップロードするのには使用しないで、既定で信頼されていない自己署名証明書を使用します。 このプロセスの機微なデータを保護する必要がある場合は、Web Deploy の接続に使用する SSL 証明書を追加できます。 この証明書を証明書機関 (CA) から取得した信頼された証明書が必要です。

    Web Deploy のセキュリティを確保各仮想マシンの各 web ロールには、web を使用する信頼された証明書をアップロードする必要があります、Azure portal に展開します。 この証明書により、証明書を web ロール、アプリケーションを発行するときに作成される仮想マシンに追加されたことを確認します。

1. IIS のリモート接続を使用するには、信頼された SSL 証明書を追加するには、次の手順を実行します。

   a.  Web ロールを実行している仮想マシンに接続するには、web ロールのインスタンスを選択します**Cloud Explorer**または**サーバー エクスプ ローラー**を選択し、**リモート デスクトップを使用して接続。** コマンド。 仮想マシンに接続する方法の詳細については、次を参照してください。 [Visual Studio を使用して Azure Cloud services ロールのリモート デスクトップ接続を有効にする](/azure/cloud-services/cloud-services-role-enable-remote-desktop-visual-studio)します。 お使いのブラウザーでは、ダウンロードするように求め、`.rdp`ファイル。

   b.  SSL 証明書を追加するには、IIS マネージャーで管理サービスを開きます。 IIS マネージャーで、開くことで SSL を有効にする、**バインド**のリンクを**アクション**ウィンドウ。 **サイト バインドの追加** ダイアログ ボックスが表示されます。 選択**追加**で HTTPS を選択し、**型**ドロップダウン リスト。 **SSL 証明書**一覧で、CA による署名済み、および Azure portal にアップロードした SSL 証明書を選択します。 詳細については、次を参照してください。[管理サービスの接続設定の構成](http://go.microsoft.com/fwlink/?LinkId=215824)します。

      > [!NOTE]
      > 黄色の三角形の警告が表示されない場合、信頼された SSL 証明書を追加する、**発行ウィザード**します。

## <a name="include-files-in-the-service-package"></a>サービス パッケージにファイルを含める

ロール用に作成した仮想マシンで使用できるようにするために、サービス パッケージに特定のファイルを含める必要がある可能性があります。 追加するなど、`.exe`または`.msi`サービス パッケージにスタートアップ スクリプトで使用されるファイル。 または、web ロールまたはワーカー ロール プロジェクトが必要なアセンブリを追加する必要があります。 ファイルを含めるには、これらは、Azure アプリケーションのソリューションに追加する必要があります。

1. をサービス パッケージにアセンブリを追加するには、次の手順を使用します。

   a.  **ソリューション エクスプ ローラー**、参照先のアセンブリが欠けているプロジェクトのプロジェクト ノードを開きます。
   b.  アセンブリをプロジェクトに追加するには、ショートカット メニューを開き、**参照**フォルダー選び、**参照の追加**します。 [参照の追加] ダイアログが表示されます。
   c. 参照を追加したいを**OK**します。 下の一覧に参照を追加、**参照**フォルダー。
   d. 追加したアセンブリのショートカット メニューを開き、選択**プロパティ**します。 **プロパティ**ウィンドウが表示されます。

      サービス パッケージでは、このアセンブリを含める、**一覧のローカル コピー**選択**True**します。
1. **ソリューション エクスプ ローラー**参照先のアセンブリが欠けているプロジェクトのプロジェクト ノードを開きます。

1. アセンブリをプロジェクトに追加するには、ショートカット メニューを開き、**参照**フォルダー選び、**参照の追加**します。 **参照の追加**ダイアログが表示されます。

1. 参照を追加したいを**OK**ボタンをクリックします。

    下の一覧に参照を追加、**参照**フォルダー。

1. 追加したアセンブリのショートカット メニューを開き、選択**プロパティ**します。 [プロパティ] ウィンドウが表示されます。

1. サービス パッケージでは、このアセンブリを含める、**ローカル コピー**一覧で、選択**True**します。

1. ファイルを web ロール プロジェクトに追加されたサービス パッケージに含めるにはファイルのショートカット メニューを開きし、**プロパティ**します。 **プロパティ**ウィンドウで、選択**コンテンツ**から、**ビルド アクション**ボックスの一覧。

1. ワーカー ロール プロジェクトに追加されたサービス パッケージにファイルをインクルードするファイルのショートカット メニューを開きし、**プロパティ**します。 **プロパティ**ウィンドウで、選択**新しい場合はコピー**から、**出力ディレクトリにコピー**ボックスの一覧。

## <a name="next-steps"></a>次の手順

Azure への発行の詳細を Visual Studio からについて、次を参照してください。 [Azure アプリケーション発行ウィザード](vs-azure-tools-publish-azure-application-wizard.md)します。
