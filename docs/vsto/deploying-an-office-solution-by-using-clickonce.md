---
title: ClickOnce を使用して Office ソリューションの配置 |Microsoft ドキュメント
ms.custom: ''
ms.date: 02/02/2017
ms.technology:
- office-development
ms.topic: conceptual
dev_langs:
- VB
- CSharp
helpviewer_keywords:
- Office development in Visual Studio, deploying solutions
- ClickOnce deployment [Office development in Visual Studio], deploying solutions
author: TerryGLee
ms.author: tglee
manager: douge
ms.workload:
- office
ms.openlocfilehash: 0b5e1b9437412f343874b8cca6513a551d9900d0
ms.sourcegitcommit: 6a9d5bd75e50947659fd6c837111a6a547884e2a
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/16/2018
---
# <a name="deploying-an-office-solution-by-using-clickonce"></a>ClickOnce を使用した Office ソリューションの配置
  ClickOnce を使用する場合は、少しの手順で Office ソリューションを配置できます。 更新プログラムを発行する場合は、ソリューションはそれらを自動的に検出してインストールします。 ただし、ClickOnce を使用する場合は、コンピューターのユーザーごとに、ソリューションを個別にインストールする必要があります。 したがって、複数のユーザーが同じコンピューターでソリューションを実行する場合は、Windows インストーラー (.msi) の使用を検討する必要があります。  
  
## <a name="in-this-topic"></a>このトピックの内容  
  
-   [ソリューションを発行します。](#Publish)  
  
-   [ソリューションに信頼を付与する方法を決定します。](#Trust)  
  
-   [ユーザーがソリューションをインストールできます。](#Helping)  
  
-   [ソリューションのドキュメントをエンドユーザーのコンピューター (ドキュメント レベルのカスタマイズのみ) に配置します。](#Put)  
  
-   [ソリューションのドキュメント (ドキュメント レベルのカスタマイズのみ) SharePoint を実行しているサーバーに配置します。](#SharePoint)  
  
-   [カスタム インストーラーを作成します。](#Custom)  
  
-   [更新プログラムを発行します。](#Update)  
  
-   [ソリューションのインストール場所を変更します。](#Location)  
  
-   [ソリューションを以前のバージョンにロールバックします。](#Roll)  
  
 Windows インストーラー ファイルを作成して Office ソリューションを配置する方法の詳細については、次を参照してください。 [Windows インストーラーを使用した Office ソリューションの配置](../vsto/deploying-an-office-solution-by-using-windows-installer.md)です。  
  
##  <a name="Publish"></a> ソリューションを発行します。  
 使用してソリューションを発行することができます、**発行ウィザード**または**プロジェクト デザイナー**です。 この手順で使用する、**プロジェクト デザイナー**パブリッシング オプションの完全なセットを提供するためです。 参照してください[発行ウィザード&#40;Visual Studio での Office 開発&#41;](../vsto/publish-wizard-office-development-in-visual-studio.md)です。  
  
#### <a name="to-publish-the-solution"></a>ソリューションを発行するには  
  
1.  **ソリューション エクスプ ローラー**プロジェクトの名前は、ノードを選択します。  
  
2.  メニュー バーで、次のように選択します。**プロジェクト**、 *ProjectName* **プロパティ**です。  
  
3.  **プロジェクト デザイナー**、選択、**発行**タブで、次の図に示します。  
  
     ![プロジェクト デザイナーの [発行] タブ](../vsto/media/vsto-publishtab.png "プロジェクト デザイナーの [発行] タブ")  
  
4.  **発行フォルダーの場所 (ftp サーバー、またはファイル パス)**先フォルダーのパスを入力、**プロジェクト デザイナー**ソリューション ファイルをコピーします。  
  
     次のいずれかの種類のパスを入力できます。  
  
    -   ローカル パス (たとえば、 *C:\FolderName\FolderName*)。  
  
    -   ネットワーク上のフォルダーへの汎用名前付け規則 (UNC) パス (たとえば、  *\\\ServerName\FolderName*)。  
  
    -   相対パス (たとえば、 *PublishFolder\\*既定では、プロジェクトが公開されるフォルダーである)。  
  
5.  **インストール フォルダーの URL**ボックスで、エンドユーザーが目に、ソリューションの場所の完全修飾パスを入力します。  
  
     場所が分からないをまだ場合は、このフィールドに何も入力しません。 既定では、ClickOnce はこのフォルダーの中で、ユーザーがソリューションをインストールするための更新プログラムを検索します。  
  
6.  **[必須コンポーネント]** ボタンをクリックします。  
  
7.  **の前提条件** ダイアログ ボックスで、いることを確認、**前提条件コンポーネントをインストールするセットアップ プログラムを作成する** チェック ボックスをオンします。  
  
8.  **をインストールする必須コンポーネントを選択**一覧で、チェック ボックスをオン**Windows インストーラー 4.5**と適切な .NET Framework パッケージです。  
  
     たとえば場合、ソリューションが対象、 [!INCLUDE[net_v45](../vsto/includes/net-v45-md.md)]、チェック ボックスをオン**Windows インストーラー 4.5**と**Microsoft .NET Framework 4.5 Full**です。  
  
9. 場合は、ソリューションでは、.NET Framework 4.5 をターゲットとも選択、 **Visual Studio 2010 Tools for Office Runtime**チェック ボックスをオンします。  
  
    > [!NOTE]  
    >  既定では、このチェック ボックスは表示されません。 このチェック ボックスを表示するには、ブートストラップ パッケージを作成する必要があります。 参照してください[Visual Studio 2012 での Office 2013 VSTO アドインをブートス トラップ パッケージを作成する](http://blogs.msdn.com/b/vsto/archive/2012/12/21/creating-a-bootstrapper-package-for-an-office-2013-vsto-add-in-with-visual-studio-2012.aspx)です。  
  
10. **の前提条件のインストール場所を指定**、表示を選択し、オプションのいずれかを選択、 **ok**ボタンをクリックします。  
  
     各オプションの説明を次の表に示します。  
  
    |オプション|説明|  
    |------------|-----------------|  
    |**必須コンポーネントをコンポーネントの開発元の Web サイトからダウンロードする**|ユーザーは、販売元からこれらの必須コンポーネントをダウンロードしてインストールするように求められます。|  
    |**アプリケーションと同じ場所から必須コンポーネントをダウンロードする**|必要なソフトウェアは、ソリューションと共にインストールされます。 このオプションを選択すると、Visual Studio はすべての必須パッケージを発行場所に自動的にコピーします。 このオプションを使用するには、必須パッケージが開発用コンピューターに存在する必要があります。|  
    |**次の場所から必須コンポーネントをダウンロード**|Visual Studio は、指定した場所にすべての必須パッケージをコピーし、ソリューションと共にそれらをインストールします。|  
  
     参照してください[の前提条件 ダイアログ ボックス](/visualstudio/ide/reference/prerequisites-dialog-box)です。  
  
11. 選択、**更新**ボタンを各エンドユーザーの VSTO アドインまたはカスタマイズをクリックして、更新プログラムを確認する頻度を指定、 **[ok]**ボタンをクリックします。  
  
    > [!NOTE]  
    >  を CD またはリムーバブル ドライブを使用して配置する場合は、選択、**更新プログラムを確認しない**オプション ボタンをクリックします。  
  
     更新を発行する方法については、次を参照してください。[更新プログラムの発行](#Update)です。  
  
12. 選択、**オプション**ボタン、[オプションを確認、**オプション**] ダイアログ ボックスをクリックして、 **[ok]**ボタンをクリックします。  
  
13. 選択、 **今すぐ発行**ボタンをクリックします。  
  
     この手順で既に指定した発行フォルダーに、Visual Studio は次のフォルダーとファイルを追加します。  
  
    -   **アプリケーション ファイル**フォルダーです。  
  
    -   セットアップ プログラム。  
  
    -   最新バージョンの配置マニフェストを指す配置マニフェスト。  
  
     **アプリケーション ファイル**フォルダーに発行する各バージョンに対応するサブフォルダーが含まれています。 バージョン固有の各サブフォルダーには、次のファイルが含まれます。  
  
    -   アプリケーション マニフェスト。  
  
    -   配置マニフェスト。  
  
    -   カスタマイズ アセンブリ。  
  
     次の図に、Outlook VSTO アドインに対応する発行フォルダーの構造を示します。  
  
     ![発行フォルダーの構造](../vsto/media/publishfolderstructure.png "発行フォルダーの構造")  
  
    > [!NOTE]  
    >  セキュリティで保護されたで保護されたインターネット インフォメーション サービス (IIS) のインストールされているが、安全でない拡張子が原因のファイルをブロックしないように、ClickOnce はアセンブリに .deploy 拡張子を追加します。 ユーザーがソリューションをインストールする時点で、ClickOnce は .deploy 拡張子を削除します。  
  
14. この手順で既に指定したインストール場所に、ソリューション ファイルをコピーします。  
  
##  <a name="Trust"></a> ソリューションに信頼を付与する方法を決定します。  
 ユーザーのコンピューターでソリューションを実行する前に、次のいずれかの方法で信頼を付与する必要があります。そうしない場合は、ユーザーはソリューションをインストールするときに、信頼プロンプトに応答する必要が生じます。 ソリューションに信頼を付与するには、既知の信頼される発行者を特定する証明書を使用してマニフェストに署名します。 参照してください[マニフェスト署名アプリケーションおよび展開して、ソリューションを信頼する](../vsto/granting-trust-to-office-solutions.md#Signing)です。  
  
 ドキュメント レベルのカスタマイズを配置して、ユーザーのコンピューター上のフォルダーにドキュメントを配置または SharePoint サイトでドキュメントを使用できるようにするの場合は、ドキュメントの場所を Office が信頼することを確認します。 参照してください[ドキュメントへの信頼の付与](../vsto/granting-trust-to-documents.md)です。  
  
##  <a name="Helping"></a> ユーザーがソリューションをインストールできます。  
 ユーザーはソリューションをインストールするために、セットアップ プログラムを実行して配置マニフェストを開くか、またはドキュメント レベルのカスタマイズの場合はドキュメントを直接開くことができます。 ベスト プラクティスとして、ユーザーはセットアップ プログラムを使用してソリューションをインストールする必要があります。 その他の 2 つの方法は、前提条件のソフトウェアがインストールされていることを確認しません。 ユーザーがインストール場所からドキュメントを開こうとする場合は、Office アプリケーションのセキュリティ センターにある信頼できる場所の一覧に、そのインストール場所を追加する必要があります。  
  
### <a name="opening-the-document-of-a-document-level-customization"></a>ドキュメント レベルのカスタマイズに対応するドキュメントを開く  
 ドキュメント レベルのカスタマイズに対応するドキュメントの場合は、ユーザーはインストール場所からそのドキュメントを直接開くか、またはドキュメントをローカル コンピューターにコピーしてからコピー先ドキュメントを開くことができます。  
  
 ベスト プラクティスとして、ユーザーはローカル コンピューター上にあるドキュメントのコピーを開く必要があります。その結果、複数のユーザーが同じドキュメントを同時に開こうとすることはありません。 このプラクティスを強制するために、ユーザーのコンピューターにドキュメントをコピーするようにセットアップ プログラムを構成することができます。 参照してください[ソリューションのドキュメントをエンドユーザーのコンピューター (ドキュメント レベルのカスタマイズのみ) に配置](#Put)です。  
  
### <a name="installing-the-solution-by-opening-the-deployment-manifest-from-an-iis-website"></a>IIS の Web サイトから配置マニフェストを開く方法でソリューションをインストール  
 ユーザーは、Web で配置マニフェストを開くことにより、Office ソリューションをインストールできます。 ただし、セキュリティで保護されたインターネット インフォメーション サービス (IIS) がインストールされていると、.vsto 拡張子を持つファイルはブロックされます。 IIS を使用して Office ソリューションを配置する前に、IIS に MIME の種類を定義する必要があります。  
  
##### <a name="to-add-the-vsto-mime-type-to-iis-60"></a>IIS 6.0 に MIME の種類 (.vsto) を追加するには  
  
1.  IIS 6.0 を実行するサーバーで次のように選択します**開始**、**すべてのプログラム**、**管理ツール**、**インターネット インフォメーション サービス (IIS) マネージャー**。  
  
2.  コンピューター名を選択して、 **Websites**フォルダー、または web サイトを構成しています。  
  
3.  メニュー バーで、次のように選択します。**アクション**、**プロパティ**です。  
  
4.  **HTTP ヘッダー**  タブで、選択、 **MIME の種類**ボタンをクリックします。  
  
5.  **MIME の種類**ウィンドウで、選択、**新規**ボタンをクリックします。  
  
6.  **MIME の種類**ウィンドウで、入力**.vsto** 、拡張子として次のように入力します。**アプリケーション/x ms-vsto** MIME として「」と、新しい設定を適用します。  
  
    > [!NOTE]  
    >  変更を有効にするために、World Wide Web 発行サービスを再起動するか、ワーカー プロセスがリサイクルされるまで待つ必要があります。 その後、ブラウザーのディスク キャッシュをフラッシュし、.vsto ファイルを再度開く必要があります。  
  
##### <a name="to-add-the-vsto-mime-type-to-iis-70"></a>IIS 7.0 に MIME の種類 (.vsto) を追加するには  
  
1.  IIS 7.0 を実行しているサーバーで次のように選択します。**開始**、**すべてのプログラム**、**アクセサリ**です。  
  
2.  ショートカット メニューを開き、**コマンド プロンプト**を選択し**管理者として実行します。**  
  
3.  **開いている**ボックスで、次のパスを入力し、、 **OK**ボタンをクリックします。  
  
    ```  
    %windir%\system32\inetsrv   
    ```  
  
4.  次のコマンドを入力し、新しい設定を適用します。  
  
    ```  
    set config /section:staticContent /+[fileExtension='.vsto',mimeType='application/x-ms-vsto']  
    ```  
  
    > [!NOTE]  
    >  変更を有効にするために、World Wide Web Publishing Service を再起動するか、ワーカー プロセスがリサイクルされるまで待つ必要があります。 その後、ブラウザーのディスク キャッシュをフラッシュし、.vsto ファイルを再度開く必要があります。  
  
##  <a name="Put"></a> ソリューションのドキュメントをエンドユーザーのコンピューター (ドキュメント レベルのカスタマイズのみ) に配置します。  
 それらのエンドユーザーのコンピューター上に、ソリューションのドキュメントをコピーするには、配置後アクションを作成します。 このように、ソリューションのインストール後に自分のコンピューターにインストール場所からドキュメントを手動でコピーする、ユーザーが持っていません。 配置後アクションを定義するクラスを作成、ビルド、ソリューションを発行し、アプリケーション マニフェストを変更、および、アプリケーション マニフェストと配置マニフェストに再署名する必要があります。  
  
 次の手順があると、プロジェクト名**ExcelWorkbook**ソリューションを発行して、 **C:\publish**ディレクトリお使いのコンピューターにします。  
  
### <a name="create-a-class-that-defines-the-post-deployment-action"></a>配置後アクションを定義するクラスを作成します。  
  
1.  メニュー バーで **[ファイル]**をクリックし、 **[追加]**を選択し、 **[新しいプロジェクト]**をクリックします。  
  
2.  **新しいプロジェクトの追加** ダイアログ ボックスで、**インストールされたテンプレート** ウィンドウで、選択、 **Windows**フォルダーです。  
  
3.  **テンプレート** ウィンドウで、選択、**クラス ライブラリ**テンプレート。  
  
4.  **名前**フィールドに、入力**FileCopyPDA**を選択し、 **OK**ボタンをクリックします。  
  
5.  **ソリューション エクスプ ローラー**、選択、 **FileCopyPDA**プロジェクト。  
  
6.  メニュー バーで、**[プロジェクト]**、**[参照の追加]** の順に選択します。  
  
7.  **.NET**  タブで、Microsoft.VisualStudio.Tools.Applications.Runtime および Microsoft.VisualStudio.Tools.Applications.ServerDocument への参照を追加します。  
  
8.  クラスの名前を `FileCopyPDA` に変更してから、ファイルの内容を次のコードに置き換えます。 このコードは次のタスクを実行します。  
  
    -   ドキュメントをユーザーのデスクトップにコピーします。  
  
    -   配置マニフェストの完全修飾パスに相対パスから _AssemblyLocation プロパティを変更します。  
  
    -   ユーザーがソリューションをアンインストールする場合は、ファイルを削除します。  
  
     [!code-vb[Trin_ExcelWorkbookPDA#7](../vsto/codesnippet/VisualBasic/trin_excelworkbookpda/filecopypda/class1.vb#7)]
     [!code-csharp[Trin_ExcelWorkbookPDA#7](../vsto/codesnippet/CSharp/trin_excelworkbookpda/filecopypda/class1.cs#7)]  
  
### <a name="build-and-publish-the-solution"></a>ソリューションをビルドし、発行します。  
  
1.  **ソリューション エクスプ ローラー**、ショートカット メニューを開き、 **FileCopyPDA**プロジェクトをクリックして**ビルド**です。  
  
2.  ショートカット メニューを開き、 **ExcelWorkbook**プロジェクトをクリックして**ビルド**です。  
  
3.  ショートカット メニューを開き、 **ExcelWorkbook**プロジェクトをクリックして**参照の追加**です。  
  
4.  **参照の追加** ダイアログ ボックスで、選択、**プロジェクト** タブで、選択**FileCopyPDA**を選択し、 **OK**ボタンをクリックします。  
  
5.  **ソリューション エクスプ ローラー**、選択、 **ExcelWorkbook**プロジェクト。  
  
6.  メニュー バーで、次のように選択します。**プロジェクト**、**新しいフォルダー**です。  
  
7.  Enter**データ**、し、Enter キーを押します。  
  
8.  **ソリューション エクスプ ローラー**、選択、**データ**フォルダーです。  
  
9. メニュー バーで、次のように選択します。**プロジェクト**、**既存項目の追加**です。  
  
10. **既存項目の追加** ダイアログ ボックスでの出力ディレクトリを参照、 **ExcelWorkbook**プロジェクトを選択して、 **ExcelWorkbook.xlsx**ファイル、および、を選択**追加**ボタンをクリックします。  
  
11. **ソリューション エクスプ ローラー**を選択して、 **ExcelWorkbook.xlsx**ファイル。  
  
12. **プロパティ**ウィンドウで、変更、**ビルド アクション**プロパティを**コンテンツ**と**出力ディレクトリにコピー** プロパティ**新しい場合はコピー**です。  
  
     次の手順が完了したら、プロジェクトが次の図のようになります。  
  
     ![配置後アクションのプロジェクト構造。](../vsto/media/vsto-postdeployment.png "配置後アクションのプロジェクト構造。")  
  
13. 発行、 **ExcelWorkbook**プロジェクト。  
  
### <a name="modify-the-application-manifest"></a>アプリケーション マニフェストの変更  
  
1.  開く、 **c:\publish**を使用してディレクトリ**ファイル エクスプ ローラー**です。  
  
2.  開く、**アプリケーション ファイル**発行済みソリューションのバージョンのフォルダーをクリックし、一番最近に対応するフォルダーを開きます。  
  
3.  開く、 **ExcelWorkbook.dll.manifest**メモ帳などのテキスト エディターでファイル。  
  
4.  `</vstav3:update>` 要素の後に、次のコードを追加します。 クラス属性、`<vstav3:entryPoint>`要素を次の構文を使用して: *NamespaceName.ClassName*です。 次の例では、名前空間名とクラス名は同じであるため、最終的にエントリ ポイント名は `FileCopyPDA.FileCopyPDA` になります。  
  
    ```  
    <vstav3:postActions>  
      <vstav3:postAction>  
        <vstav3:entryPoint  
          class="FileCopyPDA.FileCopyPDA">  
          <assemblyIdentity  
            name="FileCopyPDA"  
            version="1.0.0.0"  
            language="neutral"  
            processorArchitecture="msil" />  
        </vstav3:entryPoint>  
        <vstav3:postActionData>  
        </vstav3:postActionData>  
      </vstav3:postAction>  
    </vstav3:postActions>  
    ```  
  
### <a name="re-sign-the-application-and-deployment-manifests"></a>アプリケーション マニフェストと配置マニフェストへの再署名  
  
1.  **%USERPROFILE%\Documents\Visual Studio 2013\Projects\ExcelWorkbook\ExcelWorkbook**フォルダー、コピー、 **ExcelWorkbook_TemporaryKey.pfx**証明書のファイル、および、に貼り付けます*PublishFolder* **\Application Files\ExcelWorkbook**\__MostRecentPublishedVersion_フォルダーです。
  
2.  Visual Studio コマンド プロンプトを開き、ディレクトリを変更、 **c:\publish\Application \excelworkbook**\__MostRecentPublishedVersion_フォルダー (たとえば、 **c:\publish\Application \excelworkbook_1_0_0_4**)。  
  
3.  次のコマンドを実行し、変更したアプリケーション マニフェストに署名します。  
  
    ```  
    mage -sign ExcelWorkbook.dll.manifest -certfile ExcelWorkbook_TemporaryKey.pfx  
    ```  
  
     "ExcelWorkbook.dll.manifest が正常に署名されました" というメッセージが表示されます。  
  
4.  変更、 **c:\publish**次のコマンドを実行して、フォルダー、し、更新プログラムおよび記号の配置マニフェストします。  
  
    ```  
    mage -update ExcelWorkbook.vsto -appmanifest "Application Files\Ex  
    celWorkbookMostRecentVersionNumber>\ExcelWorkbook.dll.manifest" -certfile "Application Files\ExcelWorkbookMostRecentVersionNumber>\ExcelWorkbook_TemporaryKey.pfx"  
    ```  
  
    > [!NOTE]  
    >  前の例では、mostrecentversionnumber に、ソリューションの最新発行バージョンのバージョン番号 (たとえば、 **1_0_0_4**)。  
  
     "ExcelWorkbook.vsto 正常に署名されました" というメッセージが表示されます。  
  
5.  ExcelWorkbook.vsto ファイルをコピー、 **c:\publish\Application \excelworkbook**\__MostRecentVersionNumber_ディレクトリ。  
  
##  <a name="SharePoint"></a> ソリューションのドキュメント (ドキュメント レベルのカスタマイズのみ) SharePoint を実行しているサーバーに配置します。  
 SharePoint を使用して、エンド ユーザーに対してドキュメント レベルのカスタマイズを発行できます。 ユーザーが SharePoint サイトにアクセスし、ドキュメントを開くと、ランタイムが自動的に共有ネットワーク フォルダーからユーザーのローカル コンピューターにソリューションをインストールします。 ソリューションをローカル インストールした後、ドキュメントをデスクトップなど別の場所にコピーした場合でも、カスタマイズは引き続き機能します。  
  
#### <a name="to-put-the-document-on-a-server-thats-running-sharepoint"></a>SharePoint を実行しているサーバーにドキュメントを配置するには  
  
1.  SharePoint サイト上のドキュメント ライブラリにソリューション ドキュメントを追加します。  
  
2.  次の方法のいずれかに対応する手順を実行します。  
  
    -   Office 構成ツールを使用し、すべてのユーザーのコンピューターで Word または Excel のセキュリティ センターに、SharePoint を実行しているサーバーを追加します。  
  
         参照してください[Office 2010 でセキュリティ ポリシーと設定](http://go.microsoft.com/fwlink/?LinkId=99227)です。  
  
    -   各ユーザーが確実に次の手順を実行するようにします。  
  
        1.  開いている Word または Excel では、ローカル コンピューターの選択、**ファイル** タブをクリックして、**オプション**ボタンをクリックします。  
  
        2.  **トラスト センター**  ダイアログ ボックスで、選択、**信頼できる場所**ボタンをクリックします。  
  
        3.  選択、 **(推奨しません) ネットワークで信頼されている場所を許可する**チェック ボックスをオンにして、**新しい場所の追加**ボタンをクリックします。  
  
        4.  **パス**ボックスで、アップロードしたドキュメントを含む SharePoint ドキュメント ライブラリの URL を入力してください (たとえば、 *http://SharePointServerName/TeamName/ProjectName/DocumentLibraryName*)。  
  
             既定の Web ページで、default.aspx や AllItems.aspx などの名前を追加しないでください。  
  
        5.  選択、**この場所のサブフォルダも併せて信頼**チェック ボックスをオンにして、 **OK**ボタンをクリックします。  
  
             ユーザーが SharePoint サイトからドキュメントを開いた時点で、そのドキュメントが開かれ、カスタマイズがインストールされます。 ユーザーは、ドキュメントを自分のデスクトップにコピーすることができます。 ドキュメント内のプロパティは、ドキュメントが存在しているネットワークの場所を指しているので、カスタマイズは引き続き実行されます。  
  
##  <a name="Custom"></a> カスタム インストーラーを作成します。  
 ソリューションを発行するときに作成するセットアップ プログラムを使用する代わりに、Office ソリューションのカスタム インストーラーを作成することができます。 たとえば、ログイン スクリプトを使用してインストールを開始したり、バッチ ファイルを使用して、ユーザーの操作なしにソリューションをインストールすることもできます。 このようなシナリオは、エンド ユーザーのコンピューターに必須コンポーネントがインストール済みの場合に最適です。  
  
 カスタム インストール プロセスの一環として、Office ソリューション用のインストーラー ツール (VSTOInstaller.exe) を呼び出します。既定では、このツールは次の場所にインストールされます。  
  
 %commonprogramfiles%\microsoft shared\VSTO\10.0\VSTOInstaller.exe  
  
 ツールがこの場所にない場合は、HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\VSTO Runtime Setup\v4\InstallerPath レジストリ キーまたは HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\VSTO Runtime Setup\v4\InstallerPath レジストリ キーを使用して、このツールのパスを見つけることができます。  
  
 VSTOinstaller.exe で次のパラメーターを使用できます。  
  
|パラメーター|定義|  
|---------------|----------------|  
|/Install または /I|ソリューションをインストールします。 このオプションの後に配置マニフェストのパスを指定する必要があります。 ローカル コンピューター上のパス、汎用名前付けの規則 (UNC) のファイル共有を指定できます。 ローカル パスを指定することができます (*C:\FolderName\PublishFolder*)、相対パス (*発行\\*)、または完全修飾の場所 (*\\\ServerName\FolderName*または http://*Servername/foldername*)。|  
|/Uninstall または /U|ソリューションをアンインストールします。 このオプションの後に配置マニフェストのパスを指定する必要があります。 ローカル コンピューター上のパス、UNC ファイル共有を指定できます。 ローカル パスを指定することができます (*c:\FolderName\PublishFolder*)、相対パス (*発行\\*)、または完全修飾の場所 (*\\\ServerName\FolderName*または http://*Servername/foldername*)。|  
|/Silent または /S|ユーザーに入力を要求したりメッセージを表示したりすることなくソリューションをインストールまたはアンインストールします。 信頼プロンプトが必要な場合、カスタマイズされていないインストールまたは更新します。|  
|/Help または /?|ヘルプ情報を表示します。|  
  
 VSTOinstaller.exe を実行すると、次のエラー コードが表示されることがあります。  
  
|エラー コード|定義|  
|----------------|----------------|  
|0|ソリューションが正常にインストールまたはアンインストールされたか、VSTOInstaller ヘルプが表示されました。|  
|-100|1 つ以上のコマンド ライン オプションが有効でないか、複数回設定されました。 詳細については、次を入力してください"vstoinstaller/?"。 参照してくださいまたは[ClickOnce Office ソリューションのカスタム インストーラーを作成する](http://msdn.microsoft.com/en-us/3e5887ed-155f-485d-b8f6-3c02c074085e)です。|  
|-101|1 つまたは複数のコマンド ライン オプションが無効です。 詳細については、"vstoinstaller /?" と入力してください。|  
|-200|配置マニフェストの URI が無効です。 詳細については、"vstoinstaller /?" と入力してください。|  
|-201|配置マニフェストが有効でないために、ソリューションをインストールできませんでした。 参照してください[Office ソリューション用配置マニフェスト](../vsto/deployment-manifests-for-office-solutions.md)です。|  
|-202|Visual Studio Tools for Office セクションのアプリケーション マニフェストが有効でないために、ソリューションをインストールできませんでした。 参照してください[Office ソリューション用アプリケーション マニフェスト](../vsto/application-manifests-for-office-solutions.md)です。|  
|-203|ダウンロード エラーが発生したため、ソリューションをインストールできませんでした。 配置マニフェストの URI またはネットワーク ファイルの位置を確認し、もう一度、実行してみてください。|  
|-300|セキュリティ例外が発生したため、ソリューションをインストールできませんでした。 参照してください[Office ソリューションのセキュリティ保護](../vsto/securing-office-solutions.md)です。|  
|-400|ソリューションをインストールできませんでした。|  
|-401|ソリューションをアンインストールできませんでした。|  
|-500|ソリューションをインストールまたはアンインストールできなかったこと、または配置マニフェストをダウンロードできなかったことが原因で、操作は取り消されました。|  
  
##  <a name="Update"></a> 更新プログラムを発行します。  
 更新するには、ソリューションを再度発行し、使用して、**プロジェクト デザイナー**または**発行ウィザード**、し、インストール場所に更新されたソリューションをコピーします。 インストール場所にファイルをコピーするときに、前のファイルを確実に上書きしてください。  
  
 次回ソリューションをチェックする、更新プログラムのおよび記されて、新しいバージョンを自動的に読み込みます。  
  
##  <a name="Location"></a> ソリューションのインストール場所を変更します。  
 ソリューションを発行した後、インストール パスの追加または変更を行うことができます。 次の理由の 1 つ以上により、インストール パスを変更する可能性があります:  
  
-   インストール パスが既知になる前に、セットアップ プログラムをコンパイルした。  
  
-   ソリューション ファイルは、別の場所からコピーされたものである。  
  
-   インストール ファイルをホストするサーバーの名前または場所が変更された。  
  
 ソリューションのインストール パスを変更するには、開発者がセットアップ プログラムを更新し、その後、ユーザーがそのプログラムを実行する必要があります。 ドキュメント レベルのカスタマイズの場合、新しい場所を指すように、ユーザーがドキュメントのプロパティを更新する必要もあります。  
  
> [!NOTE]  
>  ドキュメント プロパティを更新するよう求めるしない場合は、ユーザーは、インストール場所から更新されたドキュメントを取得するを依頼することができます。  
  
#### <a name="to-change-the-installation-path-in-the-setup-program"></a>セットアップ プログラムのインストール パスを変更するには  
  
1.  開く、**コマンド プロンプト**ウィンドウ、し、インストール フォルダーにディレクトリを変更します。  
  
2.  セットアップ プログラムを実行します。このとき、文字列として新しいインストール パスを表す `/url` パラメーターを指定します。  
  
     次の例で、インストール パスを、Fabrikam の Web サイト上にある場所に変更する方法を示しますが、この URL は必要なパスに置き換えることができます。  
  
    ```  
    setup.exe /url="http://www.fabrikam.com/newlocation"  
    ```  
  
    > [!NOTE]  
    >  実行可能ファイルのシグネチャが無効化されることを示すメッセージが表示された場合は、ソリューションの署名に使用された証明書がもう有効ではなく、発行者が不明です。 その結果、ユーザーはソリューションをインストールする前に、ソリューションのソースを信頼することを示すために、メッセージを確認する必要があります。  
  
    > [!NOTE]  
    >  URL の現在の値を表示するには、`setup.exe /url` を実行します。  
  
 ドキュメント レベルのカスタマイズは、ユーザーは、ドキュメントを開くし、その _AssemblyLocation プロパティを更新する必要があります。 次の手順では、ユーザーがこのタスクを実行する方法について説明します。  
  
#### <a name="to-update-the-assemblylocation-property-in-a-document"></a>ドキュメントの_AssemblyLocation プロパティを更新するには  
  
1.  **ファイル** タブで、選択**情報**、次の図に示すです。  
  
     ![Excel では、[情報] タブ](../vsto/media/vsto-infotab.png "Excel では、[情報] タブ")  
  
2.  **プロパティ**一覧で、選択**プロパティの詳細**、次の図に示すです。  
  
     ![Excel の高度なプロパティです。] (../vsto/media/vsto-advanceddocumentproperties.png "Excel のプロパティの詳細。")  
  
3.  **カスタム** タブで、**プロパティ**一覧で、次の図に示すよう _AssemblyLocation を選択します。  
  
     ![[Assemblylocation] プロパティ。] (../vsto/media/vsto-assemblylocationproperty.png "[Assemblylocation] プロパティ。")  
  
     **値** ボックスには、配置マニフェストの識別子が含まれています。  
  
4.  前に、その識別子を入力と形式で、縦棒、ドキュメントの完全修飾パス*パス*|*識別子*(たとえば、 *File://ServerName/フォルダー名とファイル名 | 74744e4b-e4d6-41eb-84f7-ad20346fe2d9*です。  
  
     この識別子の書式を設定する方法の詳細については、次を参照してください。[カスタム ドキュメント プロパティの概要](../vsto/custom-document-properties-overview.md)です。  
  
5.  選択、 **OK**ボタンをクリックしを保存してドキュメントを閉じます。  
  
6.  セットアップ プログラムを実行します。このとき、指定の場所にあるソリューションをインストールするための /url パラメーターは指定しません。  
  
##  <a name="Roll"></a> ソリューションを以前のバージョンにロールバックします。  
 開発者がソリューションをロールバックすると、ユーザーはそのソリューションの以前のバージョンに戻されることになります。  
  
#### <a name="to-roll-back-a-solution"></a>ソリューションをロールバックするには  
  
1.  ソリューションのインストール場所を開きます。  
  
2.  トップレベルの発行フォルダーで、配置マニフェスト (.vsto ファイル) を削除します。  
  
3.  ロールバック先のバージョンに対応するサブフォルダーを見つけます。  
  
4.  このサブフォルダー内の配置マニフェストをトップレベルの発行フォルダーにコピーします。  
  
     例については、呼び出される、ソリューションをロールバックする**OutlookAddIn1**バージョン 1.0.0.0 をバージョン 1.0.0.1 からファイルをコピー **OutlookAddIn1.vsto**から、 **OutlookAddIn1_1_0_0_0**フォルダーです。 ファイルを貼り付け、最上位レベルに発行するバージョン固有の配置マニフェストを上書きフォルダー **OutlookAddIn1_1_0_0_1**を既に存在していた。  
  
     次の図に、この例に対応する発行フォルダーの構造を示します。  
  
     ![発行フォルダーの構造](../vsto/media/publishfolderstructure.png "発行フォルダーの構造")  
  
     アプリケーションまたはカスタマイズされたドキュメントをユーザーが次回開くときに、配置マニフェストの変更が検出されます。 Office ソリューションの以前のバージョンは、ClickOnce キャッシュから実行されます。  
  
> [!NOTE]  
>  ローカル データは、ソリューションの 1 つ前のバージョンについてのみ保存されます。 2 つのバージョンをロールバックする場合は、ローカル データは保持されません。 ローカル データの詳細については、次を参照してください。[ローカルへのアクセスと ClickOnce アプリケーションでのリモート データ](/visualstudio/deployment/accessing-local-and-remote-data-in-clickonce-applications)です。  
  
## <a name="see-also"></a>関連項目  
 [Office ソリューションの配置](../vsto/deploying-an-office-solution.md)   
 [Office ソリューションの発行](../vsto/deploying-an-office-solution-by-using-clickonce.md)   
 [方法: ClickOnce を使用して Office ソリューションの発行](http://msdn.microsoft.com/en-us/2b6c247e-bc04-4ce4-bb64-c4e79bb3d5b8)   
 [方法: ClickOnce Office ソリューションのインストール](http://msdn.microsoft.com/en-us/14702f48-9161-4190-994c-78211fe18065)   
 [方法: ClickOnce を使用して、SharePoint サーバーにドキュメント レベルの Office ソリューションの発行](http://msdn.microsoft.com/en-us/2408e809-fb78-42a1-9152-00afa1522e58)   
 [ClickOnce Office ソリューション用のカスタム インストーラーを作成します。](http://msdn.microsoft.com/en-us/3e5887ed-155f-485d-b8f6-3c02c074085e)  
  
  
