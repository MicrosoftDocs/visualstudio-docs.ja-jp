---
title: .NET オブジェクトのメモリ使用量の分析 | Microsoft Docs
ms.date: 12/9/2019
ms.topic: conceptual
helpviewer_keywords:
- memory allocation, memory usage
author: Sagar-S-S
ms.author: sashe
manager: AndSter
ms.workload:
- multiple
ms.openlocfilehash: 9518ffd618a6d82505feca33b37b5151a3a9f961
ms.sourcegitcommit: aa302af53de342e75793bd05b10325939dc69b53
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/11/2020
ms.locfileid: "75886762"
---
# <a name="analyze-memory-usage-using-the-net-object-allocation-tool"></a>.NET オブジェクト割り当てツールを使用してメモリ使用量を分析する

.NET オブジェクト割り当てツールを使用して、アプリが使用しているメモリの量と、最も多くのメモリを割り当てるコード パスを確認できます。

このツールを実行すると、オブジェクトが割り当てられている関数の実行パスを確認できます。これにより、最も多くのメモリを占有している呼び出しツリーのルートを辿ることができます。

## <a name="setup"></a>セットアップ

1. Visual Studio でパフォーマンス プロファイラー (**Alt + F2)** を開きます。
2.  **[.NET オブジェクト割り当て追跡]** チェックボックスをオンにします。

![Diag ハブ](../profiling/media/diaghub.png "Diag ハブ")

> [!NOTE]
> 既定ではスタートアップ プロジェクトが **[分析ターゲット]** として選択されていますが、 **[ターゲットの変更]** ドロップダウン メニューを開いて使用可能なオプションから選択することで、実行中のプロセス、実行可能ファイル、実行中のアプリ、およびインストールされているアプリに変更できます。

   .NET オブジェクト割り当てツールでは現在、ドロップダウン メニューを使用した実行可能ファイルの選択はサポートされていません。 このツールを使用するには、exe プロジェクト システムを実行する必要があります。 これを行うには、現在のソリューションを閉じます ( **[ファイル]**  ->  **[ソリューションを閉じる]** )。その後、 **[ファイル]**  ->  **[プロジェクトやソリューションを開く]** の順に選択し、.exe ファイルを選択します。

![分析ターゲット](../profiling/media/analysistarget.png "分析ターゲット")

3. **[開始]** ボタンをクリックしてツールを実行します。

![コレクションの停止](../profiling/media/stopcollection.png "コレクションの停止")

4. ツールの実行が開始されたら、アプリで目的のシナリオを実行し、その後 **[コレクションを停止]** を押すかアプリを閉じてデータを表示します。
5. **[割り当て]** タブをクリックすると、次のような画像が表示されます。

![Allocation](../profiling/media/allocation.png "割り当て")

おめでとうございます! これで、オブジェクトのメモリ割り当てを分析できるようになりました。

## <a name="understand-your-data"></a>データを理解する

### <a name="collection"></a>Collection

![コレクション](../profiling/media/collection.png "Collection")

コレクション ビューでは、ガベージ コレクション中に収集されたオブジェクトの数と保持された数を確認できます。 また、このビューには、収集されたオブジェクトと残ったオブジェクトを種類別に視覚化するためのいくつかの円グラフもあります。

- **[収集済み]** 列には、ガベージ コレクターによって収集されたオブジェクトの数が表示されます。
- **[残り]** 列には、ガベージ コレクターの実行後に残ったオブジェクトの数が表示されます。

### <a name="allocation"></a>割り当て

![展開された割り当て](../profiling/media/allocationexpanded.png "展開された割り当て")

割り当てビューでは、メモリを割り当てているオブジェクトの場所と、オブジェクトが割り当てているメモリの量を確認できます。

- **[名前]** 列は、メモリを占有しているさまざまなクラスと構造体の一覧です。 列内の各項目はノードとなっています。そのカテゴリ内の項目がメモリを占有している場合、展開できます。 ( **[割り当て]** ビューのみ)
- **[合計 (割り当て)]** 列には、メモリを占有している特定の割り当ての種類に含まれるオブジェクトの数が表示されます。 ( **[割り当て]** 、 **[呼び出しツリー]** 、および **[関数]** ビュー)
- **[自己 (割り当て)]** 列には、メモリを占有している個々の項目内のオブジェクトの数が表示されます。 ( **[割り当て]** 、 **[呼び出しツリー]** 、および **[関数]** ビュー)
- これら 3 つの列はすべて並べ替え可能です。 **[名前]** 列の場合、項目はアルファベット順 (順方向または逆方向) に並べ替えられます。 **[合計]** と **[自己 (割り当て)]** の場合、数値で並べ替えることができます (昇順または降順)。
- **[合計サイズ (バイト)]** と **[自己サイズ (バイト)]** 列は、既定ではオンになっていません。 有効にするには、 **[名前]** を右クリックして **[合計]** または **[自己 (割り当て)]** 列を選択し、 **[合計サイズ]** と **[自己サイズ]** オプションをクリックしてグラフに追加します。 この 2 つの列は **[合計 (割り当て)]** と **[自己 (割り当て)]** に似ています。ただし、メモリを占有するオブジェクトの数を表示するのではなく、それらのオブジェクトが占有しているメモリの合計量をバイト単位で示すものです。 [割り当てビューのみ]

### <a name="call-tree"></a>呼び出しツリー

![呼び出しツリー](../profiling/media/calltree.png "呼び出しツリー")

**[呼び出しツリー]** ビューでは、大量のメモリを割り当てているオブジェクトを含む関数の実行パスを表示できます。

- **[関数名]** 列には、検査するノードのレベルに基づいてメモリを割り当てているオブジェクトを含む関数のプロセスまたは名前が表示されます。
- **[合計]** と **[自己 (割り当て)]** 列には、 **[割り当て]** ビューと同じ情報が表示されます。
- **[モジュール名]** 列には、呼び出している関数またはプロセスを含むモジュールが表示されます。

![ホット パス](../profiling/media/hotpath.png "ホット パス")

- **[ホット パスの展開]** ボタンをクリックすると、メモリを割り当てているオブジェクトを数多く含む関数の実行パスが強調表示されます。 このアルゴリズムは、ユーザーが選択した対象ノードで開始され、ほとんどの割り当てのパスを強調表示して、ユーザーの調査をガイドします。
- **[ホット パスの表示]** ボタンをクリックすると、**ホット パス**の一部であるノードを示す炎アイコンのオンとオフが切り替わります。

### <a name="functions"></a>関数

![関数](../profiling/media/functions.png "関数")

**[関数]** ビューには、メモリを割り当てているプロセス、モジュール、および関数が表示されます。

- **[名前]** 列には、最上位レベルのノードとしてプロセスが表示されます。 プロセスの下にモジュールがあり、モジュールの下に関数があります。
- **[合計]** と **[自己 (割り当て)]** 列には、 **[割り当て]** ビューと同じ情報が表示されます。

**[割り当て]** 、 **[呼び出しツリー]** 、 **[関数]** ビューのすべてに、 **[マイ コードのみ表示]** 、 **[Show Native Code]\(ネイティブ コードを表示\)** 、および **[検索]** オプションが含まれています。

![フィルター バー](../profiling/media/filterbar.png "フィルター バー")

- **[マイコードのみ表示]** を選択すると、システム、フレームワーク、およびその他の非ユーザーコードが **[外部コード]** フレームに折りたたまれ、ユーザーコードに焦点を当てることができます。 詳細については、[マイ コードのみを使用したユーザー コードのデバッグ](../debugger/just-my-code.md)に関する記事を参照してください。
- **[Show Native Code]\(ネイティブ コードを表示\)** を選択すると、非ユーザー コードを含む分析ターゲット内のネイティブ コードが表示されます。
- **フィルター ボックス**を使用すると、指定したパラメーターに基づいて **[名前]** または **[関数名]** 列をフィルター処理できます。 フィールドに入力するだけでテーブルがフィルター処理され、指定した文字列を含む種類のみが表示されます。
