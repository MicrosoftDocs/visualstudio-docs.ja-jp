---
title: DA0022:ジェネレーション 2 のガベージ コレクションが高率です | Microsoft Docs
ms.date: 11/04/2016
ms.topic: conceptual
f1_keywords:
- vs.performance.DA0022
- vs.performance.rules.DA0022
- vs.performance.22
ms.assetid: f871a547-0e6f-4b11-b2d7-174d30fc2ed8
author: mikejo5000
ms.author: mikejo
manager: jillfra
ms.workload:
- multiple
ms.openlocfilehash: ba70e303c3164417890be51e834d86d8983526cf
ms.sourcegitcommit: 257fc60eb01fefafa9185fca28727ded81b8bca9
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/25/2019
ms.locfileid: "72910537"
---
# <a name="da0022-high-rate-of-gen-2-garbage-collections"></a>DA0022:ジェネレーション 2 のガベージ コレクションが高率です

|||
|-|-|
|規則 ID|DA0022|
|カテゴリ|.NET Framework の使用|
|プロファイル方法|すべて|
|メッセージ|比較的高い率のジェネレーション 2 ガベージ コレクションが発生しています。 設計によりプログラムのほとんどのデータ構造が長時間割り当てられて保持される場合は、通常これは問題ではありません。 一方、意図した動作でない場合は、アプリケーションがオブジェクトを固定している可能性があります。 不明な場合は、.NET のメモリ割り当てデータとオブジェクト ライフタイム情報を収集することで、アプリケーションが使用しているメモリ割り当てのパターンを知ることができます。|
|規則の種類|警告|

 サンプリング、.NET メモリ、またはリソース競合メソッドを使用してプロファイリングを行うときは、この規則を呼び出すためのサンプルを少なくとも 10 個収集する必要があります。

## <a name="cause"></a>原因
 プロファイリングの実行中に収集されたシステム パフォーマンス データが、ジェネレーション 2 のガベージ コレクションで解放された .NET Framework オブジェクト用のメモリが、ジェネレーション 0 およびジェネレーション 1 のガベージ コレクションと比較して高率であることを示しています。

## <a name="rule-description"></a>規則の説明
 Microsoft .NET 共通言語ランタイム (CLR: Common Language Runtime) は、自動メモリ管理メカニズムを備えています。このメカニズムでは、ガベージ コレクターを使用して、アプリケーションが使用しなくなったオブジェクトのメモリを解放します。 ガベージ コレクターはジェネレーション指向です。これは、多くの割り当てが短時間で終了することを前提としています。 たとえば、ローカル変数の有効期間は短時間です。 新しく作成されたオブジェクトはジェネレーション 0 (gen 0) から始まり、ガベージ コレクションの実行中に破棄されなければジェネレーション 1 に昇格します。その後もアプリケーションによって引き続き使用されていれば、最後はジェネレーション 2 に昇格します。

 ジェネレーション 0 のオブジェクトの収集頻度は高く、通常は非常に効率的に収集されます。 ジェネレーション 1 のオブジェクトの収集頻度はそれよりも低くなり、収集効率も下がります。 有効期間の長いジェネレーション 2 のオブジェクトの場合、収集頻度はさらに低くなります。 また、ジェネレーション 2 のコレクション (フル ガベージ コレクションの実行) は、最も負荷のかかる操作になります。

 この規則は、ジェネレーション 2 のガベージ コレクションの発生率が高くなりすぎた場合に適用されます。 適切に動作する .NET Framework アプリケーションでは、ジェネレーション 1 のガベージ コレクションはジェネレーション 2 のコレクションの 5 倍を超える頻度で発生します。 (最適な頻度は 10 倍です。)

## <a name="how-to-investigate-a-warning"></a>警告の調査方法
 [エラー一覧] ウィンドウに表示されたメッセージをダブルクリックして、プロファイル データの [[マーク] ビュー](../profiling/marks-view.md)に移動します。 **.NET CLR Memory\\# of Gen 0 Collections** 列と **.NET CLR Memory\\# of Gen 1 Collections** 列を探します。 ガベージ コレクションがより高い頻度で発生している特定のプログラム実行フェーズがあるかどうかを確認します。 これらの値を **% Time in GC** 列と比較して、マネージド メモリの割り当てパターンによって過剰なメモリ管理オーバーヘッドが発生しているかどうかを調べます。

 Gen 2 のガベージ コレクションの発生率が高いことは、常に問題になるわけではありません。 設計上そのようになっている場合もあります。 大きなデータ構造が割り当てられ、それが実行中に長期間アクティブになっている必要があるアプリケーションでは、この規則が適用される場合があります。 そのようなアプリケーションでメモリが不足する場合は、頻繁にガベージ コレクションを実行する必要があります。 より負荷の小さいジェネレーション 0 およびジェネレーション 1 のガベージ コレクションで少量のマネージド メモリしか解放できない場合、ジェネレーション 2 のガベージ コレクションのスケジュール頻度が高くなります。

 [マーク] ビューには、ガベージ コレクションの問題の特定に役立つ .NET CLR Memory の列が他にもあります。 **% Time in GC** 列は、どれだけのメモリ管理オーバーヘッドが発生しているかを調べるのに役立ちます。 アプリケーションで通常使用するオブジェクトが、かなり少数の大きい永続オブジェクトである場合、ジェネレーション 2 のコレクションの頻繁な実行によって大量の CPU 時間が消費されないようにする必要があります。 アプリケーションが物理メモリ (RAM) 不足のためにメモリ不足になる場合、**Memory\Pages/sec** 列の値を評価する関連規則も呼び出される可能性があります。

 アプリケーションのマネージド メモリの使用パターンを調べるには、.NET メモリの割り当てのプロファイルを使用して再度アプリケーションのプロファイリングを行い、オブジェクトの有効期間プロファイリング オプションを選択します。

 ガベージ コレクションのパフォーマンスの向上の方法の詳細については、Microsoft Web サイトの「[ガベージ コレクターの基本とパフォーマンスのヒント](/previous-versions/dotnet/articles/ms973837(v=msdn.10))」を参照してください。 自動ガベージ コレクションのオーバーヘッドについては、「[Large Object Heap Uncovered](https://msdn.microsoft.com/magazine/cc534993.aspx)」 (大きなオブジェクト ヒープの秘密) を参照してください。