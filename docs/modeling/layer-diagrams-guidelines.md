---
title: '依存関係図: ガイドライン'
description: Visual Studio で依存関係図を作成して、アプリのアーキテクチャを大まかに記述する方法について説明します。
ms.custom: SEO-VS-2020
ms.date: 09/28/2018
ms.topic: conceptual
helpviewer_keywords:
- architecture, dependency diagrams
- dependency diagrams
- diagrams - modeling, layer
- constraints, architectural
author: JoshuaPartlow
ms.author: joshuapa
manager: jmartens
ms.workload:
- multiple
ms.openlocfilehash: 06f4baed4851681065f3f7ccafecd3af339398f9
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/08/2021
ms.locfileid: "99957375"
---
# <a name="dependency-diagrams-guidelines"></a>依存関係図: ガイドライン

Visual Studio で *依存関係図* を作成して、アプリのアーキテクチャを大まかに記述します。 依存関係図でコードを検証することにより、コードがこの設計と一貫していることを確認します。 レイヤーの検証をビルド プロセスに含めることもできます。 「 [Channel 9 ビデオ: 依存関係図を使用したアーキテクチャの設計と検証」を](https://channel9.msdn.com/Series/Visual-Studio-2012-Premium-and-Ultimate-Overview/Visual-Studio-Ultimate-2012-Using-layer-diagrams-to-design-and-validate-your-architecture)参照してください。

この機能をサポートする Visual Studio のバージョンを確認するには、「[アーキテクチャとモデリング ツールのエディション サポート](../modeling/what-s-new-for-design-in-visual-studio.md#VersionSupport)」を参照してください。

> [!NOTE]
> .NET Core プロジェクトの依存関係図は、Visual Studio 2019 バージョン16.2 以降でサポートされています。

## <a name="what-is-a-dependency-diagram"></a>依存関係図とは何ですか。

従来のアーキテクチャ図と同様に、依存関係図は、設計の主要なコンポーネントまたは機能単位とその依存関係を識別します。 " *レイヤー*" と呼ばれる図の各ノードは、名前空間、プロジェクト、またはその他の成果物の論理グループを表します。 設計に必要な依存関係を描画できます。 従来のアーキテクチャ図とは異なり、ソース コード内の実際の依存関係が意図したとおりのものであることを検証できます。 [!INCLUDE[esprtfs](../code-quality/includes/esprtfs_md.md)] で定期的なビルドの検証パーツを作成すると、今後変更が繰り返されても、プログラム コードがシステムのアーキテクチャに準拠している状態を維持できます。 「 [依存関係図: リファレンス](../modeling/layer-diagrams-reference.md)」を参照してください。

## <a name="how-to-design-or-update-your-app-with-dependency-diagrams"></a>依存関係図を使用してアプリをデザインまたは更新する方法

次の手順では、開発プロセス内で依存関係図を使用する方法の概要について説明します。 このトピックの後半のセクションでは、各手順について詳細に説明します。 新しく設計を行う場合は、既存のコードを扱う手順は省略してください。

> [!NOTE]
> これらの手順は順序が決まっているわけではありません。 複数のタスクを並行して実行することも、状況に合わせてタスクの順序を変えることも、プロジェクト内で繰り返すたびに毎回同じ手順を実行することもできます。

1. アプリケーション全体またはその中のレイヤーの[依存関係図を作成](#Create)します。

2. アプリケーションの[主要な機能領域またはコンポーネントを表すレイヤーを定義](#CreateLayers)します。 これらのレイヤーには、その機能に合わせて "プレゼンテーション" や "サービス" などの名前を付けます。 Visual Studio ソリューションがある場合は、各レイヤーを *成果物* のコレクション (プロジェクト、名前空間、ファイルなど) に関連付けることができます。

3. レイヤー間の[既存の依存関係を検出](#Generate)します。

4. [レイヤーと依存関係を編集](#EditArchitecture) して、コードに反映させる更新されたデザインを表示します。

5. 主要なアーキテクチャブロックまたはコンポーネントを表すレイヤーを作成し、依存関係を定義して、各レイヤーが他のレイヤーをどのように使用しているかを示すことによって、[アプリケーションの新しい領域を設計](#NewAreas)します。

6. [図のレイアウトと外観を編集](#EditLayout) して、同僚と話し合うようにします。

7. [依存関係図に対してコードを検証](#Validate) して、コードと必要なアーキテクチャとの間の競合を強調表示します。

8. [新しいアーキテクチャに準拠するようにコードを更新](#UpdateCode)します。 検証によって競合が報告されなくなるまで、コードの開発とリファクタリングを繰り返します。

9. [ビルドプロセスにレイヤー検証を含め](#BuildValidation) て、コードが引き続きデザインに準拠していることを確認します。

## <a name="create-a-dependency-diagram"></a><a name="Create"></a> 依存関係図の作成

依存関係図は、モデリングプロジェクト内に作成する必要があります。 既存のモデリングプロジェクトに新しい依存関係図を追加したり、依存関係図の新しいモデリングプロジェクトを作成したり、同じモデリングプロジェクト内の既存の依存関係図をコピーしたりできます。

> [!IMPORTANT]
> 既存の依存関係図をモデリングプロジェクトから別のモデリングプロジェクトまたはソリューション内の別の場所に追加、ドラッグ、またはコピーしないでください。 この方法でコピーされた依存関係図は、図を変更した場合でも、元の図と同じ参照を持つことになります。 これにより、レイヤー検証は正しく機能せず、要素が欠落したり、図を開こうとすると他のエラーが発生するなど、他の問題が生じる可能性があります。

「 [コードから依存関係図を作成する」を](../modeling/create-layer-diagrams-from-your-code.md)参照してください。

## <a name="define-layers-to-represent-functional-areas-or-components"></a><a name="CreateLayers"></a> 機能領域またはコンポーネントを表すレイヤーを定義する

レイヤーは、プロジェクト、コードファイル、名前空間、クラス、メソッドなどの *成果物* の論理グループを表します。 Visual C# および Visual Basic プロジェクトの成果物からレイヤーを作成することも、Word ファイルや PowerPoint プレゼンテーションなどのドキュメントをリンクして、仕様や計画をレイヤーにアタッチすることもできます。 各レイヤーは、図では四角形として表示されます。また各レイヤーでは、レイヤーにリンクされている成果物の数が表示されます。 レイヤーには、より具体的なタスクを記述する入れ子になったレイヤーを含めることができます。

一般的に、レイヤーには、その機能に合わせて "プレゼンテーション" や "サービス" などの名前を付けます。 密に相互依存している成果物は、同じレイヤーに配置します。 別々に更新できる成果物や別のアプリケーションで使用できる成果物は、異なるレイヤーに配置してください。 レイヤーパターンの詳細については、「」の & プラクティスサイトを参照してください [http://go.microsoft.com/fwlink/?LinkId=145794](https://archive.codeplex.com/?p=apparch) 。

> [!TIP]
> 特定の種類の成果物は、レイヤーにリンクできますが、依存関係図に対する検証をサポートしていません。 成果物が検証をサポートしているかどうかを確認するには、 **レイヤーエクスプローラー** を開き、成果物のリンクの " **検証をサポート** " プロパティを確認します。 「 [レイヤー間の既存の依存関係の検出](#Generate)」を参照してください。

よく知らないアプリケーションを更新する場合は、コード マップを作成することもできます。 これらの図を利用することで、コードを検証するときに、パターンと依存関係を見つけやすくなります。 ソリューション エクスプローラーを使って、名前空間やクラスを調べることができます。これらは、通常は既存のレイヤーに対応しています。 これらのコードアイテムをソリューションエクスプローラーから依存関係図にドラッグして、レイヤーに割り当てます。 その後、依存関係図を使用して、コードを更新し、設計との一貫性を保つことができます。

参照:

- [コードからの依存関係図の作成](../modeling/create-layer-diagrams-from-your-code.md)

- [コード マップを使用してアプリケーションをデバッグする](../modeling/use-code-maps-to-debug-your-applications.md)

- [ソリューション間の依存関係をマップする](../modeling/map-dependencies-across-your-solutions.md)

## <a name="discover-existing-dependencies-between-layers"></a><a name="Generate"></a> レイヤー間の既存の依存関係を検出する

依存関係が存在するのは、あるレイヤーに関連付けられている成果物が、別のレイヤーに関連付けられている成果物を参照している場合です。 たとえば、あるレイヤー内のクラスが、別のレイヤー内のクラスを保持する変数を宣言する場合などです。 既存の依存関係を検出するには、リバース エンジニアリングします。

> [!NOTE]
> 成果物の種類によっては、依存関係をリバース エンジニアリングできないものもあります。 たとえば、テキスト ファイルにリンクされているレイヤーから、またはそのレイヤーに対して依存関係をリバース エンジニアリングすることはできません。 リバースエンジニアリングできる依存関係がある成果物を確認するには、1つまたは複数のレイヤーを右クリックし、[ **リンクの表示**] をクリックします。 **レイヤーエクスプローラー** で、[**検証をサポート**] 列を確認します。 この列に **False** と表示される成果物の依存関係はリバースエンジニアリングされません。

### <a name="to-reverse-engineer-existing-dependencies-between-layers"></a>レイヤー間の既存の依存関係をリバース エンジニアリングするには

1つまたは複数のレイヤーを選択し、選択したレイヤーを右クリックして、[ **依存関係の生成**] をクリックします。

通常は、不要な依存関係がいくつか見つかります。 これらの依存関係を編集して、目的の設計に準拠するようアラインできます。

## <a name="edit-layers-and-dependencies-to-show-the-intended-design"></a><a name="EditArchitecture"></a> レイヤーと依存関係を編集して目的のデザインを表示する

システムまたは目的のアーキテクチャに対して行う変更を記述するには、次の手順を使用して依存関係図を編集します。 また、リファクタリングの変更を行い、コードを拡張する前に構造を改良することもできます。 「 [コードの構造を改善する](#Improving)」を参照してください。

|**To**|**実行する手順**|
|-|-|
|不要な依存関係を削除する|依存関係をクリックし、del **キーを** 押します。|
|依存関係の方向を変更または制限する|**Direction** プロパティを設定します。|
|新しい依存関係を生成する|**依存** 関係ツールと **双方向の依存関係** ツールを使用します。<br /><br /> 複数の依存関係を描画するには、ツールをダブルクリックします。 操作が完了したら、[ **ポインター** ] ツールをクリックするか、 **ESC** キーを押します。|
|レイヤーに関連付けられている成果物が、指定した名前空間に依存できないように指定する|レイヤーの "禁止された **名前空間の依存関係** " プロパティに名前空間を入力します。 名前空間を区切るには、セミコロン (**;**) を使用します。|
|レイヤーに関連付けられている成果物を、指定した名前空間に所属させることができないように指定する|レイヤーの "禁止された **名前空間** " プロパティに名前空間を入力します。 名前空間を区切るには、セミコロン (**;**) を使用します。|
|レイヤーに関連付けられている成果物を、指定した名前空間のいずれかに必ず所属させるように指定する|レイヤーの " **必要な名前空間** " プロパティに名前空間を入力します。 名前空間を区切るには、セミコロン (**;**) を使用します。|

### <a name="improving-the-structure-of-the-code"></a><a name="Improving"></a> コードの構造を改善する

リファクタリングの変更を行ってもアプリケーションの振る舞いは変わりませんが、将来、コードの変更や拡張が容易になります。 適切に構造化されたコードには、依存関係図を簡単に抽象化できるデザインがあります。

たとえば、各名前空間を表すレイヤーをコードで生成し、依存関係をリバース エンジニアリングした場合は、レイヤー間の一方向の依存関係が最小限であることを確認する必要があります。 クラスまたはメソッドをレイヤーとして使用して、より詳細に図を生成した場合は、完成した図も同じ特性を備えている必要があります。

そうでない場合、コードはその有効期間を通じて変更するのが困難であり、依存関係図を使用した検証には適していません。

## <a name="design-new-areas-of-your-application"></a><a name="NewAreas"></a> アプリケーションの新しい領域を設計する

新規プロジェクトの開発を新たに開始する場合や、新規プロジェクトで新しい領域の設計を開始する場合、コードの開発前にレイヤーと依存関係を描画することで、主要なコンポーネントを把握できます。

- 可能であれば、**特定できるアーキテクチャパターン** を依存関係図に表示します。 たとえば、デスクトップアプリケーションを記述する依存関係図には、プレゼンテーション、ドメインロジック、データストアなどのレイヤーが含まれている場合があります。 アプリケーション内の1つの機能をカバーする依存関係図には、モデル、ビュー、コントローラーなどのレイヤーが含まれている場合があります。 このようなパターンの詳細については、「 [パターン & プラクティス: アプリケーションアーキテクチャ](https://archive.codeplex.com/?p=apparch)」を参照してください。

- 名前空間、クラス、コンポーネントなど **のレイヤーごとにコードアーティファクトを作成** します。 これにより、コードの追跡やレイヤーへのコードのリンクが容易になります。 成果物を生成するごとに、すぐに適切なレイヤーにリンクさせてください。

- **ほとんどのクラスとその他の成果物** は、既にレイヤーにリンクしている名前空間などのより大きな成果物に分類されるため、レイヤーにリンクする必要はありません。

- **新しい機能の新しい図を作成** します。 通常、アプリケーション全体を説明する1つ以上の依存関係図があります。 アプリケーション内の新機能を設計するときには、既存の図を流用しないでください。 代わりに、コードの新しい部分を反映した独自の図を生成します。 新しい図には、新機能のプレゼンテーション レイヤー、ドメイン ロジック レイヤー、データベース レイヤーなどを追加できます。

     アプリケーションをビルドするときに、全体を示す図とより詳細な機能の図の両方に対してコードが検証されます。

## <a name="edit-the-layout-for-presentation-and-discussion"></a><a name="EditLayout"></a> プレゼンテーションとディスカッションのレイアウトを編集する

レイヤーおよび依存関係を識別しやすくするには、またはチーム メンバーとそれらについて話し合うことができるようにするには、次の方法で図の外観およびレイアウトを編集します。

- レイヤーのサイズ、形状、および位置

- レイヤーと依存関係の色

  - 1つまたは複数のレイヤーまたは依存関係を選択し、右クリックして、[ **プロパティ**] をクリックします。 [ **プロパティ** ] ウィンドウで、 **Color** プロパティを編集します。

## <a name="validate-the-code-against-the-diagram"></a><a name="Validate"></a> 図に対してコードを検証する

図を編集したら、いつでも手動でコードに対して検証することも、ビルドするたびに自動的に検証することもできます。

参照トピック

- [依存関係図を使用したコードの検証](../modeling/validate-code-with-layer-diagrams.md)

- [ビルド処理へのレイヤー検証の組み込み](#BuildValidation)

## <a name="update-the-code-to-conform-to-the-new-architecture"></a><a name="UpdateCode"></a> 新しいアーキテクチャに準拠するようにコードを更新する

通常、更新された依存関係図に対してコードを初めて検証するときに、エラーが表示されます。 これらのエラーには、いくつかの原因が考えられます。

- 成果物が不適切なレイヤーに割り当てられている。 この場合、成果物を移動します。

- クラスなどの成果物が、アーキテクチャに違反する形で別のクラスを使用している。 この場合、コードをリファクタリングして依存関係を削除します。

これらのエラーを解決するには、コードを更新して、検証時にエラーが表示されなくなるようにします。 通常、これは反復的な作業になります。 これらのエラーの詳細については、「 [依存関係図を使用したコードの検証](../modeling/validate-code-with-layer-diagrams.md)」を参照してください。

> [!NOTE]
> コードを開発またはリファクタリングするときに、依存関係図にリンクする新しい成果物がある可能性があります。 これは必ずしも必要な作業ではありません。たとえば、レイヤーが既存の名前空間を表しており、新しいコードでこれらの名前空間に要素を追加するだけの場合は不要です。

開発プロセスの実行中は、検証時に報告される一部の競合を抑制できます。 たとえば、既に解決したエラーや特定のシナリオに関連しないエラーを抑制できます。 エラーを抑制する場合は、Team Foundation で作業項目をログに記録することをお勧めします。 このタスクを実行するには、「 [依存関係図を使用したコードの検証](../modeling/validate-code-with-layer-diagrams.md)」を参照してください。

## <a name="include-layer-validation-in-the-build-process"></a><a name="BuildValidation"></a> ビルドプロセスにレイヤー検証を含める

コードの今後の変更が依存関係図に準拠していることを確認するには、ソリューションの標準のビルドプロセスにレイヤー検証を含めます。 他のチームメンバーがソリューションをビルドするたびに、コード内の依存関係と依存関係図の間の相違点がビルドエラーとして報告されます。 ビルドプロセスにレイヤー検証を含める方法の詳細については、「 [依存関係図を使用したコードの検証](../modeling/validate-code-with-layer-diagrams.md)」を参照してください。

## <a name="see-also"></a>関連項目

- [依存関係図: リファレンス](../modeling/layer-diagrams-reference.md)
- [コードからの依存関係図の作成](../modeling/create-layer-diagrams-from-your-code.md)
