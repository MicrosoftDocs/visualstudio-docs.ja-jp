---
title: T4 テキスト テンプレートの記述に関するガイドライン
ms.date: 11/04/2016
ms.topic: conceptual
author: JoshuaPartlow
ms.author: joshuapa
manager: jillfra
ms.workload:
- multiple
ms.openlocfilehash: 24c8afd5e34d4957dac3d9f4d5b0e4409ad20895
ms.sourcegitcommit: d233ca00ad45e50cf62cca0d0b95dc69f0a87ad6
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/01/2020
ms.locfileid: "75596542"
---
# <a name="guidelines-for-writing-t4-text-templates"></a>T4 テキスト テンプレートの記述に関するガイドライン

これらの一般的なガイドラインは、Visual Studio で、プログラム コードまたはその他のアプリケーション リソースを生成する場合に役立つ可能性があります。 これは、固定されたものではありません。

## <a name="guidelines-for-design-time-t4-templates"></a>デザイン時 T4 テンプレートのガイドライン

デザイン時 T4 テンプレートは、デザイン時に Visual Studio プロジェクト内のコードを生成するテンプレートです。 詳細については、次を参照してください。 [T4 テキスト テンプレートを使用したデザイン時コード生成](../modeling/design-time-code-generation-by-using-t4-text-templates.md) テンプレートの構文の詳細については、次を参照してください。

アプリケーションの変数の側面を生成します。

コード生成は、プロジェクトの中で変わる可能性がある、あるいは、異なるバージョン間で変化するアプリケーションの要素に対して最も役立ちます。 何を生成すべきであるかをより簡単に確認できるように、比較的不変的な部分から可変部分を分離します。 たとえば、アプリケーションで、web サイトを提供する場合 1 つのページから別のナビゲーション パスを定義するロジックから、標準的なページを提供している関数を分離します。

1 つまたは複数のソース モデルの可変部分をエンコードします。

モデルは、各テンプレートから生成されるコードの変数部分を特定の値として取得するために読み取るファイルまたはデータベースです。 モデルには、データベース、デザイン、図、またはドメイン固有言語の XML ファイルが指定されます。 通常、1 つのモデルは、Visual Studio プロジェクトにおいて多数のファイルの生成に使用されます。 各ファイルは、個別のテンプレートから生成されます。

1つのプロジェクトで複数のモデルを使用できます。 たとえば、web ページ間のナビゲーションのためのモデル、および、ページのレイアウトのための別のモデルを定義する可能性があります。

実装ではなく、ユーザーのニーズとボキャブラリにモデルの焦点を当てます。

たとえば、web サイト アプリケーションでは、web ページおよびハイパーリンクへの参照のモデルが考えられます。

理想的には、モデルが表現する情報の種類に合ったプレゼンテーションのフォームを選択します。 たとえば、web サイトのナビゲーション パスのモデルでは、ボックスと矢印のダイアグラムの可能性があります。

生成されたコードをテストします。

得られたコードがユーザーが要求したように働いているかを確認するために、手動または自動テストを使用します。 コードが生成されたのと同じモデルからテストが生成されないようにします。

場合によっては、ジェネラル テストはモデルに直結します。 例えば、他のナビゲーションで、web サイト内の各ページにアクセスできるかどうかのテストは必ず作成します。

カスタム コードの許可: 部分クラスの生成。

生成されたコードに手動でコードを追加できるようになります。 生じる可能性のあるすべてのバリエーションを考慮した設定のコード生成は一般的にはできません。 したがって、生成されたコードの一部を追加またはオーバーライドすることをお勧めします。 生成されたマテリアルがや Visual Basic などの .NET C#言語に含まれている場合、次の2つの方法が特に便利です。

- クラスは部分クラスにすべきである。 これにより、生成されたコードにコンテンツを追加できるようになる。

- クラスは一方が他方を継承する一組のクラスで生成すべきである。 基本クラスはすべての生成されるメソッドとプロパティを含め、派生クラスにはコンストラクターのみを含めます。 これにより、手動で記述するコードで生成されたメソッドをオーバーライドできます。

XML といったほかの生成される言語においては、`<#@include#>` ディレクティブをつかうことにより、手動および生成されたコンテンツを単純に結合します。 より複雑な場合には、生成されたファイルを手動で記述されたファイルに結合するための後処理の手順を記述する必要があります。

共通素材をインクルードファイルまたは実行時テンプレートに移動します。

複数のテンプレートで同様のテキストとコードブロックを繰り返さないようにするには、`<#@ include #>` ディレクティブを使用します。 詳細については、次を参照してください。 [T4 Include ディレクティブ](../modeling/t4-include-directive.md)

また別のプロジェクトで実行時テキスト テンプレートをビルドし、デザイン時テンプレートから呼び出すことができます。 これを行うには、個別のプロジェクトにアクセスする `<#@ assembly #>` ディレクティブを使用します。

大量のコードの別のアセンブリへの移動の検討。

大規模なコード ブロックおよびクラス機能ブロックがある場合は、これらのコードの一部を、別のプロジェクトでコンパイルするメソッドに移動すると便利になることがあります。 そのテンプレートでコードにアクセスするために、`<#@ assembly #>` ディレクティブを使います。 詳細については、次を参照してください。 [T4 アセンブリ ディレクティブ](../modeling/t4-assembly-directive.md)

テンプレートが継承できる抽象クラスにメソッドを格納することができます。 抽象クラスは、<xref:Microsoft.VisualStudio.TextTemplating.TextTransformation?displayProperty=fullName>を継承する必要があります。 詳細については、次を参照してください。 [T4 テンプレート ディレクティブ](../modeling/t4-template-directive.md)

構成ファイルではなくコードを生成します。

変数アプリケーションを記述する方法の1つとして、構成ファイルを受け入れる汎用プログラムコードを記述する方法があります。 このように記述されたアプリケーションは非常に柔軟であり、ビジネス要件が変更されたときに、アプリケーションを再構築せずに再構成することができます。 ただし、この方法の欠点は、アプリケーションがより具体的なアプリケーションよりも動作が少なくなることです。 また、プログラムコードは、ほとんどのジェネリック型を常に処理することになるため、読み取りと保守がより困難になります。

これに対し、アプリケーションをコンパイルする前に生成される可変部分の型指定ができます。 これにより、手書きのコードを記述し、ソフトウェアの生成された部分と統合することが、はるかに簡単かつより信頼性が高くなります。

コード生成の利点を完全に活用するために、構成ファイルではなく、プログラム コードの生成を試してみてください。

生成されたコードフォルダーを使用します。

テンプレートおよび生成されたファイルを、**生成さ**れたコードという名前のプロジェクトフォルダーに配置して、直接編集する必要があるファイルではないことを明確にします。 生成されたクラスをオーバーライドまたは追加するカスタムコードを作成する場合は、それらのクラスを**カスタムコード**という名前のフォルダーに配置します。 一般的なプロジェクトの構造は次のようになります。

```
MyProject
   Custom Code
      Class1.cs
      Class2.cs
   Generated Code
      Class1.tt
          Class1.cs
      Class2.tt
          Class2.cs
   AnotherClass.cs
```

## <a name="guidelines-for-run-time-preprocessed-t4-templates"></a>実行時 (前処理済み) の T4 テンプレートのガイドライン

共通素材を継承されたテンプレートに移動します。

継承を使用すると、T4 テキストテンプレート間でメソッドとテキストブロックを共有できます。 詳細については、次を参照してください。 [T4 テンプレート ディレクティブ](../modeling/t4-template-directive.md)

ランタイム テンプレートを含むインクルード ファイルを使用することもできます。

大きな本体を持つコードは部分クラスに移動します。

各実行時テンプレートは、テンプレートと同じ名前を持つ部分クラスの定義を生成します。 同じクラスの別の部分定義を含むコードファイルを作成できます。 この方法でクラスには、メソッド、フィールド、およびコンストラクターを追加できます。 これらのメンバーは、テンプレートのコードブロックから呼び出すことができます。

これを行う利点は、IntelliSense が使用可能なため、コードを記述するのが簡単です。 また、プレゼンテーションと基になるロジックをより適切に分離することもできます。

例 **MyReportText.tt**:

`The total is: <#= ComputeTotal() #>`

**MyReportText-Methods.cs**の場合:

`private string ComputeTotal() { ... }`

カスタムコードを許可する: 拡張ポイントを提供します。

\<# + クラス機能ブロック # > で仮想メソッドを生成することを検討してください。 これにより、変更なしにさまざまなコンテキストで使用できまる1 つのテンプレートができます。 テンプレートを変更する代わりに、最小の追加のロジックを提供する派生クラスを構築できます。 派生クラスは、通常のコード、実行時テンプレートどちらもあり得ます。

例 MyStandardRunTimeTemplate.tt:

```
This page is copyright <#= CompanyName() #>.
<#+ protected virtual string CompanyName() { return ""; } #>
```

アプリケーションのコード:

```
class FabrikamTemplate : MyStandardRunTimeTemplate
{
  protected override string CompanyName() { return "Fabrikam"; }
}
...
  string PageToDisplay = new FabrikamTemplate().TextTransform();
```

## <a name="guidelines-for-all-t4-templates"></a>すべての T4 テンプレートのガイドライン

テキスト生成からのデータ収集を分離します。

計算とテキストブロックの混合を避けるようにしてください。 各テキストテンプレートでは、最初の \<# code ブロック # > を使用して変数を設定し、複雑な計算を実行します。 最初のテキストブロックからテンプレートの末尾まで、または最初の \<# + クラス機能ブロック # > では、長い式を避け、テキストブロックが含まれている場合を除き、ループと条件を回避します。 これにより、テンプレートが読みやすくなり、保守も容易になります。

インクルードファイルには `.tt` を使用しないでください。

インクルードファイルには、`.ttinclude` などの別のファイル名拡張子を使用します。 `.tt` は、実行時またはデザイン時のテキストテンプレートとして処理するファイルに対してのみ使用します。 場合によっては、Visual Studio が `.tt` ファイルを認識し、処理のためにプロパティを自動的に設定します。

固定プロトタイプとして各テンプレートを開始。

生成したいコードあるいはテキストの例を記述し、それが正しいことを確認します。 その拡張子を .tt に変更し、段階的に、モデルを読み取ってコンテンツを変更するコードを挿入します。

型指定されたモデルの使用の検討。

モデルのために XML またはデータベースのスキーマを作成することができますが、ドメイン固有言語 (DSL) を作成すると便利な場合があります。 DSL には、スキーマおよび属性を表すプロパティ内の各ノードを表すクラスが生成されるという利点があります。 これは、ビジネスモデルの観点からプログラミングできることを意味します。 例:

```
Team Members:
<# foreach (Person p in team.Members)
 { #>
    <#= p.Name #>
<# } #>
```

モデルのダイアグラムの使用を検討。

多くのモデルは、効果的に表現され、特に非常に大きい場合には、テキスト テーブルとして単純に管理されています。

しかし、ある種のビジネス要件では、リレーションシップと、ワークフローの複雑なセットを明確にすることが重要であり、ダイアグラムは最も適したメディアです。 ダイアグラムの利点は、ユーザーとその他の利害関係者と話し合うのが簡単になります。 ビジネス要件のレベルでモデルからコードを生成することで、要件が変更されたときのためのコードをより柔軟に作成することができます。

ドメイン固有言語 (DSL) として独自のタイプのダイアグラムを設計することもできます。 UML および DSL の両方からコードを生成できます。 詳細については、次を参照してください。[分析とアーキテクチャのモデリング](../modeling/analyze-and-model-your-architecture.md)

## <a name="see-also"></a>関連項目

- [T4 テキスト テンプレートを使用したデザイン時コード生成](../modeling/design-time-code-generation-by-using-t4-text-templates.md)
- [T4 テキスト テンプレートを使用した実行時テキスト生成](../modeling/run-time-text-generation-with-t4-text-templates.md)
