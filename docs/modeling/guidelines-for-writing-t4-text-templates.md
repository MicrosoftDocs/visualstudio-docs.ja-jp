---
title: T4 テキスト テンプレートの記述に関するガイドライン
ms.date: 11/04/2016
ms.topic: conceptual
author: JoshuaPartlow
ms.author: joshuapa
manager: jillfra
ms.workload:
- multiple
ms.openlocfilehash: 24c8afd5e34d4957dac3d9f4d5b0e4409ad20895
ms.sourcegitcommit: 6cfffa72af599a9d667249caaaa411bb28ea69fd
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/02/2020
ms.locfileid: "75596542"
---
# <a name="guidelines-for-writing-t4-text-templates"></a>T4 テキスト テンプレートの記述に関するガイドライン

これらの一般的なガイドラインは、プログラムコードやその他のアプリケーションリソースを Visual Studio で生成する場合に役立ちます。 これらは固定規則ではありません。

## <a name="guidelines-for-design-time-t4-templates"></a>デザイン時 T4 テンプレートのガイドライン

デザイン時 T4 テンプレートは、デザイン時に Visual Studio プロジェクト内のコードを生成するテンプレートです。 詳細については、「 [T4 テキストテンプレートを使用したデザイン時のコード生成](../modeling/design-time-code-generation-by-using-t4-text-templates.md)」を参照してください。

アプリケーションの変数の側面を生成します。

コード生成は、プロジェクト中に変更される可能性があるアプリケーションの側面や、アプリケーションの異なるバージョン間で変更される可能性がある場合に最も役立ちます。 生成するものをより簡単に判断できるように、これらの変数の特性をより不変な部分から分離します。 たとえば、アプリケーションが web サイトを提供する場合は、標準のページ機能を提供する機能を、ナビゲーションパスを定義するロジックから別のページに分割します。

1つ以上のソースモデルで変数の特性をエンコードします。

モデルは、生成されるコードの変数部分の特定の値を取得するために各テンプレートが読み取られるファイルまたはデータベースです。 モデルには、データベース、独自のデザインの XML ファイル、ダイアグラム、またはドメイン固有の言語を使用できます。 通常、1つのモデルを使用して、Visual Studio プロジェクトで多数のファイルを生成します。 各ファイルは、個別のテンプレートから生成されます。

1つのプロジェクトで複数のモデルを使用できます。 たとえば、web ページ間のナビゲーション用にモデルを定義したり、ページのレイアウトに別のモデルを定義したりすることができます。

実装ではなく、ユーザーのニーズとボキャブラリでモデルに専念します。

たとえば、web サイトアプリケーションでは、モデルが web ページとハイパーリンクを参照することが想定されます。

理想的には、モデルが表す情報の種類に適したプレゼンテーション形式を選択します。 たとえば、web サイト経由のナビゲーションパスのモデルは、ボックスと矢印の図になります。

生成されたコードをテストします。

手動テストまたは自動テストを使用して、結果のコードがユーザーの必要に応じて動作することを確認します。 コードの生成元と同じモデルからテストを生成しないようにします。

場合によっては、一般的なテストをモデルに対して直接実行できます。 たとえば、web サイト内のすべてのページにアクセスできることを確認するテストを記述することができます。

カスタムコードを許可する: 部分クラスを生成します。

生成されたコードに加えて、手動で記述したコードを許可します。 コード生成スキームで、発生する可能性があるすべてのバリエーションを考慮することは通常ありません。 したがって、生成されたコードの一部を追加またはオーバーライドすることをお勧めします。 生成されたマテリアルが C# や Visual Basic などの .NET 言語に含まれる場合、次の2つの方法が特に便利です。

- 生成されたクラスは、部分的なものである必要があります。 これにより、生成されたコードにコンテンツを追加できます。

- クラスは、もう一方を継承するペアで生成される必要があります。 基底クラスには、生成されたメソッドとプロパティがすべて含まれている必要があり、派生クラスにはコンストラクターのみを含める必要があります。 これにより、記述されたコードで、生成されたメソッドをすべてオーバーライドできます。

XML などの他の生成された言語では、ディレクティブを使用して、 `<#@include#>` 手動で記述したコンテンツと生成されたコンテンツを簡単に組み合わせます。 より複雑なケースでは、生成されたファイルを任意のファイルに結合した後処理手順を記述しなければならない場合があります。

共通素材をインクルードファイルまたは実行時テンプレートに移動します。

複数のテンプレートで同様のテキストとコードブロックを繰り返さないようにするには、ディレクティブを使用し `<#@ include #>` ます。 詳細については、「 [T4 Include ディレクティブ](../modeling/t4-include-directive.md)」を参照してください。

また、実行時のテキストテンプレートを別のプロジェクトにビルドし、デザイン時テンプレートから呼び出すこともできます。 これを行うには、ディレクティブを使用して `<#@ assembly #>` 別のプロジェクトにアクセスします。

大きなコードブロックを別のアセンブリに移動することを検討してください。

大きなコードブロックとクラスの機能ブロックがある場合は、別のプロジェクトでコンパイルするメソッドにこのコードの一部を移動すると便利な場合があります。 ディレクティブを使用して、 `<#@ assembly #>` テンプレート内のコードにアクセスできます。 詳細については、「 [T4 アセンブリディレクティブ](../modeling/t4-assembly-directive.md)」を参照してください。

テンプレートが継承できる抽象クラスにメソッドを配置できます。 抽象クラスは、から継承する必要があり <xref:Microsoft.VisualStudio.TextTemplating.TextTransformation?displayProperty=fullName> ます。 詳細については、「 [T4 テンプレートディレクティブ](../modeling/t4-template-directive.md)」を参照してください。

構成ファイルではなくコードを生成します。

変数アプリケーションを記述する方法の1つとして、構成ファイルを受け入れる汎用プログラムコードを記述する方法があります。 このように記述されたアプリケーションは非常に柔軟であり、ビジネス要件が変更されたときに、アプリケーションを再構築せずに再構成することができます。 ただし、この方法の欠点は、アプリケーションがより具体的なアプリケーションよりも動作が少なくなることです。 また、プログラムコードは、ほとんどのジェネリック型を常に処理することになるため、読み取りと保守がより困難になります。

これに対して、コンパイル前に変数部分が生成されるアプリケーションは、厳密に型指定できます。 これにより、手作業で記述されたコードをより簡単かつ確実に記述し、ソフトウェアの生成された部分と統合できます。

コード生成の利点を最大限に活用するには、構成ファイルではなくプログラムコードを生成してみてください。

生成されたコードフォルダーを使用します。

テンプレートおよび生成されたファイルを、 **生成さ**れたコードという名前のプロジェクトフォルダーに配置して、直接編集する必要があるファイルではないことを明確にします。 生成されたクラスをオーバーライドまたは追加するカスタムコードを作成する場合は、それらのクラスを **カスタムコード**という名前のフォルダーに配置します。 一般的なプロジェクトの構造は次のようになります。

```
MyProject
   Custom Code
      Class1.cs
      Class2.cs
   Generated Code
      Class1.tt
          Class1.cs
      Class2.tt
          Class2.cs
   AnotherClass.cs
```

## <a name="guidelines-for-run-time-preprocessed-t4-templates"></a>実行時 (前処理済み) の T4 テンプレートのガイドライン

共通素材を継承されたテンプレートに移動します。

継承を使用すると、T4 テキストテンプレート間でメソッドとテキストブロックを共有できます。 詳細については、「 [T4 テンプレートディレクティブ](../modeling/t4-template-directive.md)」を参照してください。

また、実行時テンプレートを含むインクルードファイルを使用することもできます。

大規模なコード本体を部分クラスに移動します。

各ランタイムテンプレートでは、テンプレートと同じ名前を持つ部分クラス定義が生成されます。 同じクラスの別の部分定義を含むコードファイルを作成できます。 この方法では、メソッド、フィールド、およびコンストラクターをクラスに追加できます。 これらのメンバーは、テンプレートのコードブロックから呼び出すことができます。

これを行う利点は、IntelliSense を使用できるため、コードの記述が簡単になることです。 また、プレゼンテーションと基になるロジックをより適切に分離することもできます。

たとえば、 **MyReportText.tt**の場合は次のようになります。

`The total is: <#= ComputeTotal() #>`

**MyReportText-Methods.cs**の場合:

`private string ComputeTotal() { ... }`

カスタムコードを許可する: 拡張ポイントを提供します。

で仮想メソッドを生成することを検討してください \<#+ class feature blocks #> 。 これにより、1つのテンプレートを変更せずに多くのコンテキストで使用できます。 テンプレートを変更する代わりに、追加のロジックを最小限にする派生クラスを作成できます。 派生クラスは、通常のコードでも、実行時テンプレートでもかまいません。

たとえば、MyStandardRunTimeTemplate.tt の場合は次のようになります。

```
This page is copyright <#= CompanyName() #>.
<#+ protected virtual string CompanyName() { return ""; } #>
```

アプリケーションのコードを次に示します。

```
class FabrikamTemplate : MyStandardRunTimeTemplate
{
  protected override string CompanyName() { return "Fabrikam"; }
}
...
  string PageToDisplay = new FabrikamTemplate().TextTransform();
```

## <a name="guidelines-for-all-t4-templates"></a>すべての T4 テンプレートのガイドライン

テキスト生成からのデータ収集を分離します。

計算とテキストブロックの混合を避けるようにしてください。 各テキストテンプレートでは、最初のを使用し \<# code block #> て変数を設定し、複雑な計算を実行します。 最初のテキストブロックからテンプレートの末尾まで、または1つ目は、 \<#+ class feature block #> 長い式を避け、テキストブロックが含まれている場合を除き、ループと条件を回避します。 これにより、テンプレートが読みやすくなり、保守も容易になります。

`.tt`インクルードファイルには使用しないでください。

インクルードファイルには、などの別のファイル名拡張子を使用し `.ttinclude` ます。 `.tt`実行時またはデザイン時のテキストテンプレートとして処理するファイルに対してのみ使用します。 場合によっては、Visual Studio が `.tt` ファイルを認識し、自動的にプロパティを処理するように設定します。

各テンプレートを固定プロトタイプとして起動します。

生成するコードまたはテキストの例を記述し、それが正しいことを確認します。 次に、拡張機能を .tt に変更し、モデルを読み取ってコンテンツを変更するコードをインクリメンタルに挿入します。

型指定されたモデルの使用を検討してください。

モデルの XML スキーマまたはデータベーススキーマを作成することもできますが、ドメイン固有言語 (DSL) を作成すると便利な場合があります。 DSL には、スキーマ内の各ノードを表すクラスと、属性を表すプロパティが生成されるという利点があります。 これは、ビジネスモデルの観点からプログラミングできることを意味します。 たとえば、次のように入力します。

```
Team Members:
<# foreach (Person p in team.Members)
 { #>
    <#= p.Name #>
<# } #>
```

モデルに図を使用することを検討してください。

多くのモデルは、特にサイズが非常に大きい場合に、単純にテキストテーブルとして提示および管理されます。

ただし、ビジネス要件によっては、複雑なリレーションシップセットとワークフローを明確にすることが重要です。また、図は最適なメディアです。 図の利点は、ユーザーや他の利害関係者と簡単に議論できることです。 ビジネス要件のレベルでモデルからコードを生成することにより、要件が変化したときにコードの柔軟性を高めることができます。

また、独自の種類の図をドメイン固有言語 (DSL) として設計することもできます。 コードは、UML と Dsl の両方から生成できます。 詳細については、「 [アーキテクチャの分析とモデリング](../modeling/analyze-and-model-your-architecture.md)」を参照してください。

## <a name="see-also"></a>関連項目

- [T4 テキスト テンプレートを使用したデザイン時コード生成](../modeling/design-time-code-generation-by-using-t4-text-templates.md)
- [T4 テキスト テンプレートを使用した実行時テキスト生成](../modeling/run-time-text-generation-with-t4-text-templates.md)
