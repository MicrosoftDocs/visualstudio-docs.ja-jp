---
title: ファイル記憶域および XML シリアル化をカスタマイズする |Microsoft ドキュメント
ms.custom: ''
ms.date: 11/04/2016
ms.topic: conceptual
f1_keywords:
- vs.dsltools.dsldesigner.xmlbehavior
helpviewer_keywords:
- Domain-Specific Language, serialization
author: gewarren
ms.author: gewarren
manager: douge
ms.workload:
- multiple
ms.technology: vs-ide-modeling
ms.openlocfilehash: 2ca1b9f8e6261ae04217b0d74e13073a3683915c
ms.sourcegitcommit: 6a9d5bd75e50947659fd6c837111a6a547884e2a
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/16/2018
---
# <a name="customizing-file-storage-and-xml-serialization"></a>ファイル格納処理および XML シリアル化処理のカスタマイズ
ユーザーが、インスタンスを保存するときに、または*モデル*でドメイン固有言語 (DSL) の[!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)]、XML ファイルを作成または更新します。 ファイルは、ストア内のモデルを再作成を再読み込みすることができます。  
  
 下にある設定を調整することによって、シリアル化のスキームをカスタマイズすることができます**Xml シリアル化の動作**DSL のエクスプ ローラーでします。 下のノードがある**Xml シリアル化の動作**のすべてのドメイン クラス、プロパティ、および関係。 ソース クラスに下には、リレーションシップがあります。 図形、コネクタ、および図のクラスに対応するノードもあります。  
  
 より高度なカスタマイズのプログラム コードを記述することもできます。  
  
> [!NOTE]
>  特定の形式でモデルを保存するが、そのフォームから再読み込みする必要はない場合、は、テキスト テンプレートを使用して、カスタムのシリアル化スキームではなく、モデルから出力を生成することを検討します。 詳細については、次を参照してください。[ドメイン固有言語から、コードの生成](../modeling/generating-code-from-a-domain-specific-language.md)です。  
  
## <a name="model-and-diagram-files"></a>モデルと図ファイル  
 通常、各モデルは、2 つのファイルで保存します。  
  
-   モデル ファイルなど、名前があります**Model1.mydsl**です。 モデル要素とのリレーションシップとそのプロパティを格納します。 などのファイル拡張子**.mydsl**によって決定されます、 **FileExtension**のプロパティ、**エディター** DSL 定義内のノードです。  
  
-   ダイアグラム ファイルなど、名前があります**Model1.mydsl.diagram**です。 図形、コネクタ、およびそれらの位置、色、線の太さ、およびダイアグラムの外観の他の詳細を格納します。 ユーザーを削除した場合、 **.diagram**ファイル、モデルの重要な情報は失われます。 ダイアグラムのレイアウトだけでは、失われます。 モデル ファイルを開いたときに、既定値は、図形のセットし、コネクタが作成されます。  
  
#### <a name="to-change-the-file-extension-of-a-dsl"></a>DSL のファイル拡張子を変更するには  
  
1.  DSL 定義を開きます。 DSL のエクスプ ローラーで、エディター ノードをクリックします。  
  
2.  プロパティ ウィンドウで、編集、 **FileExtension**プロパティです。 初期を含めないでください"です。"ファイル名拡張子のです。  
  
3.  ソリューション エクスプ ローラーで 2 つの項目テンプレート ファイルの名前を変更**DslPackage\ProjectItemTemplates**です。 これらのファイルは、次の形式に従って名前を持ちます。  
  
     `myDsl.diagram`  
  
     `myDsl.myDsl`  
  
## <a name="the-default-serialization-scheme"></a>既定のシリアル化スキーム  
 このトピックの例を作成するには、次の DSL 定義が使用されました。  
  
 ![DSL 定義ダイアグラム&#45;ファミリ ツリー モデル](../modeling/media/familyt_person.png "FamilyT_Person")  
  
 この DSL は、次の外観を備えた、画面のモデルの作成に使用されました。  
  
 ![ファミリ ツリー ダイアグラム、ツールボックス、およびエクスプ ローラー](../modeling/media/familyt_instance.png "FamilyT_Instance")  
  
 このモデルが保存され、し、再び XML テキスト エディターで開かれます。  
  
```  
<?xml version="1.0" encoding="utf-8"?>  
<familyTreeModel xmlns:dm0="http://schemas.microsoft.com/VisualStudio/2008/DslTools/Core" dslVersion="1.0.0.0" Id="f817b728-e920-458e-bb99-98edc469d78f" xmlns="http://schemas.microsoft.com/dsltools/FamilyTree">  
  <people>  
    <person name="Henry VIII" birthYear="1491" deathYear="1547" age="519">  
      <children>  
        <personMoniker name="/f817b728-e920-458e-bb99-98edc469d78f/Elizabeth I" />  
        <personMoniker name="/f817b728-e920-458e-bb99-98edc469d78f/Mary" />  
      </children>  
    </person>  
    <person name="Elizabeth I" birthYear="1533" deathYear="1603" age="477" />  
    <person name="Mary" birthYear="1515" deathYear="1558" age="495" />  
  </people>  
</familyTreeModel>  
  
```  
  
 シリアル化されたモデルに関する次の点に注意してください。  
  
-   各 XML ノードでは、最初の文字が小文字する点を除いては、ドメイン クラス名と同じ名前があります。 たとえば、`familyTreeModel`と`person`です。  
  
-   名前と BirthYear などのドメインのプロパティは、XML ノードの属性としてシリアル化されます。 もう一度、プロパティ名の最初の文字が小文字に変換されます。  
  
-   個々 のリレーションシップは、入れ子にされたリレーションシップのソース エンドの XML ノードとしてシリアル化します。 ノードは、ソース ロールのプロパティが、先頭の文字は小文字のみ、同じ名前を持ちます。  
  
     たとえば、DSL 定義、名前は、ロールで**人**から供給、 **FamilyTree**クラスです。  という名前のノードで、XML で表されます`people`内で入れ子、`familyTreeModel`ノード。  
  
-   各埋め込みリレーションシップのターゲット エンドは、リレーションシップの下に入れ子になったノードとしてシリアル化します。 たとえば、`people`ノードでは、いくつか含まれています`person`ノード。  
  
-   各参照リレーションシップのターゲット エンドとしてシリアル化、*モニカー*対象となる要素への参照をエンコードします。  
  
     たとえば、下、`person`ノードがあります、`children`リレーションシップ。 このノードには、モニカーにはなどが含まれます。  
  
    ```  
    <personMoniker name="/f817b728-e920-458e-bb99-98edc469d78f/Elizabeth I" />  
    ```  
  
## <a name="understanding-monikers"></a>Understanding モニカー  
 モニカーが使用され、モデルと図のファイルのさまざまな部分との間の相互参照を表します。 使用されることも、`.diagram`ファイルをモデル ファイル内のノードを参照してください。 これには 2 つのモニカーの形式があります。  
  
-   *Id モニカー*引用符で囲むターゲット要素の GUID。 例えば:  
  
    ```  
    <personShapeMoniker Id="f79734c0-3da1-4d72-9514-848fa9e75157" />  
  
    ```  
  
-   *キーのモニカーを修飾*モニカー キーと呼ばれる指定されたドメイン プロパティの値によって、ターゲット要素を識別します。 対象となる要素のモニカーのプレフィックスが付いたリレーションシップの埋め込みのツリーで、その親要素のモニカーです。  
  
     次の例は、DSL をあるはクラスの名前付きの曲をドメインに埋め込みリレーションシップを持つアルバムをという名前のドメイン クラスから取得されます。  
  
    ```  
    <albumMoniker title="/My Favorites/Jazz after Teatime" />  
    <songMoniker title="/My Favorites/Jazz after Teatime/Hot tea" />  
  
    ```  
  
     ターゲット クラスにドメインのプロパティがある場合は、対象の修飾キー モニカーが使用する、オプション**モニカー キーである**に設定されている`true`で**Xml シリアル化の動作**です。 例では、このオプションは、ドメイン クラス「アルバム」および「曲」で"Title"をという名前のドメイン プロパティの設定します。  
  
 修飾キー モニカーは、ID モニカーよりも読みやすくします。 人が判読できるように、モデル ファイルの XML を意図している場合は、修飾キー モニカを使用することを検討します。 ただし、可能であればユーザーが同じモニカー キーを持つ 2 つ以上の要素を設定するためです。 重複するキーには、ファイルを正しく再読み込みされません可能性があります。 したがって、修飾キー モニカーを使用して参照されているドメイン クラスを定義する場合は、重複するモニカーのあるファイルを保存してから、ユーザーを回避する方法を検討してください。  
  
#### <a name="to-set-a-domain-class-to-be-referenced-by-id-monikers"></a>ドメイン クラス ID モニカーによって参照されていることを設定するには  
  
1.  確認して**モニカー キーである**は`false`クラスとその基本クラスのすべてのドメイン プロパティ用です。  
  
    1.  DSL のエクスプ ローラーで展開**Xml シリアル化 Behavior\Class データ\\***\<ドメイン クラス >***\Element データ**です。  
  
    2.  いることを確認**モニカー キーである**は`false`すべてのドメイン プロパティ用です。  
  
    3.  ドメイン クラスに基底クラスがある場合は、そのクラス」の手順を繰り返します。  
  
2.  設定**Id のシリアル化** =  `true`ドメイン クラスです。  
  
     このプロパティは「 **Xml シリアル化の動作**です。  
  
#### <a name="to-set-a-domain-class-to-be-referenced-by-qualified-key-monikers"></a>修飾キー モニカーによって参照されているドメイン クラスを設定するには  
  
-   設定**モニカー キーである**の既存のドメイン クラスのドメインのプロパティです。 プロパティの型でなければなりません`string`です。  
  
    1.  DSL のエクスプ ローラーで展開**Xml シリアル化 Behavior\Class データ\\***\<ドメイン クラス >***\Element データ**、し、ドメインのプロパティを選択します。  
  
    2.  [プロパティ] ウィンドウで次のように設定します。**モニカー キーである**に`true`です。  
  
-   \- または -  
  
     新しいドメインを使用するクラスを作成、**という名前のドメイン クラス**ツールです。  
  
     このツールは、名前と呼ばれるドメイン プロパティを持つ新しいクラスを作成します。 **は要素名**と**モニカー キーである**にこのドメインのプロパティのプロパティが初期化されます`true`です。  
  
-   \- または -  
  
     ドメイン クラスからモニカー キー プロパティを持つ別のクラスに継承関係を作成します。  
  
### <a name="avoiding-duplicate-monikers"></a>重複するモニカーの回避  
 修飾キー モニカーを使用する場合は、可能であれば、ユーザーのモデル内の 2 つの要素がキー プロパティに同じ値を持つ可能性があります。 たとえば、DSL にクラス プロパティ名を持つユーザーがある場合、ユーザーは同じである 2 つの要素の名前を設定します。 モデルがある可能性がありますが、ファイルに保存すると、それが再読み込みされません正しくです。  
  
 このような状況を避けるために役立ついくつかの方法はあります。  
  
-   設定**は要素名** =  `true`キーのドメインのプロパティです。 DSL 定義ダイアグラムでの domain プロパティを選択し、[プロパティ] ウィンドウで、値を設定します。  
  
     ユーザーは、クラスの新しいインスタンスを作成するとき、この値は、別の値を自動的に割り当てられるにドメインのプロパティとします。 既定の動作は、クラス名の末尾に数値を追加します。 これは防止しません、ユーザーに、重複する名前を変更するが、ユーザーが、モデルを保存する前に、値を設定しない場合の場合、できます。  
  
-   DSL の検証を有効にします。 DSL のエクスプ ローラーで Editor\Validation を選択し、設定、**を使用しています.**プロパティ`true`です。  
  
     あいまいさのチェックを自動的に生成された検証メソッドが存在します。 メソッドが、`Load`検証カテゴリ。 これにより、あるユーザー警告が表示されますができないことがある、ファイルを再度開くことです。  
  
     詳細については、次を参照してください。[ドメイン固有言語で検証](../modeling/validation-in-a-domain-specific-language.md)です。  
  
### <a name="moniker-paths-and-qualifiers"></a>モニカーのパスと修飾子  
 修飾キー モニカーはモニカー キーを持つを終了し、埋め込みのツリー内の親のモニカーが付きます。 たとえば、アルバムのモニカーがある場合。  
  
```  
<albumMoniker title="/My Favorites/Jazz after Teatime" />  
  
```  
  
 そのアルバムの曲のいずれかが考えられます。  
  
```  
<songMoniker title="/My Favorites/Jazz after Teatime/Hot tea" />  
```  
  
 ただし、アルバムは、代わりに ID によって参照される場合、モニカーはようになります。  
  
```  
<albumMoniker Id="77472c3a-9bf9-4085-976a-d97a4745237c" />  
<songMoniker title="/77472c3a-9bf9-4085-976a-d97a4745237c/Hot tea" />  
```  
  
 GUID は一意であるためを決して付けたその親のモニカーに注意してください。  
  
 設定することができます、特定のドメイン プロパティが常に、モデル内で一意の値がわかっている場合**はモニカー修飾子**に`true`そのプロパティのです。 親のモニカーを使用せず、修飾子として使用されるようになります。 たとえば、両方を設定する**はモニカー修飾子**と**モニカー キーである**タイトル ドメイン クラスのプロパティのアルバム、モデルの名前または識別子では使用されませんモニカー アルバムと、埋め込みの子:  
  
```  
<albumMoniker name="Jazz after Teatime" />  
<songMoniker title="/Jazz after Teatime/Hot tea" />  
  
```  
  
## <a name="customizing-the-structure-of-the-xml"></a>XML の構造をカスタマイズします。  
 次のカスタマイズを行うには、展開、 **Xml シリアル化の動作**DSL のエクスプ ローラーでノード。 ドメイン クラスでは、下にあるこのクラスに供給されるプロパティとリレーションシップの一覧を表示する要素のデータ ノードを展開します。 リレーションシップを選択し、[プロパティ] ウィンドウでオプションを調整します。  
  
-   設定**要素の省略**ターゲット要素の一覧だけを残して、ソース ロール ノードを省略する場合は true にします。 ソースとターゲットのクラス間で複数のリレーションシップがある場合は、このオプションを設定する必要があります。  
  
    ```  
  
    <familyTreeModel ...>  
      <!-- The following node is omitted by using Omit Element: -->  
      <!-- <people> -->  
        <person name="Henry VIII" .../>  
        <person name="Elizabeth I" .../>  
      <!-- </people> -->  
    </familyTreeModel>  
  
    ```  
  
-   設定**を使用して完全な形式**リレーションシップ インスタンスを表すノードにターゲット ノードを埋め込む。 このオプションは、ドメイン リレーションシップにドメインのプロパティを追加するときに自動的に設定されます。  
  
    ```  
  
    <familyTreeModel ...>  
      <people>  
        <!-- The following node is inserted by using Use Full Form: -->  
        <familyTreeModelHasPeople myRelationshipProperty="x1">  
          <person name="Henry VIII" .../>  
        </familyTreeModelHasPeople>  
        <familyTreeModelHasPeople myRelationshipProperty="x2">  
          <person name="Elizabeth I" .../>  
        </familyTreeModelHasPeople>  
      </people>  
    </familyTreeModel>  
  
    ```  
  
-   設定**表現** = **要素**ドメイン プロパティの属性値としての代わりに要素として保存します。  
  
    ```  
    <person name="Elizabeth I" birthYear="1533">  
      <deathYear>1603</deathYear>  
    </person>  
    ```  
  
-   属性とのリレーションシップがシリアル化の順序を変更する 要素のデータ項目を右クリックしを使用して、**上へ移動**または**下へ移動**メニュー コマンド。  
  
## <a name="major-customization-using-program-code"></a>プログラム コードを使用したメジャーのカスタマイズ  
 シリアル化アルゴリズムの一部または全体を置き換えることができます。  
  
 内のコードを調査することをお勧め**Dsl\Generated Code\Serializer.cs**と**SerializationHelper.cs**です。  
  
#### <a name="to-customize-the-serialization-of-a-particular-class"></a>特定のクラスのシリアル化をカスタマイズするには  
  
1.  設定**はカスタム**そのクラスの下のノードに**Xml シリアル化の動作**です。  
  
2.  すべてのテンプレートの変換、ソリューションをビルドおよびコンパイル エラーの発生を調査します。 各エラーの近くのコメントでは、指定する必要がどのようなコードについて説明します。  
  
#### <a name="to-provide-your-own-serialization-for-the-whole-model"></a>モデル全体の独自のシリアル化を提供するには  
  
1.  Dsl\GeneratedCode\SerializationHelper.cs でメソッドをオーバーライドします。  
  
## <a name="options-in-xml-serialization-behavior"></a>Xml シリアル化の動作のオプション  
 DSL のエクスプ ローラーでは、Xml シリアル化の動作ノードには、各ドメイン クラス、リレーションシップ、図形、コネクタと図のクラスの子ノードが含まれています。 各ノードの下で、プロパティとその要素で関係の一覧です。 独自の右側との両方で、ソース クラス リレーションシップが表されます。  
  
 次の表は、DSL 定義のこのセクションで設定できるオプションをまとめたものです。 各ケースでは、DSL のエクスプ ローラーで要素を選択し、[プロパティ] ウィンドウで、オプションを設定します。  
  
### <a name="xml-class-data"></a>クラスの Xml データ  
 DSL のエクスプ ローラーの下でこれらの要素が見つかった**Xml シリアル化 Behavior\Class データ**です。  
  
|||  
|-|-|  
|プロパティ|説明|  
|カスタム要素のスキーマがあります。|True の場合は、ドメイン クラスにカスタム要素のスキーマがあることを示します。|  
|カスタムします。|これを設定して**True**このドメイン クラスの独自のシリアル化および逆シリアル化コードを記述するかどうか。<br /><br /> ソリューションをビルドし、詳細な手順を検出するエラーを調査します。|  
|ドメイン クラス|ドメイン クラスがこのクラスのデータ ノードが適用されます。 読み取り専用です。|  
|要素名|このクラスの要素の Xml ノードの名前。 既定値は、ドメイン クラス名の小文字版です。|  
|モニカーの属性名|参照を格納するモニカー要素で使用される属性の名前です。 空白の場合は、キー プロパティまたは id の名前が使用されます。<br /><br /> この例では、"name"することをお勧めします。  `<personMoniker name="/Mike Nash"/>`|  
|モニカー要素名|このクラスの要素を参照するモニカーを使用する xml 要素の名前です。<br /><br /> 既定値は、"Moniker"が付けられたクラス名の小文字版です。 たとえば、`personMoniker` のようにします。|  
|モニカーの型名|このクラスの要素にモニカーに対して生成された xsd 型の名前です。 XSD **Dsl\Generated コード\\\*Schema.xsd**|  
|Id をシリアル化します。|True の場合は、ファイルに要素 GUID にはが含まれています。 マークされているプロパティが存在しない場合は true でなければなりません**モニカー キーである**し、DSL は、このクラスに参照リレーションシップを定義します。|  
|型の名前|指定したドメイン クラスから xsd で生成された xml 型の名前です。|  
|メモ|この要素に関連付けられている非公式のメモ|  
  
### <a name="xml-property-data"></a>Xml プロパティのデータ  
 Xml プロパティの各ノードはクラスのノードの下にあります。  
  
|||  
|-|-|  
|プロパティ|説明|  
|ドメインのプロパティ|Xml シリアル化の構成データを適用するプロパティです。 読み取り専用です。|  
|モニカーのキーです。|True の場合、プロパティはこのドメイン クラスのインスタンスを参照するモニカーを作成するためのキーとして使用します。|  
|モニカーの修飾子は、します。|True の場合、モニカーで修飾子を作成するために、プロパティは使用されます。 False の場合、次のいずれかがこのドメイン クラスの場合は true でない場合、モニカーは、埋め込みのツリー内の親要素のモニカーによって限定されます。|  
|表現|属性、プロパティが、xml 属性としてシリアル化される場合かどうか、要素は、要素としてシリアル化かどうか無視はシリアル化します。|  
|Xml 名|使用する xml 属性またはプロパティを表す要素名。 既定では、これは、ドメインのプロパティ名の小文字版です。|  
|メモ|この要素に関連付けられている非公式のメモ|  
  
### <a name="xml-role-data"></a>ロールの Xml データ  
 ロールのデータ ノードはソース クラスのノードの下にあります。  
  
|プロパティ|説明|  
|--------------|-----------------|  
|カスタムのモニカーを持つ|これを生成およびこのリレーションシップを走査するモニカーを解決するための独自のコードを指定する場合は true に設定します。<br /><br /> 詳細な手順については、ソリューションをビルドし、エラー メッセージをダブルクリックします。|  
|ドメインの関係|これらのオプションを適用するリレーションシップを指定します。 読み取り専用です。|  
|要素を省略します。|True の場合、ソース ロールに対応する XML ノードは、スキーマから省略されます。<br /><br /> ソースとターゲットのクラス間で複数のリレーションシップがある場合は、このロール ノード 2 つのリレーションシップに属しているリンクを区別します。 そのため、設定することはありませんは、このオプションここではお勧めします。|  
|ロール要素名|ソース ロールから派生する XML 要素の名前を指定します。 既定値は、ロールのプロパティ名です。|  
|完全な形式を使用します。|True の場合、各ターゲット要素またはモニカーは、リレーションシップを表す XML ノードで囲みます。 これは、このリレーションシップは、独自のドメインのプロパティを true に設定する必要があります。|  
  
## <a name="see-also"></a>関連項目  
 [移動して、プログラム コードでモデルを更新します。](../modeling/navigating-and-updating-a-model-in-program-code.md)   
 [ドメイン固有言語からのコード生成](../modeling/generating-code-from-a-domain-specific-language.md)