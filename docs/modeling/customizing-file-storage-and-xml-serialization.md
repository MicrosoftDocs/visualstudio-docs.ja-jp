---
title: "ファイル格納処理および XML シリアル化処理のカスタマイズ | Microsoft Docs"
ms.custom: ""
ms.date: "12/15/2016"
ms.prod: "visual-studio-tfs-dev14"
ms.reviewer: ""
ms.suite: ""
ms.tgt_pltfrm: ""
ms.topic: "article"
f1_keywords: 
  - "vs.dsltools.dsldesigner.xmlbehavior"
helpviewer_keywords: 
  - "ドメイン固有言語、シリアル化"
ms.assetid: 76c53ef1-e3b9-45da-b425-1bddb3c01395
caps.latest.revision: 17
caps.handback.revision: 17
author: "alancameronwills"
ms.author: "awills"
manager: "douge"
---
# ファイル格納処理および XML シリアル化処理のカスタマイズ
[!INCLUDE[vs2017banner](../code-quality/includes/vs2017banner.md)]

ユーザーは、インスタンスを保存するときに、または *モデル*, でドメイン固有言語 (DSL) の [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)], 、XML ファイルが作成または更新します。 ファイルは、ストア内のモデルを再作成を再読み込みすることができます。  
  
 シリアル化スキームをカスタマイズするには、下にある設定を調整する **Xml Serialization Behavior** DSL エクスプ ローラーでします。 下のノードがある **Xml Serialization Behavior** のすべてのドメイン クラス、プロパティ、およびリレーションシップです。 リレーションシップは、そのソース クラスは \bin にあります。 図形、コネクタ、および図のクラスに対応するノードもあります。  
  
 高度なカスタマイズのプログラム コードを記述することもできます。  
  
> [!NOTE]
>  特定の形式でモデルを保存する場合、そのフォームから、再読み込みする必要はありません、カスタムのシリアル化スキームではなく、モデルからの出力を生成するテキスト テンプレートの使用を検討してください。 詳細については、次を参照してください。 [ドメイン固有言語からコードを生成する](../modeling/generating-code-from-a-domain-specific-language.md)です。  
  
## <a name="model-and-diagram-files"></a>モデルと図ファイル  
 通常、各モデルは、2 つのファイルで保存します。  
  
-   モデル ファイルなど、名前を持つ **Model1.mydsl**します。 モデル要素およびリレーションシップとそのプロパティを格納します。 などのファイル拡張子 **.mydsl** によって決まりますが、 **FileExtension** のプロパティ、 **エディター** DSL 定義内のノードです。  
  
-   図のファイルなど、名前があります **Model1.mydsl.diagram**します。 図形、コネクタ、およびそれらの位置、色、線の太さ、および、図の外観の他の詳細を格納します。 ユーザーを削除した場合、 **.diagram** ファイル、モデルの重要な情報が失われない。 ダイアグラムのレイアウトだけでは、失われます。 モデル ファイルを開いたときに、既定値は、図形のセットし、コネクタが作成されます。  
  
#### <a name="to-change-the-file-extension-of-a-dsl"></a>DSL のファイル拡張子を変更するには  
  
1.  DSL 定義を開きます。 DSL エクスプ ローラーで、[エディター] ノードをクリックします。  
  
2.  プロパティ ウィンドウで、編集、 **FileExtension** プロパティです。 最初は含めないでください"です。"のファイル名拡張子。  
  
3.  ソリューション エクスプ ローラーで、次の 2 つの項目テンプレート ファイルの名前を変更 **DslPackage\ProjectItemTemplates**します。 これらのファイルは、次の形式に従って名前を持ちます。  
  
     `myDsl.diagram`  
  
     `myDsl.myDsl`  
  
## <a name="the-default-serialization-scheme"></a>既定のシリアル化スキーム  
 このトピックの例を作成するには、次の DSL 定義が使用されました。  
  
 ![DSL 定義図と #45 です。ファミリ ツリー モデル](../modeling/media/familyt_person.png "FamilyT_Person")  
  
 この DSL は、画面の外観を次のあるモデルの作成に使用されました。  
  
 ![ファミリ ツリー ダイアグラム、ツールボックス、およびエクスプローラー](../modeling/media/familyt_instance.png "FamilyT_Instance")  
  
 このモデルが保存され、再び XML テキスト エディターで開きます。  
  
```  
<?xml version="1.0" encoding="utf-8"?>  
<familyTreeModel xmlns:dm0="http://schemas.microsoft.com/VisualStudio/2008/DslTools/Core" dslVersion="1.0.0.0" Id="f817b728-e920-458e-bb99-98edc469d78f" xmlns="http://schemas.microsoft.com/dsltools/FamilyTree">  
  <people>  
    <person name="Henry VIII" birthYear="1491" deathYear="1547" age="519">  
      <children>  
        <personMoniker name="/f817b728-e920-458e-bb99-98edc469d78f/Elizabeth I" />  
        <personMoniker name="/f817b728-e920-458e-bb99-98edc469d78f/Mary" />  
      </children>  
    </person>  
    <person name="Elizabeth I" birthYear="1533" deathYear="1603" age="477" />  
    <person name="Mary" birthYear="1515" deathYear="1558" age="495" />  
  </people>  
</familyTreeModel>  
  
```  
  
 シリアル化されたモデルは次の点に注意してください。  
  
-   各 XML ノードでは、最初の文字が小文字にする点を除いては、ドメイン クラス名と同じ名前があります。 たとえば、 `familyTreeModel` と `person`です。  
  
-   ドメイン名や誕生年などのプロパティは、XML ノードの属性としてシリアル化されます。 ここでも、プロパティ名の最初の文字は小文字に変換されます。  
  
-   各リレーションシップがリレーションシップのソース end の内部に入れ子になった XML ノードとしてシリアル化されます。 ノードには、小文字の最初の文字ですが、ソース ロールのプロパティと同じ名前があります。  
  
     たとえば、DSL 定義の名前は、ロールで **人** に属している、 **FamilyTree** クラスです。  という名前のノードで、XML で表されます `people` 内に入れ子になった、 `familyTreeModel` ノードです。  
  
-   各埋め込みリレーションシップのターゲットの end は、リレーションシップの下に入れ子になったノードとしてシリアル化されます。 たとえば、 `people` ノードでは、いくつか含まれています `person` ノードです。  
  
-   各参照リレーションシップのターゲットの end としてシリアル化、 *モニカー*, 、ターゲット要素への参照をエンコードします。  
  
     たとえば、下にある、 `person` ノードがあります、 `children` リレーションシップです。 このノードには、モニカーにはなどが含まれます。  
  
    ```  
    <personMoniker name="/f817b728-e920-458e-bb99-98edc469d78f/Elizabeth I" />  
    ```  
  
## <a name="understanding-monikers"></a>理解モニカー  
 モニカーが使用され、モデルと図のファイルのさまざまな部分の間の相互参照を表します。 使用されることも、 `.diagram` ファイルをモデル ファイル内のノードを参照してください。 モニカーの 2 つの形式があります。  
  
-   *Id モニカー* ターゲット要素の GUID を引用します。 例:  
  
    ```  
    <personShapeMoniker Id="f79734c0-3da1-4d72-9514-848fa9e75157" />  
  
    ```  
  
-   *キーのモニカーを修飾* モニカー キーと呼ばれる指定されたドメイン プロパティの値によって、ターゲット要素を識別します。 ターゲット要素のモニカーが埋め込みリレーションシップのツリーで、その親要素のモニカーで始まっています。  
  
     次の例は、DSL をあるはクラスの名前付きの曲、ドメインへの埋め込みリレーションシップを持つアルバムをという名前のドメイン クラスから取得されます。  
  
    ```  
    <albumMoniker title="/My Favorites/Jazz after Teatime" />  
    <songMoniker title="/My Favorites/Jazz after Teatime/Hot tea" />  
  
    ```  
  
     ターゲット クラスをドメイン プロパティがある場合は、修飾キー モニカーが使用されるオプション **モニカー キーである** に設定されている `true` で **Xml Serialization Behavior**します。 例では、このオプションは「アルバム」や"Song"ドメイン クラスに"Title"という名前のドメイン プロパティに設定されます。  
  
 修飾キー モニカーでも、ID モニカーより読みやすくします。 ユーザーが判読できるように、モデル ファイルの XML にする場合は、修飾キー モニカを使用するを検討してください。 ただし、ユーザーは同じモニカー キーが 1 つ以上の要素の設定です。 重複するキーには、ファイルが正しく再読み込みしない可能性があります。 そのため、修飾キー モニカを使用する参照されるドメイン クラスを定義する場合は、重複するモニカーのあるファイルを保存してから、ユーザーを回避する方法を検討してください。  
  
#### <a name="to-set-a-domain-class-to-be-referenced-by-id-monikers"></a>ID モニカーによって参照されるドメイン クラスを設定するには  
  
1.  確認して **モニカー キーである** は `false` クラスとその基本クラスのすべてのドメイン プロパティにします。  
  
    1.  DSL エクスプ ローラーで、 **Xml シリアル化 Behavior\Class データ\\***\< ドメイン クラス>***\Element データ**します。  
  
    2.  いることを確認 **モニカー キーである** は `false` のすべてのドメイン プロパティです。  
  
    3.  ドメイン クラスに基本クラスがある場合は、そのクラスの手順を繰り返します。  
  
2.  設定 **Id のシリアル化** = `true` ドメイン クラスです。  
  
     このプロパティはの下にあります **Xml Serialization Behavior**します。  
  
#### <a name="to-set-a-domain-class-to-be-referenced-by-qualified-key-monikers"></a>修飾キー モニカーによって参照されるドメイン クラスを設定するには  
  
-   設定 **モニカー キーである** 既存のドメイン クラスのドメイン プロパティにします。 プロパティの型である必要があります `string`します。  
  
    1.  DSL エクスプ ローラーで、 **Xml シリアル化 Behavior\Class データ\\***\< ドメイン クラス>***\Element データ**, 、ドメイン プロパティを選択します。  
  
    2.  [プロパティ] ウィンドウで次のように設定します。 **モニカー キーである** に `true`します。  
  
-   \- または、  
  
     新しいドメイン クラスを使用して、作成、 **という名前のドメイン クラス** ツールです。  
  
     このツールでは、名前と呼ばれるドメイン プロパティを持つ新しいクラスを作成します。  **は要素名** と **モニカー キーである** にこのドメイン プロパティのプロパティが初期化されます `true`します。  
  
-   \- または、  
  
     モニカー キー プロパティを持つ別のクラスに、ドメイン クラスから継承リレーションシップを作成します。  
  
### <a name="avoiding-duplicate-monikers"></a>重複するモニカーを回避します。  
 修飾キー モニカーを使用する場合、あるユーザーのモデルの 2 つの要素がキー プロパティに同じ値を持つ可能性があります。 たとえば、DSL にクラス プロパティ名を持つ人がある場合、ユーザーは同じにする 2 つの要素の名前を設定します。 できますが、モデル ファイルに保存するには再読み込みされません正しくします。  
  
 この状況を避けるために役立ついくつかの方法があります。  
  
-   設定 **は要素名** = `true` キーのドメイン プロパティにします。 DSL 定義図でドメイン プロパティを選択し、[プロパティ] ウィンドウで、値を設定します。  
  
     ユーザーは、クラスの新しいインスタンスを作成するとき、この値は、別の値を自動的に割り当てられるにドメイン プロパティをします。 既定の動作は、クラス名の末尾に数値を追加します。 これができないユーザーから、重複する名前を変更する操作は、ユーザーが、モデルを保存する前に、値を設定しない場合に備えて、役立ちます。  
  
-   DSL の検証を有効にします。 DSL エクスプ ローラーで、エディターを選択し、設定、 **... の使用** プロパティ `true`します。  
  
     あいまいさの検証を自動的に生成されたメソッドを確認するには。 メソッドが、 `Load` 検証カテゴリ。 これにより、あるユーザー警告が表示されることができない可能性があります、ファイルを開き直す。  
  
     詳細については、次を参照してください。 [ドメイン固有言語における検証](../modeling/validation-in-a-domain-specific-language.md)します。  
  
### <a name="moniker-paths-and-qualifiers"></a>モニカーのパスと修飾子  
 修飾キー モニカーでは、モニカー キーを使用して終了し、埋め込みのツリー内の親のモニカーにプレフィックスが指定します。 たとえば、次のように、アルバムのモニカーがある場合。  
  
```  
<albumMoniker title="/My Favorites/Jazz after Teatime" />  
  
```  
  
 そのアルバムの曲のいずれかの可能性があります。  
  
```  
<songMoniker title="/My Favorites/Jazz after Teatime/Hot tea" />  
```  
  
 ただし、アルバムが代わりに ID を使用して参照をする場合、モニカーとして次になります。  
  
```  
<albumMoniker Id="77472c3a-9bf9-4085-976a-d97a4745237c" />  
<songMoniker title="/77472c3a-9bf9-4085-976a-d97a4745237c/Hot tea" />  
```  
  
 ある GUID は一意であるため決して付けた名前がその親のモニカーに注意してください。  
  
 特定のドメイン プロパティは常には、モデル内の一意の値にある場合を設定できます **がモニカー修飾子** に `true` そのプロパティのです。 親のモニカーを使用せず、修飾子として使用されるようになります。 たとえば、次の両方を設定する **がモニカー修飾子** と **モニカー キーである** アルバム クラスの Title ドメイン プロパティ、モデルの名前または id は使用されませんモニカーのアルバムとその埋め込まれた子。  
  
```  
<albumMoniker name="Jazz after Teatime" />  
<songMoniker title="/Jazz after Teatime/Hot tea" />  
  
```  
  
## <a name="customizing-the-structure-of-the-xml"></a>XML の構造をカスタマイズします。  
 次のカスタマイズを行うには、展開、 **Xml Serialization Behavior** DSL エクスプ ローラーのノードです。 ドメイン クラスの下には、このクラスに供給されるプロパティとリレーションシップの一覧を表示する要素のデータ ノードを展開します。 リレーションシップを選択し、[プロパティ] ウィンドウでオプションを調整します。  
  
-   設定 **要素の省略** ターゲット要素のリストだけを残しますソース ロール ノードを省略する場合は true にします。 ソースとターゲットのクラス間で複数のリレーションシップがある場合は、このオプションを設定する必要があります。  
  
    ```  
  
    <familyTreeModel ...>  
      <!-- The following node is omitted by using Omit Element: -->  
      <!-- <people> -->  
        <person name="Henry VIII" .../>  
        <person name="Elizabeth I" .../>  
      <!-- </people> -->  
    </familyTreeModel>  
  
    ```  
  
-   設定 **使用完全形式** リレーションシップ インスタンスを表すノードにターゲット ノードを埋め込む。 ドメイン リレーションシップにドメインのプロパティを追加すると、このオプションは自動的に設定します。  
  
    ```  
  
    <familyTreeModel ...>  
      <people>  
        <!-- The following node is inserted by using Use Full Form: -->  
        <familyTreeModelHasPeople myRelationshipProperty="x1">  
          <person name="Henry VIII" .../>  
        </familyTreeModelHasPeople>  
        <familyTreeModelHasPeople myRelationshipProperty="x2">  
          <person name="Elizabeth I" .../>  
        </familyTreeModelHasPeople>  
      </people>  
    </familyTreeModel>  
  
    ```  
  
-   設定 **表現** = **要素** ドメイン プロパティの属性値としての代わりに要素として保存します。  
  
    ```  
    <person name="Elizabeth I" birthYear="1533">  
      <deathYear>1603</deathYear>  
    </person>  
    ```  
  
-   属性と関係がシリアル化順序を変更する [要素のデータ項目を右クリックし、使用して、 **上へ移動** または **下へ移動** メニュー コマンドです。  
  
## <a name="major-customization-using-program-code"></a>プログラム コードを使用したメジャーのカスタマイズ  
 シリアル化アルゴリズムの一部または全体を置き換えることができます。  
  
 内のコードを調査することをお勧め **Dsl\Generated Code\Serializer.cs** と **SerializationHelper.cs**します。  
  
#### <a name="to-customize-the-serialization-of-a-particular-class"></a>特定のクラスのシリアル化をカスタマイズするには  
  
1.  設定 **はカスタム** 、そのクラスの下のノードに **Xml Serialization Behavior**します。  
  
2.  すべてのテンプレートの変換、ソリューションをビルドし、結果として得られるコンパイル エラーを調査します。 各エラーの近くのコメントでは、指定する必要がどのようなコードについて説明します。  
  
#### <a name="to-provide-your-own-serialization-for-the-whole-model"></a>モデル全体の独自のシリアル化を提供するには  
  
1.  Dsl\GeneratedCode\SerializationHelper.cs でメソッドをオーバーライドします。  
  
## <a name="options-in-xml-serialization-behavior"></a>Xml シリアル化の動作のオプション  
 DSL エクスプ ローラーでは、Xml シリアル化の動作ノードには、各ドメイン クラス、リレーションシップ、図形、コネクタおよび図クラス用の子ノードが含まれています。 各ノードの下で、プロパティとその要素をソースの関係の一覧です。 リレーションシップは、その独自の目的と、ソース クラスの下の両方に表されます。  
  
 次の表は、DSL 定義のこのセクションで設定できるオプションをまとめたものです。 各ケースでは、DSL エクスプ ローラーで要素を選択し、[プロパティ] ウィンドウで、オプションを設定します。  
  
### <a name="xml-class-data"></a>Xml クラス データ  
 [DSL エクスプ ローラーでこれらの要素が検出された **Xml シリアル化 Behavior\Class のデータ**します。  
  
|||  
|-|-|  
|プロパティ|説明|  
|スキーマがカスタム要素|True の場合は、ドメイン クラスにカスタム要素のスキーマがあることを示します。|  
|カスタムします。|これを設定 **True** このドメイン クラスの独自のシリアル化および逆シリアル化コードを記述するかどうか。<br /><br /> ソリューションをビルドし、詳細な手順についてを検出するエラーを調査します。|  
|ドメイン クラス|ドメイン クラスがこのクラスのデータ ノードが適用されます。 読み取り専用です。|  
|要素名|このクラスの要素の Xml ノード名。 既定値は、ドメイン クラス名の小文字版です。|  
|モニカーの属性名|参照を格納するモニカー要素で使用される属性の名前です。 空白の場合は、キー プロパティまたは id の名前が使用されます。<br /><br /> この例では、"name"することをお勧めします。  `<personMoniker name="/Mike Nash"/>`|  
|モニカー要素名|このクラスの要素を参照するモニカーを使用する xml 要素の名前です。<br /><br /> 既定値は、クラス名は「モニカー」末尾の小文字版です。 たとえば、`personMoniker` のようにします。|  
|モニカーの型名|このクラスの要素にモニカーに対して生成された xsd 型の名前です。 XSD は **Dsl\Generated コード\\\*Schema.xsd**|  
|Id をシリアル化します。|True の場合は、ファイルの要素 GUID にはが含まれています。 マークされているプロパティが存在しない場合は true。 必ず **モニカー キーである** し、DSL は、このクラスに参照リレーションシップを定義します。|  
|型の名前|指定したドメイン クラスから xsd で生成された xml 型の名前です。|  
|ノート|この要素に関連付けられている非公式な注釈|  
  
### <a name="xml-property-data"></a>Xml プロパティ データ  
 Xml プロパティの各ノードはクラスのノードの下にあります。  
  
|||  
|-|-|  
|プロパティ|説明|  
|ドメイン プロパティ|プロパティは、xml シリアル化の構成データが適用されます。 読み取り専用です。|  
|モニカー キーは、します。|True の場合、プロパティはこのドメイン クラスのインスタンスを参照するモニカーを作成するためのキーとして使用します。|  
|モニカー修飾子は、します。|True の場合、モニカーで修飾子を作成するために、プロパティは使用されます。 False の場合と、次のいずれかがこのドメイン クラスの場合は true でない場合は、モニカーは、埋め込みツリーの親要素のモニカーによって限定されます。|  
|表現|属性、プロパティは、xml 属性としてシリアル化する場合要素であれば、要素としてシリアル化[無視] であるかどうかをシリアル化します。|  
|Xml 名|使用する xml 属性またはプロパティを表す要素名。 既定では、これは、ドメインのプロパティ名の小文字版です。|  
|ノート|この要素に関連付けられている非公式な注釈|  
  
### <a name="xml-role-data"></a>ロールの Xml データ  
 ロールのデータ ノードはソース クラスのノードの下にあります。  
  
|プロパティ|説明|  
|--------------|-----------------|  
|カスタムのモニカーを持つ|これを生成およびこのリレーションシップを走査するモニカーを解決するための独自のコードを指定する場合は true に設定します。<br /><br /> 詳細な手順については、ソリューションをビルドし、エラー メッセージをダブルクリックします。|  
|ドメインの関係|これらのオプションを適用するリレーションシップを指定します。 読み取り専用です。|  
|要素を省略します。|True の場合、ソース ロールに対応する XML ノードは、スキーマから省略されます。<br /><br /> ソースとターゲットのクラス間のリレーションシップは 1 つ以上の場合は、このロール ノード 2 つのリレーションシップに属しているリンクを区別します。 したがっては設定しないことは、このオプション ､ ホをお勧めします。|  
|ロール要素名|ソース ロールから派生する XML 要素の名前を指定します。 既定値は、ロールのプロパティ名です。|  
|完全な形式を使用してください。|True の場合は、各ターゲット要素またはモニカーがリレーションシップを表す XML ノードで囲まれます。 これは、このリレーションシップは、独自のドメイン プロパティを true に設定する必要があります。|  
  
## <a name="see-also"></a>参照  
 [移動して、プログラム コードでモデルを更新します。](../modeling/navigating-and-updating-a-model-in-program-code.md)   
 [ドメイン固有言語からコードを生成します。](../modeling/generating-code-from-a-domain-specific-language.md)